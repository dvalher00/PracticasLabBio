<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Valcárcel Herrera">

<title>Actividad 3 - EFECTO INSECTICIDAS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="insectarbol_files/libs/clipboard/clipboard.min.js"></script>
<script src="insectarbol_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="insectarbol_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="insectarbol_files/libs/quarto-html/popper.min.js"></script>
<script src="insectarbol_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="insectarbol_files/libs/quarto-html/anchor.min.js"></script>
<link href="insectarbol_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="insectarbol_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="insectarbol_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="insectarbol_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="insectarbol_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="insectarbol_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="insectarbol_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="insectarbol_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="insectarbol_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="insectarbol_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice de la actividad 3</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a>
  <ul class="collapse">
  <li><a href="#instalación-de-paquetes" id="toc-instalación-de-paquetes" class="nav-link" data-scroll-target="#instalación-de-paquetes"><span class="header-section-number">1.1</span> Instalación de paquetes</a></li>
  </ul></li>
  <li><a href="#análisis-de-insecticidas-en-2017" id="toc-análisis-de-insecticidas-en-2017" class="nav-link" data-scroll-target="#análisis-de-insecticidas-en-2017"><span class="header-section-number">2</span> Análisis de insecticidas en 2017</a>
  <ul class="collapse">
  <li><a href="#primera-observación-de-los-datos" id="toc-primera-observación-de-los-datos" class="nav-link" data-scroll-target="#primera-observación-de-los-datos"><span class="header-section-number">2.1</span> Primera observación de los datos</a></li>
  <li><a href="#primeros-boxplot" id="toc-primeros-boxplot" class="nav-link" data-scroll-target="#primeros-boxplot"><span class="header-section-number">2.2</span> Primeros boxplot</a></li>
  <li><a href="#p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados" id="toc-p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados" class="nav-link" data-scroll-target="#p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados"><span class="header-section-number">2.3</span> P1 - ¿Qué insecticida es más efectivo? Planteamiento de varios modelos lineales generalizados</a>
  <ul class="collapse">
  <li><a href="#qué-distribución-podría-fittear-bien-los-datos" id="toc-qué-distribución-podría-fittear-bien-los-datos" class="nav-link" data-scroll-target="#qué-distribución-podría-fittear-bien-los-datos"><span class="header-section-number">2.3.1</span> ¿Qué distribución podría fittear bien los datos?</a></li>
  <li><a href="#modelo-1-modelo-lineal-mixto-con-lmer" id="toc-modelo-1-modelo-lineal-mixto-con-lmer" class="nav-link" data-scroll-target="#modelo-1-modelo-lineal-mixto-con-lmer"><span class="header-section-number">2.3.2</span> Modelo 1: Modelo lineal mixto con lmer</a></li>
  <li><a href="#modelo-1.5-transformación-box-cox-con-lmer" id="toc-modelo-1.5-transformación-box-cox-con-lmer" class="nav-link" data-scroll-target="#modelo-1.5-transformación-box-cox-con-lmer"><span class="header-section-number">2.3.3</span> Modelo 1.5: Transformación Box-Cox con lmer</a></li>
  <li><a href="#modelo-2-modelo-lineal-generalizado-mixto-transformación-datos-family-beta" id="toc-modelo-2-modelo-lineal-generalizado-mixto-transformación-datos-family-beta" class="nav-link" data-scroll-target="#modelo-2-modelo-lineal-generalizado-mixto-transformación-datos-family-beta"><span class="header-section-number">2.3.4</span> Modelo 2: Modelo lineal generalizado mixto + Transformación datos, family = beta)</a></li>
  <li><a href="#modelo-3-inferencia-bayesiana-con-brms" id="toc-modelo-3-inferencia-bayesiana-con-brms" class="nav-link" data-scroll-target="#modelo-3-inferencia-bayesiana-con-brms"><span class="header-section-number">2.3.5</span> Modelo 3 (inferencia bayesiana con brms)</a></li>
  <li><a href="#modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad" id="toc-modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad" class="nav-link" data-scroll-target="#modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad"><span class="header-section-number">2.3.6</span> Modelo 4: modelo lineal con nlme con heterocedasticidad</a></li>
  </ul></li>
  <li><a href="#sec-folprimera" id="toc-sec-folprimera" class="nav-link" data-scroll-target="#sec-folprimera"><span class="header-section-number">2.4</span> P2 - ¿Es más eficaz foliar o inyectar?</a>
  <ul class="collapse">
  <li><a href="#modelo-1-modelo-lineal-mixto-con-lmer-1" id="toc-modelo-1-modelo-lineal-mixto-con-lmer-1" class="nav-link" data-scroll-target="#modelo-1-modelo-lineal-mixto-con-lmer-1"><span class="header-section-number">2.4.1</span> Modelo 1: Modelo lineal mixto con lmer</a></li>
  <li><a href="#modelo-1.5-transformación-box-cox-usar-mortalidad_trans" id="toc-modelo-1.5-transformación-box-cox-usar-mortalidad_trans" class="nav-link" data-scroll-target="#modelo-1.5-transformación-box-cox-usar-mortalidad_trans"><span class="header-section-number">2.4.2</span> Modelo 1.5: Transformación Box-Cox (usar mortalidad_trans)</a></li>
  <li><a href="#modelo-2-anova-de-welch" id="toc-modelo-2-anova-de-welch" class="nav-link" data-scroll-target="#modelo-2-anova-de-welch"><span class="header-section-number">2.4.3</span> Modelo 2: ANOVA de Welch</a></li>
  <li><a href="#modelo-3-modelo-lineal-con-nlme-con-heterocedasticidad" id="toc-modelo-3-modelo-lineal-con-nlme-con-heterocedasticidad" class="nav-link" data-scroll-target="#modelo-3-modelo-lineal-con-nlme-con-heterocedasticidad"><span class="header-section-number">2.4.4</span> Modelo 3: modelo lineal con nlme con heterocedasticidad</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#análisis-de-insecticidas-en-2018" id="toc-análisis-de-insecticidas-en-2018" class="nav-link" data-scroll-target="#análisis-de-insecticidas-en-2018"><span class="header-section-number">3</span> Análisis de insecticidas en 2018</a>
  <ul class="collapse">
  <li><a href="#extracción-de-datos-de-excel-a-un-dataframe" id="toc-extracción-de-datos-de-excel-a-un-dataframe" class="nav-link" data-scroll-target="#extracción-de-datos-de-excel-a-un-dataframe"><span class="header-section-number">3.1</span> Extracción de datos de Excel a un dataframe</a></li>
  <li><a href="#primeros-boxplot-1" id="toc-primeros-boxplot-1" class="nav-link" data-scroll-target="#primeros-boxplot-1"><span class="header-section-number">3.2</span> Primeros boxplot</a></li>
  <li><a href="#p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados-1" id="toc-p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados-1" class="nav-link" data-scroll-target="#p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados-1"><span class="header-section-number">3.3</span> P1 - ¿Qué insecticida es más efectivo? Planteamiento de varios modelos lineales generalizados</a>
  <ul class="collapse">
  <li><a href="#qué-distribución-podría-fittear-bien-los-datos-1" id="toc-qué-distribución-podría-fittear-bien-los-datos-1" class="nav-link" data-scroll-target="#qué-distribución-podría-fittear-bien-los-datos-1"><span class="header-section-number">3.3.1</span> ¿Qué distribución podría fittear bien los datos?</a></li>
  <li><a href="#modelo-1-modelo-lineal-mixto-con-lmer-2" id="toc-modelo-1-modelo-lineal-mixto-con-lmer-2" class="nav-link" data-scroll-target="#modelo-1-modelo-lineal-mixto-con-lmer-2"><span class="header-section-number">3.3.2</span> Modelo 1: Modelo lineal mixto con lmer</a></li>
  <li><a href="#modelo-2-modelo-lmer-con-logaritmo" id="toc-modelo-2-modelo-lmer-con-logaritmo" class="nav-link" data-scroll-target="#modelo-2-modelo-lmer-con-logaritmo"><span class="header-section-number">3.3.3</span> Modelo 2: modelo lmer con logaritmo</a></li>
  <li><a href="#modelo-3-modelo-beta" id="toc-modelo-3-modelo-beta" class="nav-link" data-scroll-target="#modelo-3-modelo-beta"><span class="header-section-number">3.3.4</span> Modelo 3: modelo beta</a></li>
  <li><a href="#modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad-1" id="toc-modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad-1" class="nav-link" data-scroll-target="#modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad-1"><span class="header-section-number">3.3.5</span> Modelo 4: modelo lineal con nlme con heterocedasticidad</a></li>
  </ul></li>
  <li><a href="#sec-folsegunda" id="toc-sec-folsegunda" class="nav-link" data-scroll-target="#sec-folsegunda"><span class="header-section-number">3.4</span> P2 - ¿Es más eficaz foliar o inyectar?</a>
  <ul class="collapse">
  <li><a href="#modelo-1-modelo-lineal-mixto-con-lmer-3" id="toc-modelo-1-modelo-lineal-mixto-con-lmer-3" class="nav-link" data-scroll-target="#modelo-1-modelo-lineal-mixto-con-lmer-3"><span class="header-section-number">3.4.1</span> Modelo 1: Modelo lineal mixto con lmer</a></li>
  <li><a href="#modelo-2-modelo-lineal-con-nlme-con-heterocedasticidad" id="toc-modelo-2-modelo-lineal-con-nlme-con-heterocedasticidad" class="nav-link" data-scroll-target="#modelo-2-modelo-lineal-con-nlme-con-heterocedasticidad"><span class="header-section-number">3.4.2</span> Modelo 2: modelo lineal con nlme con heterocedasticidad</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#p3---qué-tratamiento-es-más-persistente" id="toc-p3---qué-tratamiento-es-más-persistente" class="nav-link" data-scroll-target="#p3---qué-tratamiento-es-más-persistente"><span class="header-section-number">4</span> P3 - ¿Qué tratamiento es más persistente?</a>
  <ul class="collapse">
  <li><a href="#treatment-palette-para-gráficos" id="toc-treatment-palette-para-gráficos" class="nav-link" data-scroll-target="#treatment-palette-para-gráficos"><span class="header-section-number">4.1</span> Treatment palette para gráficos</a></li>
  <li><a href="#visualización-de-datos-de-2017" id="toc-visualización-de-datos-de-2017" class="nav-link" data-scroll-target="#visualización-de-datos-de-2017"><span class="header-section-number">4.2</span> Visualización de datos de 2017</a></li>
  <li><a href="#modelos-mortalidad-2017" id="toc-modelos-mortalidad-2017" class="nav-link" data-scroll-target="#modelos-mortalidad-2017"><span class="header-section-number">4.3</span> Modelos mortalidad 2017</a>
  <ul class="collapse">
  <li><a href="#modelo-1-modelo-lmer-lineal" id="toc-modelo-1-modelo-lmer-lineal" class="nav-link" data-scroll-target="#modelo-1-modelo-lmer-lineal"><span class="header-section-number">4.3.1</span> Modelo 1: modelo lmer (lineal)</a></li>
  </ul></li>
  <li><a href="#conclusiones-para-2017" id="toc-conclusiones-para-2017" class="nav-link" data-scroll-target="#conclusiones-para-2017"><span class="header-section-number">4.4</span> Conclusiones para 2017</a></li>
  <li><a href="#visualización-de-datos-de-2018" id="toc-visualización-de-datos-de-2018" class="nav-link" data-scroll-target="#visualización-de-datos-de-2018"><span class="header-section-number">4.5</span> Visualización de datos de 2018</a></li>
  <li><a href="#modelos-mortalidad-2018" id="toc-modelos-mortalidad-2018" class="nav-link" data-scroll-target="#modelos-mortalidad-2018"><span class="header-section-number">4.6</span> Modelos mortalidad 2018</a>
  <ul class="collapse">
  <li><a href="#modelo-1-modelos-lineales-mixtos-lmer" id="toc-modelo-1-modelos-lineales-mixtos-lmer" class="nav-link" data-scroll-target="#modelo-1-modelos-lineales-mixtos-lmer"><span class="header-section-number">4.6.1</span> Modelo 1: Modelos lineales mixtos (lmer)</a></li>
  </ul></li>
  <li><a href="#conclusiones-para-2018" id="toc-conclusiones-para-2018" class="nav-link" data-scroll-target="#conclusiones-para-2018"><span class="header-section-number">4.7</span> Conclusiones para 2018</a></li>
  <li><a href="#modelo-único-para-clusterización" id="toc-modelo-único-para-clusterización" class="nav-link" data-scroll-target="#modelo-único-para-clusterización"><span class="header-section-number">4.8</span> Modelo único para clusterización</a>
  <ul class="collapse">
  <li><a href="#modelo-1-modelos-lineales-mixtos-lmer-1" id="toc-modelo-1-modelos-lineales-mixtos-lmer-1" class="nav-link" data-scroll-target="#modelo-1-modelos-lineales-mixtos-lmer-1"><span class="header-section-number">4.8.1</span> Modelo 1: Modelos lineales mixtos (lmer)</a></li>
  <li><a href="#clustering-y-curvas-promedio-en-conjunto" id="toc-clustering-y-curvas-promedio-en-conjunto" class="nav-link" data-scroll-target="#clustering-y-curvas-promedio-en-conjunto"><span class="header-section-number">4.8.2</span> Clustering y curvas promedio en conjunto</a></li>
  <li><a href="#distancia-wasserstein-otro-enfoque" id="toc-distancia-wasserstein-otro-enfoque" class="nav-link" data-scroll-target="#distancia-wasserstein-otro-enfoque"><span class="header-section-number">4.8.3</span> Distancia Wasserstein (otro enfoque)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusiones-de-p3" id="toc-conclusiones-de-p3" class="nav-link" data-scroll-target="#conclusiones-de-p3"><span class="header-section-number">5</span> Conclusiones de P3</a>
  <ul class="collapse">
  <li><a href="#diferencias-globales-entre-tratamientos-auc-y-mortalidad" id="toc-diferencias-globales-entre-tratamientos-auc-y-mortalidad" class="nav-link" data-scroll-target="#diferencias-globales-entre-tratamientos-auc-y-mortalidad"><span class="header-section-number">5.1</span> <strong>1. Diferencias globales entre tratamientos (AUC y mortalidad)</strong></a></li>
  <li><a href="#mortalidad-en-el-codo-y-mortalidad-final" id="toc-mortalidad-en-el-codo-y-mortalidad-final" class="nav-link" data-scroll-target="#mortalidad-en-el-codo-y-mortalidad-final"><span class="header-section-number">5.2</span> <strong>2. Mortalidad en el codo y mortalidad final</strong></a></li>
  <li><a href="#persistencia-delta_postcodo" id="toc-persistencia-delta_postcodo" class="nav-link" data-scroll-target="#persistencia-delta_postcodo"><span class="header-section-number">5.3</span> <strong>3. Persistencia (delta_postcodo)</strong></a></li>
  <li><a href="#conclusión-práctica" id="toc-conclusión-práctica" class="nav-link" data-scroll-target="#conclusión-práctica"><span class="header-section-number">5.4</span> <strong>Conclusión práctica</strong></a></li>
  </ul></li>
  <li><a href="#diagrama-de-conclusión" id="toc-diagrama-de-conclusión" class="nav-link" data-scroll-target="#diagrama-de-conclusión"><span class="header-section-number">6</span> Diagrama de conclusión</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Actividad 3 - EFECTO INSECTICIDAS</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Valcárcel Herrera </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<section id="instalación-de-paquetes" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="instalación-de-paquetes"><span class="header-section-number">1.1</span> Instalación de paquetes</h2>
<p>Instalamos en primer lugar los paquetes necesarios:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"lme4"</span>)){<span class="fu">install.packages</span>(<span class="st">"lme4"</span>)}</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"nlme"</span>)){<span class="fu">install.packages</span>(<span class="st">"nlme"</span>)}</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"lmerTest"</span>)){<span class="fu">install.packages</span>(<span class="st">"lmerTest"</span>)}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"glmmTMB"</span>)){<span class="fu">install.packages</span>(<span class="st">"glmmTMB"</span>)}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"MCMCglmm"</span>)){<span class="fu">install.packages</span>(<span class="st">"MCMCglmm"</span>)}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"car"</span>)){<span class="fu">install.packages</span>(<span class="st">"car"</span>)}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"dplyr"</span>)){<span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"GAD"</span>)){<span class="fu">install.packages</span>(<span class="st">"GAD"</span>)}</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggplot2"</span>)){<span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"DHARMa"</span>)){<span class="fu">install.packages</span>(<span class="st">"DHARMa"</span>)}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"emmeans"</span>)){<span class="fu">install.packages</span>(<span class="st">"emmeans"</span>)}</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"multcomp"</span>)){<span class="fu">install.packages</span>(<span class="st">"multcomp"</span>)}</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"multcompView"</span>)){<span class="fu">install.packages</span>(<span class="st">"multcompView"</span>)}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"fitdistrplus"</span>)){<span class="fu">install.packages</span>(<span class="st">"fitdistrplus"</span>)}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"betareg"</span>)){<span class="fu">install.packages</span>(<span class="st">"betareg"</span>)}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"statmod"</span>)){<span class="fu">install.packages</span>(<span class="st">"statmod"</span>)}</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"brms"</span>)){<span class="fu">install.packages</span>(<span class="st">"brms"</span>)}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"rstan"</span>)){<span class="fu">install.packages</span>(<span class="st">"rstan"</span>)}</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"vegan"</span>)){<span class="fu">install.packages</span>(<span class="st">"vegan"</span>)}</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readxl"</span>)){<span class="fu">install.packages</span>(<span class="st">"readxl"</span>)}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"data.tree"</span>)){<span class="fu">install.packages</span>(<span class="st">"data.tree"</span>)}</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"DiagrammeR"</span>)){<span class="fu">install.packages</span>(<span class="st">"DiagrammeR"</span>)}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"PMCMRplus"</span>)){<span class="fu">install.packages</span>(<span class="st">"PMCMRplus"</span>)}</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"performance"</span>)){<span class="fu">install.packages</span>(<span class="st">"performance"</span>)}</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"MuMIn"</span>)){<span class="fu">install.packages</span>(<span class="st">"MuMIn"</span>)}</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"goftest"</span>)){<span class="fu">install.packages</span>(<span class="st">"goftest"</span>)}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"nortest"</span>)){<span class="fu">install.packages</span>(<span class="st">"nortest"</span>)}</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"knitr"</span>)){<span class="fu">install.packages</span>(<span class="st">"knitr"</span>)}</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"kableExtra"</span>)){<span class="fu">install.packages</span>(<span class="st">"kableExtra"</span>)}</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"factoextra"</span>)){<span class="fu">install.packages</span>(<span class="st">"factoextra"</span>)}</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"cluster"</span>)){<span class="fu">install.packages</span>(<span class="st">"cluster"</span>)}</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(transport)) <span class="fu">install.packages</span>(<span class="st">"transport"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="análisis-de-insecticidas-en-2017" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Análisis de insecticidas en 2017</h1>
<section id="primera-observación-de-los-datos" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="primera-observación-de-los-datos"><span class="header-section-number">2.1</span> Primera observación de los datos</h2>
<p>Ahora hacemos un summary de los datos y unas primeras observaciones. No se muestra el summary ni los table por confidencialidad de los datos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Vemos los datos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>arbol1 <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"C:/Users/dvalh/Desktop/UA/MatesUA/Prácticas de empresa + privado/Datos actividad 3/DATOS PREPROCESADO_INSECTICIDAS.txt"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Haríamos el summary y table para ver outliers, datos faltantes o extraños para hacer data cleaning posteriormente y variabilidad a simple vista en los datos.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y hacemos un par de tables y observamos los factores a tratar:</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(arbol1<span class="sc">$</span>Trt)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(arbol1<span class="sc">$</span>Trt, arbol1<span class="sc">$</span>periodo)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(arbol1<span class="sc">$</span>PLOT, arbol1<span class="sc">$</span>periodo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Factor tratamiento:"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol1<span class="sc">$</span>Trt)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Factor periodo:"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol1<span class="sc">$</span>periodo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="primeros-boxplot" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="primeros-boxplot"><span class="header-section-number">2.2</span> Primeros boxplot</h2>
<p>Convertimos en factores las variables year, Trt, PLOT y periodo y hacemos los boxplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Boxplot treatment observación</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>yearf <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol1<span class="sc">$</span>year)        <span class="co"># si quieres tratar años como factor</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>Trtf  <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol1<span class="sc">$</span>Trt, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"7"</span>,<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>,<span class="st">"6"</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>PLOTf <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol1<span class="sc">$</span>PLOT)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>periodof <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol1<span class="sc">$</span>periodo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Boxplot básico de tratamiento</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad, <span class="at">fill =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626</span><span class="sc">\n</span><span class="st">200 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626</span><span class="sc">\n</span><span class="st">400 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626</span><span class="sc">\n</span><span class="st">400 ml/ha</span><span class="sc">\n</span><span class="st">(A)"</span>, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD</span><span class="sc">\n</span><span class="st">750 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span>, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD</span><span class="sc">\n</span><span class="st">750 ml/ha</span><span class="sc">\n</span><span class="st">(A)"</span>, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KARATE ZEON 10CS</span><span class="sc">\n</span><span class="st">250 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>, <span class="st">"#1F78B4"</span>, <span class="st">"#B2DF8A"</span>, <span class="st">"#33A02C"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>, <span class="st">"#E31A1C"</span>, <span class="st">"#FDBF6F"</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Boxplot of % Mortality by Treatment"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad, <span class="at">fill =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626</span><span class="sc">\n</span><span class="st">200 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626</span><span class="sc">\n</span><span class="st">400 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626</span><span class="sc">\n</span><span class="st">400 ml/ha</span><span class="sc">\n</span><span class="st">(A)"</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD</span><span class="sc">\n</span><span class="st">750 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span>, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD</span><span class="sc">\n</span><span class="st">750 ml/ha</span><span class="sc">\n</span><span class="st">(A)"</span>, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KARATE ZEON 10CS</span><span class="sc">\n</span><span class="st">250 ml/ha</span><span class="sc">\n</span><span class="st">(B)"</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>, <span class="st">"#1F78B4"</span>, <span class="st">"#B2DF8A"</span>, <span class="st">"#33A02C"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>, <span class="st">"#E31A1C"</span>, <span class="st">"#FDBF6F"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Violinplot of % Mortality by Treatment"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados"><span class="header-section-number">2.3</span> P1 - ¿Qué insecticida es más efectivo? Planteamiento de varios modelos lineales generalizados</h2>
<section id="qué-distribución-podría-fittear-bien-los-datos" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="qué-distribución-podría-fittear-bien-los-datos"><span class="header-section-number">2.3.1</span> ¿Qué distribución podría fittear bien los datos?</h3>
<p>Vemos en detalle qué modelo puede fittear bien los residuos con la función descdist del paquete fitdistrplus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fitdistrplus) </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">descdist</span>(arbol1<span class="sc">$</span>mortalidad, <span class="at">boot =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>summary statistics
------
min:  0   max:  100 
median:  33.04598 
mean:  41.18343 
estimated sd:  28.00391 
estimated skewness:  0.5073424 
estimated kurtosis:  2.15807 </code></pre>
</div>
</div>
<p>Así, ahora probaremos varios glms para ver cuál fittea mejor el modelo.</p>
</section>
<section id="modelo-1-modelo-lineal-mixto-con-lmer" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="modelo-1-modelo-lineal-mixto-con-lmer"><span class="header-section-number">2.3.2</span> Modelo 1: Modelo lineal mixto con lmer</h3>
<p>Usamos la función lmer del paquete lme4 para ver nuestro primer modelo y printeamos un summary inicial del mismo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1 (lmer, modelo lineal mixto, family = gaussian)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>modelo_lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>PLOTf), <span class="at">data =</span> arbol1)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(modelo_lmer))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad ~ Trtf + (1 | PLOTf)
   Data: arbol1

REML criterion at convergence: 2960.2

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.90964 -0.60975  0.06809  0.61705  2.71206 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept)  61.03    7.812  
 Residual             408.14   20.202  
Number of obs: 336, groups:  PLOTf, 28

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   19.750      4.874 21.000   4.052 0.000574 ***
Trtf1         15.852      6.893 21.000   2.300 0.031827 *  
Trtf2         20.290      6.893 21.000   2.943 0.007762 ** 
Trtf3         17.855      6.893 21.000   2.590 0.017081 *  
Trtf4         57.838      6.893 21.000   8.390 3.81e-08 ***
Trtf5          3.059      6.893 21.000   0.444 0.661740    
Trtf6         35.139      6.893 21.000   5.098 4.76e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.707                                   
Trtf2 -0.707  0.500                            
Trtf3 -0.707  0.500  0.500                     
Trtf4 -0.707  0.500  0.500  0.500              
Trtf5 -0.707  0.500  0.500  0.500  0.500       
Trtf6 -0.707  0.500  0.500  0.500  0.500  0.500</code></pre>
</div>
</div>
<p>Usamos la librería DHARMa para estudiar si los residuos siguen la distribución apropiada y hay homogeneidad de varianzas dentro de los grupos y entre los grupos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>residuos_simulados1 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_lmer)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La normalidad de los residuos se cumple pero no así la homocedasticidad. En cualquier caso seguimos analizando este modelo.</p>
<p>Vemos el <span class="math inline">\(R^2\)</span> marginal (porcentaje de varianza explicada por efectos fijos) y condicional (porcentaje de varianza explicada por efectos fijos + aleatorios) para el factor fijo Trt y el aleatorio Plots. Como estamos en un modelo lineal mixto, no hace falta añadir la varianza del enlace con distribución, ya que el enlace es la identidad y estamos en el caso gaussiano:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar si es necesario</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("MuMIn")</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular R² marginal (efectos fijos) y condicional (fijos + aleatorios)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>r2_values <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(modelo_lmer)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer R² marginal (porcentaje de variabilidad explicada por Trtf)</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>porcentaje_trtf <span class="ot">&lt;-</span> r2_values[<span class="dv">1</span>, <span class="st">"R2m"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Trtf explains"</span>, <span class="fu">round</span>(porcentaje_trtf, <span class="dv">2</span>), <span class="st">"% de la variabilidad"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Trtf explains 41.84 % de la variabilidad"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>porcentaje_total <span class="ot">&lt;-</span> r2_values[<span class="dv">1</span>, <span class="st">"R2c"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Trtf+Plotf explica el"</span>, <span class="fu">round</span>(porcentaje_total, <span class="dv">2</span>), <span class="st">"% de la variabilidad"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Trtf+Plotf explica el 49.4 % de la variabilidad"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>porcentaje_plotf <span class="ot">&lt;-</span> porcentaje_total <span class="sc">-</span> porcentaje_trtf</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Plotf explica el"</span>, <span class="fu">round</span>(porcentaje_plotf, <span class="dv">2</span>), <span class="st">"% de la variabilidad"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Plotf explica el 7.57 % de la variabilidad"</code></pre>
</div>
</div>
<p>Podemos también ver los intervalos de confianza: de los coeficientes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(modelo_lmer, <span class="at">method =</span> <span class="st">"profile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing profile confidence intervals ...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                2.5 %    97.5 %
.sig01       3.042609  9.627538
.sigma      18.706204 21.909120
(Intercept) 11.184562 28.315822
Trtf1        3.738516 27.965776
Trtf2        8.176176 32.403436
Trtf3        5.741029 29.968289
Trtf4       45.723887 69.951147
Trtf5       -9.054495 15.172765
Trtf6       23.025765 47.253025</code></pre>
</div>
</div>
<p>Y un análisis de la deviance con el test <span class="math inline">\(\chi^2\)</span> proporcionado por el test de Wald (tipo II):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad
      Chisq Df Pr(&gt;Chisq)    
Trtf 99.136  6  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>De forma similar pero usando el test de razón de verosimilitudes (TRV) con el estadístico <span class="math inline">\(\Lambda\)</span> correspondiente que aproxima a una <span class="math inline">\(\chi^2(6)\)</span> en vez del test de Wald (tipo II) que también usa <span class="math inline">\(\chi^2(6)\)</span>:</p>
<p>Vemos las diferencias entre las medias marginales más en detalle con emeans usando el test FDR:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>Trtf <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol1<span class="sc">$</span>Trtf,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"7"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>emmeans_trat11 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo_lmer, <span class="sc">~</span> Trtf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 methods overwritten by 'broom':
  method        from 
  nobs.fitdistr MuMIn
  nobs.multinom MuMIn</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>emmeans_trat11</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL
 7      19.8 4.87 21     9.61     29.9
 1      35.6 4.87 21    25.47     45.7
 2      40.0 4.87 21    29.90     50.2
 3      37.6 4.87 21    27.47     47.7
 4      77.6 4.87 21    67.45     87.7
 5      22.8 4.87 21    12.67     32.9
 6      54.9 4.87 21    44.75     65.0

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>comparaciones11 <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans_trat11, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>comparaciones11</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast      estimate   SE df t.ratio p.value
 Trtf7 - Trtf1   -15.85 6.89 21  -2.300  0.0477
 Trtf7 - Trtf2   -20.29 6.89 21  -2.943  0.0181
 Trtf7 - Trtf3   -17.85 6.89 21  -2.590  0.0326
 Trtf7 - Trtf4   -57.84 6.89 21  -8.390  &lt;.0001
 Trtf7 - Trtf5    -3.06 6.89 21  -0.444  0.7314
 Trtf7 - Trtf6   -35.14 6.89 21  -5.098  0.0002
 Trtf1 - Trtf2    -4.44 6.89 21  -0.644  0.6145
 Trtf1 - Trtf3    -2.00 6.89 21  -0.290  0.7743
 Trtf1 - Trtf4   -41.99 6.89 21  -6.091  &lt;.0001
 Trtf1 - Trtf5    12.79 6.89 21   1.856  0.0958
 Trtf1 - Trtf6   -19.29 6.89 21  -2.798  0.0226
 Trtf2 - Trtf3     2.44 6.89 21   0.353  0.7638
 Trtf2 - Trtf4   -37.55 6.89 21  -5.447  0.0001
 Trtf2 - Trtf5    17.23 6.89 21   2.500  0.0336
 Trtf2 - Trtf6   -14.85 6.89 21  -2.154  0.0573
 Trtf3 - Trtf4   -39.98 6.89 21  -5.800  &lt;.0001
 Trtf3 - Trtf5    14.80 6.89 21   2.146  0.0573
 Trtf3 - Trtf6   -17.28 6.89 21  -2.507  0.0336
 Trtf4 - Trtf5    54.78 6.89 21   7.947  &lt;.0001
 Trtf4 - Trtf6    22.70 6.89 21   3.293  0.0091
 Trtf5 - Trtf6   -32.08 6.89 21  -4.654  0.0004

Degrees-of-freedom method: kenward-roger 
P value adjustment: fdr method for 21 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Veo las letras que le corresponden a cada tratamiento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cld</span>(emmeans_trat11, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 7      19.8 4.87 21     5.23     34.3  a    
 5      22.8 4.87 21     8.28     37.3  ab   
 1      35.6 4.87 21    21.08     50.1   bc  
 3      37.6 4.87 21    23.08     52.1   bc  
 2      40.0 4.87 21    25.52     54.6    cd 
 6      54.9 4.87 21    40.36     69.4     d 
 4      77.6 4.87 21    63.06     92.1      e

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 7 estimates 
P value adjustment: fdr method for 21 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>Es un modelo relativamente bueno, es verdad que la homogeneidad falla pero al menos tenemos normalidad, con lo que la eficiencia del test bajará pero nos podría servir. Vemos que el mayor efecto respecto al control es con el tratamiento 4, seguido del 6 y el 2 (sin diferencia entre estos estadísticamente significativa).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>letras <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y.pos =</span> <span class="fu">max</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">Trtf =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"7"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">levels</span>(arbol1<span class="sc">$</span>Trtf)),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">letra =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"bc"</span>, <span class="st">"cd"</span>, <span class="st">"bc"</span>, <span class="st">"e"</span>, <span class="st">"ab"</span>, <span class="st">"d"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">by =</span> <span class="st">"Trtf"</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad, <span class="at">fill =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> letras, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> y.pos, <span class="at">label =</span> letra), </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">110</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>)) <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>, <span class="st">"#1F78B4"</span>, <span class="st">"#B2DF8A"</span>, <span class="st">"#33A02C"</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>, <span class="st">"#E31A1C"</span>, <span class="st">"#FDBF6F"</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot % Mortalidad"</span>, <span class="at">x =</span> <span class="fu">expression</span>(<span class="st">"Tratamiento"</span>), <span class="at">y =</span> <span class="st">"% Mortalidad"</span>) <span class="sc">+</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Asumiendo que 'letras' ya está creado como antes</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad, <span class="at">color =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>   <span class="co"># puntos con algo de dispersión horizontal</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> letras, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> y.pos, <span class="at">label =</span> letra), </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">110</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"7"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"1"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"2"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"3"</span>, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"4"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"5"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"6"</span>)) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>, <span class="st">"#1F78B4"</span>, <span class="st">"#B2DF8A"</span>, <span class="st">"#33A02C"</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>, <span class="st">"#E31A1C"</span>, <span class="st">"#FDBF6F"</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Dotplot % Mortalidad"</span>, <span class="at">x =</span> <span class="fu">expression</span>(<span class="st">"Tratamiento"</span>), <span class="at">y =</span> <span class="st">"% Mortalidad"</span>) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ahora los superponemos y los ponemos bonito (y en inglés):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate label positions and group letters</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>arbletras <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y.pos =</span> <span class="fu">max</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">Trtf =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"7"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">levels</span>(arbol1<span class="sc">$</span>Trtf)),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">arbletter =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"bc"</span>, <span class="st">"cd"</span>, <span class="st">"bc"</span>, <span class="st">"e"</span>, <span class="st">"ab"</span>, <span class="st">"d"</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">by =</span> <span class="st">"Trtf"</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampled data for dotplot (e.g., 70% of points)</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>arbol1_jitter <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Thinner transparent boxplots with colored borders</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> Trtf), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Jittered points (reduced number, smaller, filled with their color)</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbol1_jitter,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> Trtf, <span class="at">fill =</span> Trtf),</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="fl">0.1</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Significance letters</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> arbletras, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> y.pos, <span class="at">label =</span> arbletter),</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Axis and labels</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">120</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span>, </span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"GF-2626 (200 ml/ha, FOL)"</span>, </span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF-2626 (400 ml/ha, FOL)"</span>,</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"GF-2626 (400 ml/ha, INJ)"</span>,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOL)"</span>,</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"CONFIDOR 200 OD (750 ml/ha, INJ)"</span>,</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"KARATE ZEON 10CS (250 ml/ha, FOL)"</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"#A6CEE3"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#1F78B4"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#B2DF8A"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#33A02C"</span>,</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#FB9A99"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#E31A1C"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#FDBF6F"</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"#A6CEE3"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#1F78B4"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#B2DF8A"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#33A02C"</span>,</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#FB9A99"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#E31A1C"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#FDBF6F"</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.2</span>),</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ahora para finalizar, procedemos a extraer las predicciones de los efectos aleatorios del modelo (sus esperanzas condicionales que minimizarían el error cuadrático medio), también conocidas como <strong>best linear unbiased predictions</strong> (BLUPs). Estas estimaciones nos permiten conocer, por ejemplo, cómo varía la respuesta en cada nivel del efecto aleatorio una vez tenida en cuenta la estructura fija del modelo. Dicho de otro modo, los BLUPs representan los desvíos específicos de cada unidad (como sujetos, escuelas o grupos) respecto al promedio poblacional predicho por los efectos fijos, ajustados por la varianza estimada de los componentes aleatorios. Obtendremos también las parcelas influyentes (que hemos considerado como tales si el BLUP difiere al menos 2 desviaciones estándar respecto a la media).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer efectos aleatorios (BLUPs)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>blups <span class="ot">&lt;-</span> <span class="fu">ranef</span>(modelo_lmer)<span class="sc">$</span>PLOTf</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(blups) <span class="ot">&lt;-</span> <span class="st">"BLUP"</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar parcelas con efectos extremos (más de 2 SD de la media)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>blups<span class="sc">$</span>DesvStd <span class="ot">&lt;-</span> <span class="fu">scale</span>(blups<span class="sc">$</span>BLUP)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>parcelas_influyentes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(blups)[<span class="fu">abs</span>(blups<span class="sc">$</span>DesvStd) <span class="sc">&gt;</span> <span class="fl">1.5</span>]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parcelas_influyentes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "101" "102" "206"</code></pre>
</div>
</div>
<p>Por último, graficamos los BLUPs con sus intervalos de confianza:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot</span>(<span class="fu">ranef</span>(modelo_lmer, <span class="at">condVar =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$PLOTf</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Extract BLUPs with conditional variances</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>blups <span class="ot">&lt;-</span> <span class="fu">ranef</span>(modelo_lmer, <span class="at">condVar =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>blup_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(blups<span class="sc">$</span>PLOTf)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>PLOTf <span class="ot">&lt;-</span> <span class="fu">rownames</span>(blups<span class="sc">$</span>PLOTf)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract conditional variances and calculate SEs</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>post_vars <span class="ot">&lt;-</span> <span class="fu">attr</span>(blups<span class="sc">$</span>PLOTf, <span class="st">"postVar"</span>)[<span class="dv">1</span>, <span class="dv">1</span>, ]  <span class="co"># vector of variances</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(post_vars)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>se <span class="ot">&lt;-</span> se</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>lower <span class="ot">&lt;-</span> blup_df<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> se</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>upper <span class="ot">&lt;-</span> blup_df<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> se</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Ensure only one row per PLOTf in arbol1</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>Trtf <span class="ot">&lt;-</span> arbol1[<span class="sc">!</span><span class="fu">duplicated</span>(arbol1<span class="sc">$</span>PLOTf), <span class="fu">c</span>(<span class="st">"PLOTf"</span>, <span class="st">"Trtf"</span>)]</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Merge treatment info</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>blup_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(blup_df, Trtf, <span class="at">by =</span> <span class="st">"PLOTf"</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Order factor PLOTf by BLUP</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>blup_df <span class="ot">&lt;-</span> blup_df <span class="sc">%&gt;%</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PLOTf =</span> <span class="fu">factor</span>(PLOTf, <span class="at">levels =</span> PLOTf))</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Plot with error bars</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(blup_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">y =</span> PLOTf, <span class="at">color =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">height =</span> <span class="fl">0.2</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#A6CEE3"</span>, <span class="st">"#1F78B4"</span>, <span class="st">"#B2DF8A"</span>, <span class="st">"#33A02C"</span>,</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#FB9A99"</span>, <span class="st">"#E31A1C"</span>, <span class="st">"#FDBF6F"</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"UNTREATED"</span>,</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"GF-2626 (200 ml/ha, FOL)"</span>,</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"GF-2626 (400 ml/ha, FOL)"</span>,</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">"GF-2626 (400 ml/ha, INJ)"</span>,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOL)"</span>,</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CONFIDOR 200 OD (750 ml/ha, INJ)"</span>,</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>      <span class="st">"KARATE ZEON 10CS (250 ml/ha, FOL)"</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"BLUPs by Plot with 95% Confidence Intervals"</span>,</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Intercept BLUP"</span>,</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plot (PLOTf)"</span>,</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Treatment"</span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos que el efecto aleatorio de la parcela tiene un efecto significativo en la mortalidad además del efecto fijo del tratamiento como tal, ya que tenemos parcelas a las que se les aplica el mismo tratamiento y cuyos BLUPs para el intercepto/control (mejores predictores lineales insesgados) son completamente opuestos (uno muy por debajo del promedio y otro muy por encima del promedio), como se ve entre las parcelas 101 y 206 para el mismo tratamiento 3, por ejemplo. Sin embargo, también vemos que hay parcelas como la 303 y 404 a las que se les aplica el mismo tratamiento pero no presentan diferencias entre los predictores del intercepto significativas, lo que nos indica que aquí el efecto aleatorio de las parcelas es muy pequeño, en contraste con lo que pasaba con las parcelas 101 y 206. También como referencia podemos coger los boxplots y barplot de la sección anterior.</p>
<p>En resumen, la interpretación es:</p>
<ol type="1">
<li><p><strong>BLUP (eje X)</strong>:</p>
<ul>
<li><p>Representa la desviación de cada parcela respecto al promedio general</p></li>
<li><p>Valores positivos = parcelas con mortalidad <em>por encima</em> del promedio</p></li>
<li><p>Valores negativos = parcelas con mortalidad <em>por debajo</em> del promedio</p></li>
</ul></li>
<li><p><strong>Intervalos de confianza</strong>:</p>
<ul>
<li><p>Si el intervalo cruza cero: La parcela no difiere significativamente del promedio</p></li>
<li><p>Si el intervalo no cruza cero: Efecto significativo (positivo o negativo)</p></li>
</ul></li>
<li><p><strong>Patrones por tratamiento</strong>:</p>
<ul>
<li><p>Agrupamientos de colores similares indicarían que ciertos tratamientos tienden a tener parcelas con efectos similares</p></li>
<li><p>Dispersión de colores mezclados sugeriría que la variabilidad entre parcelas no está fuertemente asociada a los tratamientos</p></li>
</ul></li>
</ol>
</section>
<section id="modelo-1.5-transformación-box-cox-con-lmer" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="modelo-1.5-transformación-box-cox-con-lmer"><span class="header-section-number">2.3.3</span> Modelo 1.5: Transformación Box-Cox con lmer</h3>
<p>Transformamos la variable mortalidad. Hallamos el lambda óptimo para la transformación Box-Cox:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Transformo con Box-Cox</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>boxcox_result <span class="ot">&lt;-</span> <span class="fu">boxcox</span>(arbol1<span class="sc">$</span>mortalidad<span class="fl">+0.000001</span> <span class="sc">~</span> arbol1<span class="sc">$</span>Trtf, <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># El gráfico te indicará el lambda óptimo</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>lambda_optimo <span class="ot">&lt;-</span> boxcox_result<span class="sc">$</span>x[<span class="fu">which.max</span>(boxcox_result<span class="sc">$</span>y)]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lambda_optimo) <span class="co">#0.44444444</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4444444</code></pre>
</div>
</div>
<p>Transformamos mortalidad:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(lambda_optimo) <span class="sc">&lt;</span> <span class="fl">0.01</span>) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  arbol1<span class="sc">$</span>mortalidad_trans <span class="ot">&lt;-</span> <span class="fu">log</span>(arbol1<span class="sc">$</span>mortalidad <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># +1 para evitar log(0)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  arbol1<span class="sc">$</span>mortalidad_trans <span class="ot">&lt;-</span> ((arbol1<span class="sc">$</span>mortalidad <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">^</span>lambda_optimo <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">/</span>lambda_optimo</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comprobamos el modelo con la variable mortalidad transformada:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1.5 (modelo lineal mixto + transformación Box-Cox (mortalidad), family = gaussian)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>modelo_lmert <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_trans <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Trtf<span class="sc">:</span>PLOTf) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>periodof), <span class="at">data =</span> arbol1)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_lmert)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_trans ~ Trtf + (1 | Trtf:PLOTf) + (1 | periodof)
   Data: arbol1

REML criterion at convergence: 1523.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.6083 -0.6282  0.0300  0.6256  3.6437 

Random effects:
 Groups     Name        Variance Std.Dev.
 Trtf:PLOTf (Intercept) 0.9761   0.988   
 periodof   (Intercept) 4.3369   2.083   
 Residual               4.8119   2.194   
Number of obs: 336, groups:  Trtf:PLOTf, 28; periodof, 6

Fixed effects:
            Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)   6.0659     1.0330  9.9606   5.872 0.000159 ***
Trtf1         1.9831     0.8298 21.0002   2.390 0.026308 *  
Trtf2         3.0284     0.8298 21.0002   3.650 0.001497 ** 
Trtf3         2.1901     0.8298 21.0002   2.639 0.015333 *  
Trtf4         7.1004     0.8298 21.0002   8.557 2.75e-08 ***
Trtf5         0.3753     0.8298 21.0002   0.452 0.655683    
Trtf6         4.8225     0.8298 21.0002   5.812 9.07e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.402                                   
Trtf2 -0.402  0.500                            
Trtf3 -0.402  0.500  0.500                     
Trtf4 -0.402  0.500  0.500  0.500              
Trtf5 -0.402  0.500  0.500  0.500  0.500       
Trtf6 -0.402  0.500  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_lmert)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad_trans
      Chisq Df Pr(&gt;Chisq)    
Trtf 108.61  6  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>residuos_simulados1h <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_lmert)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados1h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No nos sirve, no tenemos homogeneidad de varianza entre grupos ni KS se cumple.</p>
</section>
<section id="modelo-2-modelo-lineal-generalizado-mixto-transformación-datos-family-beta" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="modelo-2-modelo-lineal-generalizado-mixto-transformación-datos-family-beta"><span class="header-section-number">2.3.4</span> Modelo 2: Modelo lineal generalizado mixto + Transformación datos, family = beta)</h3>
<p>Notemos que el soporte de la distribución beta es <span class="math inline">\((0,1)\)</span> por lo que tendremos que transformar los datos de la siguiente manera:</p>
<p><span class="math display">\[
\begin{align}
mortalidad_{esc} &amp;= \frac{mortalidad - \min(mortalidad)}{\max(mortalidad) - \min(mortalidad)}\\
&amp;= \frac{mortalidad}{100}
\end{align}
\]</span></p>
<p>Y posteriormente, para evitar valores de 0 y 1 en <span class="math inline">\(mortalidad_{esc}\)</span>, tomamos <span class="math inline">\(\epsilon = 10^{-4} &gt; 0\)</span> y cambiamos los valores del vector <span class="math inline">\(mortalidad_{esc}\)</span> que valgan 0 por <span class="math inline">\(\epsilon\)</span> y los que valgan 1 por <span class="math inline">\(1-\epsilon\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalado lineal al rango (0, 1)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>mortalidad_esc <span class="ot">&lt;-</span> (arbol1<span class="sc">$</span>mortalidad <span class="sc">-</span> <span class="fu">min</span>(arbol1<span class="sc">$</span>mortalidad)) <span class="sc">/</span> (<span class="fu">max</span>(arbol1<span class="sc">$</span>mortalidad) <span class="sc">-</span> <span class="fu">min</span>(arbol1<span class="sc">$</span>mortalidad))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar valores 0 y 1</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fl">1e-4</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>mortalidad_esc[arbol1<span class="sc">$</span>mortalidad_esc <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> epsilon</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>mortalidad_esc[arbol1<span class="sc">$</span>mortalidad_esc <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> epsilon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora fitteamos el modelo y vemos si los residuos cumplen las hipótesis del modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statmod)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>modelo_glmmbeta <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(mortalidad_esc <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Trtf<span class="sc">:</span>PLOTf) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>periodof), <span class="at">family =</span> <span class="fu">beta_family</span>(), <span class="at">data =</span> arbol1)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_glmmbeta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: beta  ( logit )
Formula:          mortalidad_esc ~ Trtf + (1 | Trtf:PLOTf) + (1 | periodof)
Data: arbol1

      AIC       BIC    logLik -2*log(L)  df.resid 
   -330.6    -292.4     175.3    -350.6       326 

Random effects:

Conditional model:
 Groups     Name        Variance Std.Dev.
 Trtf:PLOTf (Intercept) 0.2401   0.4900  
 periodof   (Intercept) 0.4528   0.6729  
Number of obs: 336, groups:  Trtf:PLOTf, 28; periodof, 6

Dispersion parameter for beta family (): 4.99 

Conditional model:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.32057    0.39109  -3.377 0.000734 ***
Trtf1        0.50613    0.38895   1.301 0.193157    
Trtf2        0.90870    0.38995   2.330 0.019789 *  
Trtf3        1.06466    0.38947   2.734 0.006264 ** 
Trtf4        2.91661    0.39665   7.353 1.94e-13 ***
Trtf5        0.06288    0.39256   0.160 0.872736    
Trtf6        1.49174    0.39149   3.810 0.000139 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_glmmbeta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad_esc
      Chisq Df Pr(&gt;Chisq)    
Trtf 76.275  6  2.097e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>DHARMa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>residuos_simulados3 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_glmmbeta)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Falla las condiciones de homogeneidad de varianzas entre grupos y dentro de los grupos y también la hipótesis sobre la distribución de los residuos.</p>
</section>
<section id="modelo-3-inferencia-bayesiana-con-brms" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5" class="anchored" data-anchor-id="modelo-3-inferencia-bayesiana-con-brms"><span class="header-section-number">2.3.5</span> Modelo 3 (inferencia bayesiana con brms)</h3>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Comentar si va lento</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo_brms &lt;- brm(</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   mortalidad ~ Trtf + (1|Trtf:PLOTf) + (1|periodof),</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = arbol1,</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   family = gaussian(),    # Cambia a binomial, poisson, etc., según tu variable respuesta</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   chains = 4,             # Número de cadenas MCMC</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   iter = 2000,            # Número de iteraciones por cadena</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   warmup = 1000,          # Iteraciones de calentamiento</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   cores = 4,              # Núcleos a usar en paralelo</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   seed = 123              # Semilla para reproducibilidad</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(modelo_brms)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizar posterior completo de los parámetros:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(conditional_effects(modelo_brms), ask = FALSE)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(modelo_brms, ask = FALSE)  # Densidades posteriores + cadenas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6" class="anchored" data-anchor-id="modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad"><span class="header-section-number">2.3.6</span> Modelo 4: modelo lineal con nlme con heterocedasticidad</h3>
<p>Hacemos un modelo lineal mixto ajustado con pesos en los residuos para atajar la heterocedasticidad.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>modelo_11_nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  mortalidad <span class="sc">~</span> Trtf,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> PLOTf,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol1,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Trtf),  <span class="co"># Permite varianzas distintas por nivel de Trtf</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by REML
  Data: arbol1 
       AIC      BIC    logLik
  2939.663 2996.604 -1454.831

Random effects:
 Formula: ~1 | PLOTf
        (Intercept) Residual
StdDev:    3.690294 29.26399

Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | Trtf 
 Parameter estimates:
        3         4         7         5         1         6         2 
1.0000000 0.7617752 0.3296426 0.5190040 0.7914272 0.7284863 0.6657033 
Fixed effects:  mortalidad ~ Trtf 
               Value Std.Error  DF   t-value p-value
(Intercept) 19.75019  2.311553 308  8.544124  0.0000
Trtf1       15.85215  4.463502  21  3.551504  0.0019
Trtf2       20.28981  4.080980  21  4.971798  0.0001
Trtf3       17.85466  5.156463  21  3.462579  0.0023
Trtf4       57.83752  4.370487  21 13.233655  0.0000
Trtf5        3.05914  3.681530  21  0.830941  0.4154
Trtf6       35.13939  4.268029  21  8.233168  0.0000
 Correlation: 
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.518                                   
Trtf2 -0.566  0.293                            
Trtf3 -0.448  0.232  0.254                     
Trtf4 -0.529  0.274  0.300  0.237              
Trtf5 -0.628  0.325  0.356  0.281  0.332       
Trtf6 -0.542  0.280  0.307  0.243  0.286  0.340

Standardized Within-Group Residuals:
        Min          Q1         Med          Q3         Max 
-2.66252225 -0.77443275  0.04126435  0.72864408  2.68405714 

Number of Observations: 336
Number of Groups: 28 </code></pre>
</div>
</div>
<p>Veo test de Kolmogorov (n &gt; 50) para ver normalidad (aquí DHARMa no funciona). Nótese que normalizamos los residuos para la validación del modelo por las tres razones siguientes:</p>
<section id="los-residuos-crudos-type-response-no-tienen-en-cuenta-la-estructura-de-varianza-modelada" class="level4" data-number="2.3.6.1">
<h4 data-number="2.3.6.1" class="anchored" data-anchor-id="los-residuos-crudos-type-response-no-tienen-en-cuenta-la-estructura-de-varianza-modelada"><span class="header-section-number">2.3.6.1</span> 1. <strong>Los residuos crudos (<code>type = "response"</code>) no tienen en cuenta la estructura de varianza modelada</strong></h4>
<ul>
<li><p>En modelos <code>lme</code>, si modelas diferentes varianzas para cada grupo (como <code>Trtf</code>), los residuos crudos <strong>reflejan esa heterogeneidad</strong>: pueden parecer más dispersos en unos tratamientos que en otros.</p></li>
<li><p>Esto <strong>distorsiona</strong> el diagnóstico de normalidad porque <strong>mide residuos con escalas distintas</strong>, lo que puede llevar a rechazar la normalidad cuando en realidad es por culpa de la varianza no homogénea (ya modelada).</p></li>
</ul>
</section>
<section id="los-residuos-normalizados-sí-están-ajustados-por-la-heterocedasticidad" class="level4" data-number="2.3.6.2">
<h4 data-number="2.3.6.2" class="anchored" data-anchor-id="los-residuos-normalizados-sí-están-ajustados-por-la-heterocedasticidad"><span class="header-section-number">2.3.6.2</span> 2. <strong>Los residuos <em>normalizados</em> sí están ajustados por la heterocedasticidad</strong></h4>
<ul>
<li><p>Los residuos normalizados (<code>type = "normalized"</code>) <strong>se dividen por el desvío estándar estimado en cada nivel/grupo</strong>, ajustando por la estructura <code>varIdent</code> u otras (como <code>varPower</code>, etc.).</p></li>
<li><p>Esto genera residuos <strong>comparablemente escalados</strong>, apropiados para pruebas de normalidad.</p></li>
</ul>
</section>
<section id="evaluar-normalidad-con-residuos-normalizados-da-una-evaluación-más-justa-del-supuesto-de-normalidad-del-modelo-especificado" class="level4" data-number="2.3.6.3">
<h4 data-number="2.3.6.3" class="anchored" data-anchor-id="evaluar-normalidad-con-residuos-normalizados-da-una-evaluación-más-justa-del-supuesto-de-normalidad-del-modelo-especificado"><span class="header-section-number">2.3.6.3</span> 3. <strong>Evaluar normalidad con residuos normalizados da una evaluación más justa del supuesto de normalidad del modelo especificado</strong></h4>
<ul>
<li><p>Dado que el modelo ya permite varianzas distintas, no es justo evaluar los residuos crudos bajo el supuesto de varianza constante.</p></li>
<li><p>Evaluar la normalidad en los residuos normalizados <strong>te dice si, <em>dadas las varianzas especificadas</em>, los errores se distribuyen normalmente</strong>, que es lo que realmente importa para la validez de inferencias en <code>lme</code>.</p></li>
</ul>
<p>Así, hacemos un diagnóstico completo del modelo. Utilizaremos bootstrapping paramétrico sobre el estadístico de Anderson-Darling (simulamos su distribución) ya que el test original de Anderson-Darling (o Kolmogorov-Smirnov, pero AD es generalmente más robusto y potente, sobre todo en las colas de la distribución) no se debería utilizar aquí. Las pruebas clásicas de bondad del ajuste (AD, KS, CvM, etc.) NO deberían usarse directamente cuando los parámetros teóricos de la distribución se estiman a partir de los datos. Estas pruebas fueron diseñadas suponiendo que los parámetros de la distribución de referencia son <strong>conocidos de antemano y fijos</strong>, no estimados de la muestra. Si se usan los datos tanto para estimar los parámetros como para evaluar el ajuste, la <strong>distribución teórica bajo la hipótesis nula cambia</strong>: ya no es la misma que se deriva bajo el supuesto de parámetros conocidos.<br>
<br>
Implemento una función <code>test_ad_bootstrap_normaliz</code> para que se pueda utilizar posteriormente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(goftest)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>test_ad_bootstrap_normaliz <span class="ot">&lt;-</span> <span class="cf">function</span>(modelo, <span class="at">breaks_stat =</span> <span class="dv">30</span>, <span class="at">breaks_resid =</span> <span class="dv">15</span>, <span class="at">n_boot =</span> <span class="dv">3000</span>, <span class="at">seed =</span> <span class="dv">123</span>) {</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  res_norm <span class="ot">&lt;-</span> <span class="fu">resid</span>(modelo, <span class="at">type =</span> <span class="st">"normalized"</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(res_norm)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estadístico observado AD a partir de mis residuos normalizados</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  ad_obs <span class="ot">&lt;-</span> goftest<span class="sc">::</span><span class="fu">ad.test</span>(res_norm, <span class="at">null =</span> <span class="st">"pnorm"</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mean =</span> <span class="fu">mean</span>(res_norm), <span class="at">sd =</span> <span class="fu">sd</span>(res_norm))<span class="sc">$</span>statistic</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bootstrap paramétrico (simulo la distribución del estadístico #AD bajo H0, o sea, suponiendo y generando residuos normales #estimando media y sd)</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  ad_boot <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_boot, {</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    r_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="fu">mean</span>(res_norm), <span class="at">sd =</span> <span class="fu">sd</span>(res_norm))</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    goftest<span class="sc">::</span><span class="fu">ad.test</span>(r_sim, <span class="at">null =</span> <span class="st">"pnorm"</span>,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> <span class="fu">mean</span>(res_norm), <span class="at">sd =</span> <span class="fu">sd</span>(res_norm))<span class="sc">$</span>statistic</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  p_boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(ad_boot <span class="sc">&gt;=</span> ad_obs) <span class="co">#Proporción de estadísticos #simulados más extremos que el observado (me da el p-valor empírico).</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Histograma comparando la distribución del estadístico AD bajo #H0 con el valor del estadístico AD en base a mis datos</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(ad_boot, <span class="at">breaks =</span> breaks_stat, <span class="at">col =</span> <span class="st">"gray"</span>,</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Distribución Bootstrap AD -"</span>, <span class="fu">deparse</span>(<span class="fu">substitute</span>(modelo))),</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">"Estadístico AD (simulado bajo H0)"</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> ad_obs, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"Obs ="</span>, <span class="fu">round</span>(ad_obs, <span class="dv">3</span>)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Gráfico Q-Q para ver (a ojo) normalidad de los residuos</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqnorm</span>(res_norm, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Q-Q plot residuos normalizados -"</span>, <span class="fu">deparse</span>(<span class="fu">substitute</span>(modelo))))</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqline</span>(res_norm, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Histograma de los residuos normalizados en contraste con N(0,1)</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(res_norm, <span class="at">breaks =</span> breaks_resid, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Histograma residuos normalizados -"</span>, <span class="fu">deparse</span>(<span class="fu">substitute</span>(modelo))),</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fu">mean</span>(res_norm), <span class="at">sd =</span> <span class="fu">sd</span>(res_norm)), <span class="at">add =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Resultado estilo htest (formato para tests estadísticos de R)</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">statistic =</span> <span class="fu">c</span>(<span class="at">AD =</span> <span class="fu">unname</span>(ad_obs)),</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">p.value =</span> p_boot,</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="fu">paste0</span>(<span class="st">"Anderson-Darling con bootstrap paramétrico ("</span>, n_boot, <span class="st">" réplicas)"</span>),</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">data.name =</span> <span class="fu">paste0</span>(<span class="st">"Residuos normalizados de "</span>, <span class="fu">deparse</span>(<span class="fu">substitute</span>(modelo)))</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"htest"</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Así:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_ad_bootstrap_normaliz</span>(modelo_11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling con bootstrap paramétrico (3000 réplicas)

data:  Residuos normalizados de modelo_11_nlme
AD = 1.353, p-value = 0.2143</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 4. R² marginal y condicional (explicación del modelo) ----</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(modelo_11_nlme)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Marginal R² (Treatment):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2m"</span>], <span class="dv">3</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal R² (Treatment): 27.9 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Conditional R² (Treatment + Plots):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2c"</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional R² (Treatment + Plots): 29.077 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance proportion explained by the plots in the model:"</span>, <span class="fu">round</span>((r2[<span class="dv">1</span>, <span class="st">"R2c"</span>] <span class="sc">-</span> r2[<span class="dv">1</span>, <span class="st">"R2m"</span>])<span class="sc">*</span><span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance proportion explained by the plots in the model: 1.128 %</code></pre>
</div>
</div>
<p>Podemos suponer que <strong>el modelo</strong> <strong>verifica las hipótesis de normalidad</strong>, ya que <strong>p &gt; 0.05</strong>. Viendo el qqplot y el histograma consideraremos que hay normalidad. Vemos además si mejora significativamente el modelo lineal mixto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logLik(modelo_lmer)</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># logLik(modelo_11_nlme)</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternativa para más detalle: paso a formato nlme el modelo #homocedástico para compararlos y veo el p-valor (en este caso es mejor #claramente modelo_11_nlme)</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>modelo_lme <span class="ot">&lt;-</span>  <span class="fu">lme</span>(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> mortalidad <span class="sc">~</span> Trtf,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> PLOTf,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol1</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo_lme, modelo_11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Model df      AIC      BIC    logLik   Test  L.Ratio p-value
modelo_lme         1  9 2978.155 3012.319 -1480.077                        
modelo_11_nlme     2 15 2939.663 2996.604 -1454.832 1 vs 2 50.49193  &lt;.0001</code></pre>
</div>
</div>
<p>El modelo que permite varianzas diferentes por tratamiento (<code>modelo_11_nlme</code>) mejora el ajuste. Deberíamos por tanto usar <code>modelo_11_nlme</code> por todo lo anterior, entonces.</p>
<p>Hacemos un análisis de la deviance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_11_nlme, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mortalidad
              Chisq Df Pr(&gt;Chisq)    
(Intercept)  73.002  1  &lt; 2.2e-16 ***
Trtf        225.524  6  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Veamos ahora las diferencias de medias marginales con emeans:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>arbol1<span class="sc">$</span>Trtf <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol1<span class="sc">$</span>Trtf,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"7"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>))</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimamos medias marginales para Trtf con modelo nlme</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>emmeans_trat11_nlme <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo_11_nlme, <span class="sc">~</span> Trtf)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emmeans_trat11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL
 7      19.8 2.31 27     15.0     24.5
 1      35.6 3.82 21     27.7     43.5
 2      40.0 3.36 21     33.0     47.0
 3      37.6 4.61 21     28.0     47.2
 4      77.6 3.71 21     69.9     85.3
 5      22.8 2.87 21     16.9     28.8
 6      54.9 3.59 21     47.4     62.4

Degrees-of-freedom method: containment 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaciones pareadas ajustando p con FDR</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>comparaciones11_nlme <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans_trat11_nlme, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparaciones11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast      estimate   SE df t.ratio p.value
 Trtf7 - Trtf1   -15.85 4.46 21  -3.552  0.0033
 Trtf7 - Trtf2   -20.29 4.08 21  -4.972  0.0002
 Trtf7 - Trtf3   -17.85 5.16 21  -3.463  0.0038
 Trtf7 - Trtf4   -57.84 4.37 21 -13.234  &lt;.0001
 Trtf7 - Trtf5    -3.06 3.68 21  -0.831  0.4591
 Trtf7 - Trtf6   -35.14 4.27 21  -8.233  &lt;.0001
 Trtf1 - Trtf2    -4.44 5.09 21  -0.872  0.4585
 Trtf1 - Trtf3    -2.00 5.99 21  -0.335  0.7413
 Trtf1 - Trtf4   -41.99 5.32 21  -7.887  &lt;.0001
 Trtf1 - Trtf5    12.79 4.77 21   2.680  0.0173
 Trtf1 - Trtf6   -19.29 5.24 21  -3.681  0.0027
 Trtf2 - Trtf3     2.44 5.71 21   0.427  0.7076
 Trtf2 - Trtf4   -37.55 5.01 21  -7.499  &lt;.0001
 Trtf2 - Trtf5    17.23 4.42 21   3.900  0.0017
 Trtf2 - Trtf6   -14.85 4.92 21  -3.020  0.0098
 Trtf3 - Trtf4   -39.98 5.92 21  -6.758  &lt;.0001
 Trtf3 - Trtf5    14.80 5.43 21   2.726  0.0166
 Trtf3 - Trtf6   -17.28 5.84 21  -2.959  0.0105
 Trtf4 - Trtf5    54.78 4.69 21  11.687  &lt;.0001
 Trtf4 - Trtf6    22.70 5.16 21   4.398  0.0006
 Trtf5 - Trtf6   -32.08 4.59 21  -6.987  &lt;.0001

Degrees-of-freedom method: containment 
P value adjustment: fdr method for 21 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot de comparaciones</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>letras11_nlme <span class="ot">&lt;-</span> <span class="fu">cld</span>(emmeans_trat11_nlme, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(letras11_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 7      19.8 2.31 27     13.0     26.5  a    
 5      22.8 2.87 21     14.3     31.3  a    
 1      35.6 3.82 21     24.2     47.0   b   
 3      37.6 4.61 21     23.9     51.3   b   
 2      40.0 3.36 21     30.0     50.1   b   
 6      54.9 3.59 21     44.2     65.6    c  
 4      77.6 3.71 21     66.5     88.6     d 

Degrees-of-freedom method: containment 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 7 estimates 
P value adjustment: fdr method for 21 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>He hecho un gráfico con un boxplot y un dotplot superpuestos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate label positions and group letters</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>arbletras <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y.pos =</span> <span class="fu">max</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">Trtf =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"7"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>),</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">levels</span>(arbol1<span class="sc">$</span>Trtf)),</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">arbletter =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">by =</span> <span class="st">"Trtf"</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampled data for dotplot (e.g., 70% of points)</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>arbol1_jitter <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Thinner transparent boxplots with colored borders</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> Trtf), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Jittered points (reduced number, smaller, filled with their color)</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbol1_jitter,</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> Trtf, <span class="at">fill =</span> Trtf),</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="fl">0.1</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Significance letters</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> arbletras, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> y.pos, <span class="at">label =</span> arbletter),</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Axis and labels</span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">120</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span>, </span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"GF-2626 (200 ml/ha, FOL)"</span>, </span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF-2626 (400 ml/ha, FOL)"</span>,</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"GF-2626 (400 ml/ha, INJ)"</span>,</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOL)"</span>,</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"CONFIDOR 200 OD (750 ml/ha, INJ)"</span>,</span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"KARATE ZEON 10CS (250 ml/ha, FOL)"</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"#A6CEE3"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#1F78B4"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#B2DF8A"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#33A02C"</span>,</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#FB9A99"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#E31A1C"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#FDBF6F"</span></span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"#A6CEE3"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#1F78B4"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#B2DF8A"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#33A02C"</span>,</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#FB9A99"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#E31A1C"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#FDBF6F"</span></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.2</span>),</span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Por último, había pensado implementar un PERMANOVA, pero no tiene mucho sentido aquí ya que no tenemos varias variables respuesta (solo queremos estudiar las diferencias de la mortalidad para los diferentes tratamientos con aleatoriedad en otros factores como la parcela de aplicación y el periodo) y el caso unidimensional con la euclideana es simplemente un ANOVA normal.</p>
</section>
</section>
</section>
<section id="sec-folprimera" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-folprimera"><span class="header-section-number">2.4</span> P2 - ¿Es más eficaz foliar o inyectar?</h2>
<p>En un diagrama de árbol nuestra situación es algo así:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  Treatments --&gt; SULFOXAFLOR
  SULFOXAFLOR --&gt; SULFOXAFLOR_FOLIAR[FOLIAR APPLICATION]
  SULFOXAFLOR --&gt; SULFOXAFLOR_INJECTION[INJECTION]

  Treatments --&gt; CONFIDOR
  CONFIDOR --&gt; CONFIDOR_FOLIAR[FOLIAR APPLICATION]
  CONFIDOR --&gt; CONFIDOR_INJECTION[INJECTION]

  Treatments --&gt; LAMBDA
  LAMBDA --&gt; LAMBDA_FOLIAR[FOLIAR APPLICATION]

  Treatments --&gt; UNTREATED
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Miramos la tabla de Excel para crear una nueva categoría adecuadamente según el tratamiento aplicado. Para este caso, hacemos <strong>pooling</strong> sobre la categoría producto, ya que existen categorías como control o lambda que no tienen categoría ‘inyectar’. A su vez, no es posible anidar FOLIAR-INYECTAR ya que el factor <strong>NO es aleatorio</strong> ya que el método de introducción del insecticida es equivalente independientemente del tratamiento, además de por lo anterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear la variable categ (puede contener NAs si hay Trt con valores distintos de 1 a 5 o 7)</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>arbol1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">categ =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"UNTREATED"</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"SULFOXAFLOR_FOLIAR_200"</span>,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"SULFOXAFLOR_FOLIAR_400"</span>,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"SULFOXAFLOR_INJECT_400"</span>,</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"CONFIDOR_INJECT_750"</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># otros valores de Trt → NA</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">categ =</span> <span class="fu">relevel</span>(categ, <span class="at">ref =</span> <span class="st">"UNTREATED"</span>)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos nuevo dataframe sin NA en categ</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>arbol1_sinNA <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(categ))</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificamos niveles</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(arbol1_sinNA<span class="sc">$</span>categ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UNTREATED"              "CONFIDOR_FOLIAR_750"    "CONFIDOR_INJECT_750"   
[4] "SULFOXAFLOR_FOLIAR_200" "SULFOXAFLOR_FOLIAR_400" "SULFOXAFLOR_INJECT_400"</code></pre>
</div>
</div>
<p>Ahora planteamos varios modelos:</p>
<section id="modelo-1-modelo-lineal-mixto-con-lmer-1" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="modelo-1-modelo-lineal-mixto-con-lmer-1"><span class="header-section-number">2.4.1</span> Modelo 1: Modelo lineal mixto con lmer</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1 (lmer, modelo lineal mixto, family = gaussian)</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>modelo_lmerfol <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad <span class="sc">~</span> categ <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> PLOTf), <span class="at">data =</span> arbol1_sinNA)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_lmerfol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad ~ categ + (1 | PLOTf)
   Data: arbol1_sinNA

REML criterion at convergence: 2533.8

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.93334 -0.58968  0.06948  0.61258  2.72311 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept)  66.99    8.185  
 Residual             401.24   20.031  
Number of obs: 288, groups:  PLOTf, 24

Fixed effects:
                            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)                   19.750      5.011 18.000   3.942 0.000957 ***
categCONFIDOR_FOLIAR_750      57.838      7.086 18.000   8.162 1.84e-07 ***
categCONFIDOR_INJECT_750       3.059      7.086 18.000   0.432 0.671088    
categSULFOXAFLOR_FOLIAR_200   15.852      7.086 18.000   2.237 0.038177 *  
categSULFOXAFLOR_FOLIAR_400   20.290      7.086 18.000   2.863 0.010333 *  
categSULFOXAFLOR_INJECT_400   17.855      7.086 18.000   2.520 0.021416 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                      (Intr) cCONFIDOR_F cCONFIDOR_I cSULFOXAFLOR_FOLIAR_2
cCONFIDOR_F           -0.707                                              
cCONFIDOR_I           -0.707  0.500                                       
cSULFOXAFLOR_FOLIAR_2 -0.707  0.500       0.500                           
cSULFOXAFLOR_FOLIAR_4 -0.707  0.500       0.500       0.500               
cSULFOXAFLOR_I        -0.707  0.500       0.500       0.500               
                      cSULFOXAFLOR_FOLIAR_4
cCONFIDOR_F                                
cCONFIDOR_I                                
cSULFOXAFLOR_FOLIAR_2                      
cSULFOXAFLOR_FOLIAR_4                      
cSULFOXAFLOR_I         0.500               </code></pre>
</div>
</div>
<p>Veo el DHARMa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>residuos_simulados1fol <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_lmerfol)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados1fol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Se cumple normalidad pero no homogeneidad. En cualquier caso, seguimos analizando el modelo.</p>
<p>Vemos análisis de la deviance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_lmerfol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad
       Chisq Df Pr(&gt;Chisq)    
categ 85.082  5  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Recordemos que no hay homogeneidad pero sí normalidad. Podemos también usar en Anova en lugar del típico test de Wald usar un test más robusto como el de Kenward-Roger o incluso Satterthwaite:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_lmerfol, <span class="at">ddf =</span> <span class="st">"Kenward-Roger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad
       Chisq Df Pr(&gt;Chisq)    
categ 85.082  5  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_lmerfol, <span class="at">ddf =</span> <span class="st">"Satterthwaite"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad
       Chisq Df Pr(&gt;Chisq)    
categ 85.082  5  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Vemos diferencias de medias marginales con emeans:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>emmeans_trat2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo_lmerfol, <span class="sc">~</span> categ)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>emmeans_trat2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> categ                  emmean   SE df lower.CL upper.CL
 UNTREATED                19.8 5.01 18     9.22     30.3
 CONFIDOR_FOLIAR_750      77.6 5.01 18    67.06     88.1
 CONFIDOR_INJECT_750      22.8 5.01 18    12.28     33.3
 SULFOXAFLOR_FOLIAR_200   35.6 5.01 18    25.08     46.1
 SULFOXAFLOR_FOLIAR_400   40.0 5.01 18    29.51     50.6
 SULFOXAFLOR_INJECT_400   37.6 5.01 18    27.08     48.1

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>comparaciones2 <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans_trat2, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>comparaciones2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                                        estimate   SE df t.ratio
 UNTREATED - CONFIDOR_FOLIAR_750                   -57.84 7.09 18  -8.162
 UNTREATED - CONFIDOR_INJECT_750                    -3.06 7.09 18  -0.432
 UNTREATED - SULFOXAFLOR_FOLIAR_200                -15.85 7.09 18  -2.237
 UNTREATED - SULFOXAFLOR_FOLIAR_400                -20.29 7.09 18  -2.863
 UNTREATED - SULFOXAFLOR_INJECT_400                -17.85 7.09 18  -2.520
 CONFIDOR_FOLIAR_750 - CONFIDOR_INJECT_750          54.78 7.09 18   7.730
 CONFIDOR_FOLIAR_750 - SULFOXAFLOR_FOLIAR_200       41.99 7.09 18   5.925
 CONFIDOR_FOLIAR_750 - SULFOXAFLOR_FOLIAR_400       37.55 7.09 18   5.299
 CONFIDOR_FOLIAR_750 - SULFOXAFLOR_INJECT_400       39.98 7.09 18   5.642
 CONFIDOR_INJECT_750 - SULFOXAFLOR_FOLIAR_200      -12.79 7.09 18  -1.805
 CONFIDOR_INJECT_750 - SULFOXAFLOR_FOLIAR_400      -17.23 7.09 18  -2.432
 CONFIDOR_INJECT_750 - SULFOXAFLOR_INJECT_400      -14.80 7.09 18  -2.088
 SULFOXAFLOR_FOLIAR_200 - SULFOXAFLOR_FOLIAR_400    -4.44 7.09 18  -0.626
 SULFOXAFLOR_FOLIAR_200 - SULFOXAFLOR_INJECT_400    -2.00 7.09 18  -0.283
 SULFOXAFLOR_FOLIAR_400 - SULFOXAFLOR_INJECT_400     2.44 7.09 18   0.344
 p.value
  &lt;.0001
  0.7743
  0.0636
  0.0258
  0.0459
  &lt;.0001
  0.0001
  0.0001
  0.0001
  0.1197
  0.0482
  0.0769
  0.6738
  0.7807
  0.7807

Degrees-of-freedom method: kenward-roger 
P value adjustment: fdr method for 15 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cld</span>(emmeans_trat2, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> categ                  emmean   SE df lower.CL upper.CL .group
 UNTREATED                19.8 5.01 18     4.90     34.6  a    
 CONFIDOR_INJECT_750      22.8 5.01 18     7.96     37.7  ab   
 SULFOXAFLOR_FOLIAR_200   35.6 5.01 18    20.76     50.4  abc  
 SULFOXAFLOR_INJECT_400   37.6 5.01 18    22.76     52.5   bc  
 SULFOXAFLOR_FOLIAR_400   40.0 5.01 18    25.19     54.9    c  
 CONFIDOR_FOLIAR_750      77.6 5.01 18    62.74     92.4     d 

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
</section>
<section id="modelo-1.5-transformación-box-cox-usar-mortalidad_trans" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="modelo-1.5-transformación-box-cox-usar-mortalidad_trans"><span class="header-section-number">2.4.2</span> Modelo 1.5: Transformación Box-Cox (usar mortalidad_trans)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1 (lmer, modelo lineal mixto, family = gaussian)</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>modelo_lmerfol2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_trans <span class="sc">~</span> categ <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> PLOTf), <span class="at">data =</span> arbol1_sinNA)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_lmerfol2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_trans ~ categ + (1 | PLOTf)
   Data: arbol1_sinNA

REML criterion at convergence: 1457.4

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8854 -0.6069  0.1734  0.6606  2.0937 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept) 0.7445   0.8629  
 Residual             9.0625   3.0104  
Number of obs: 288, groups:  PLOTf, 24

Fixed effects:
                            Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)                   6.0659     0.6123 18.0000   9.906 1.03e-08 ***
categCONFIDOR_FOLIAR_750      7.1004     0.8660 18.0000   8.199 1.72e-07 ***
categCONFIDOR_INJECT_750      0.3753     0.8660 18.0000   0.433  0.66986    
categSULFOXAFLOR_FOLIAR_200   1.9831     0.8660 18.0000   2.290  0.03431 *  
categSULFOXAFLOR_FOLIAR_400   3.0284     0.8660 18.0000   3.497  0.00257 ** 
categSULFOXAFLOR_INJECT_400   2.1901     0.8660 18.0000   2.529  0.02100 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                      (Intr) cCONFIDOR_F cCONFIDOR_I cSULFOXAFLOR_FOLIAR_2
cCONFIDOR_F           -0.707                                              
cCONFIDOR_I           -0.707  0.500                                       
cSULFOXAFLOR_FOLIAR_2 -0.707  0.500       0.500                           
cSULFOXAFLOR_FOLIAR_4 -0.707  0.500       0.500       0.500               
cSULFOXAFLOR_I        -0.707  0.500       0.500       0.500               
                      cSULFOXAFLOR_FOLIAR_4
cCONFIDOR_F                                
cCONFIDOR_I                                
cSULFOXAFLOR_FOLIAR_2                      
cSULFOXAFLOR_FOLIAR_4                      
cSULFOXAFLOR_I         0.500               </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>residuos_simulados2fol <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_lmerfol2)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados2fol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No nos sirve.</p>
</section>
<section id="modelo-2-anova-de-welch" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="modelo-2-anova-de-welch"><span class="header-section-number">2.4.3</span> Modelo 2: ANOVA de Welch</h3>
<p>Notemos que en el modelo 1 teníamos normalidad pero no homogeneidad de varianzas. En este caso, para evitar falsos positivos, podemos usar un <strong>ANOVA de Welch</strong> que no requiere suponer homocedasticidad (homogeneidad de varianzas). Así, si no suponemos factores aleatorios:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>resultado_welch <span class="ot">&lt;-</span> <span class="fu">oneway.test</span>(mortalidad <span class="sc">~</span> categ, <span class="at">data =</span> arbol1_sinNA, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultado_welch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-way analysis of means (not assuming equal variances)

data:  mortalidad and categ
F = 56.916, num df = 5.00, denom df = 127.58, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Claramente rechazamos la igualdad de medias. Vemos ahora su test post-hoc apropiado (igual que Tukey, Bonferroni o FDR), que es el de Games-Howell:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test de Games-Howell</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PMCMRplus)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gamesHowellTest</span>(mortalidad <span class="sc">~</span> categ, <span class="at">data =</span> arbol1_sinNA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
    Pairwise comparisons using Games-Howell test</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>data: mortalidad by categ</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                       UNTREATED CONFIDOR_FOLIAR_750 CONFIDOR_INJECT_750
CONFIDOR_FOLIAR_750    1.6e-11   -                   -                  
CONFIDOR_INJECT_750    0.84598   5.2e-11             -                  
SULFOXAFLOR_FOLIAR_200 0.00084   4.9e-10             0.02701            
SULFOXAFLOR_FOLIAR_400 1.5e-07   4.7e-10             7.6e-05            
SULFOXAFLOR_INJECT_400 0.00369   2.6e-09             0.04100            
                       SULFOXAFLOR_FOLIAR_200 SULFOXAFLOR_FOLIAR_400
CONFIDOR_FOLIAR_750    -                      -                     
CONFIDOR_INJECT_750    -                      -                     
SULFOXAFLOR_FOLIAR_200 -                      -                     
SULFOXAFLOR_FOLIAR_400 0.91504                -                     
SULFOXAFLOR_INJECT_400 0.99919                0.99713               </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
P value adjustment method: none</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>Sin embargo, no tenemos en cuenta aleatoriedad en otros factores. Así, mi última idea es utilizar un modelo lineal mixto con pesos para los residuos (evitar la heterocedasticidad del caso 1).</p>
</section>
<section id="modelo-3-modelo-lineal-con-nlme-con-heterocedasticidad" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="modelo-3-modelo-lineal-con-nlme-con-heterocedasticidad"><span class="header-section-number">2.4.4</span> Modelo 3: modelo lineal con nlme con heterocedasticidad</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>modelo2_13_nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  mortalidad <span class="sc">~</span> categ,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> PLOTf,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol1_sinNA,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> categ),  <span class="co"># Permite varianzas distintas por nivel de categ</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by REML
  Data: arbol1_sinNA 
       AIC      BIC    logLik
  2509.592 2556.936 -1241.796

Random effects:
 Formula: ~1 | PLOTf
        (Intercept) Residual
StdDev:      0.0131 30.48573

Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | categ 
 Parameter estimates:
SULFOXAFLOR_INJECT_400    CONFIDOR_FOLIAR_750              UNTREATED 
             1.0000000              0.7529821              0.3138300 
   CONFIDOR_INJECT_750 SULFOXAFLOR_FOLIAR_200 SULFOXAFLOR_FOLIAR_400 
             0.4998082              0.7766235              0.6349895 
Fixed effects:  mortalidad ~ categ 
                               Value Std.Error  DF   t-value p-value
(Intercept)                 19.75019  1.380942 264 14.301973  0.0000
categCONFIDOR_FOLIAR_750    57.83752  3.589567  18 16.112671  0.0000
categCONFIDOR_INJECT_750     3.05914  2.596892  18  1.177999  0.2541
categSULFOXAFLOR_FOLIAR_200 15.85215  3.685806  18  4.300863  0.0004
categSULFOXAFLOR_FOLIAR_400 20.28981  3.116739  18  6.509948  0.0000
categSULFOXAFLOR_INJECT_400 17.85466  4.611846  18  3.871478  0.0011
 Correlation: 
                            (Intr) cCONFIDOR_F cCONFIDOR_I
categCONFIDOR_FOLIAR_750    -0.385                        
categCONFIDOR_INJECT_750    -0.532  0.205                 
categSULFOXAFLOR_FOLIAR_200 -0.375  0.144       0.199     
categSULFOXAFLOR_FOLIAR_400 -0.443  0.170       0.236     
categSULFOXAFLOR_INJECT_400 -0.299  0.115       0.159     
                            cSULFOXAFLOR_FOLIAR_2 cSULFOXAFLOR_FOLIAR_4
categCONFIDOR_FOLIAR_750                                               
categCONFIDOR_INJECT_750                                               
categSULFOXAFLOR_FOLIAR_200                                            
categSULFOXAFLOR_FOLIAR_400  0.166                                     
categSULFOXAFLOR_INJECT_400  0.112                 0.133               

Standardized Within-Group Residuals:
        Min          Q1         Med          Q3         Max 
-2.73457929 -0.80928195  0.02611317  0.74900739  2.69215785 

Number of Observations: 288
Number of Groups: 24 </code></pre>
</div>
</div>
<p>Hacemos un diagnóstico completo del modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_ad_bootstrap_normaliz</span>(modelo2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-52-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-52-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling con bootstrap paramétrico (3000 réplicas)

data:  Residuos normalizados de modelo2_13_nlme
AD = 1.5506, p-value = 0.1647</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 4. R² marginal y condicional (explicación del modelo) ----</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(modelo2_13_nlme)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² marginal (Categ):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2m"</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">8</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² marginal (Categ): 27.76782 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² condicional (Categ + Plotf):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2c"</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">8</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² condicional (Categ + Plotf): 27.76784 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proporción atribuida a Plotf:"</span>, <span class="fu">round</span>((r2[<span class="dv">1</span>, <span class="st">"R2c"</span>] <span class="sc">-</span> r2[<span class="dv">1</span>, <span class="st">"R2m"</span>])<span class="sc">*</span><span class="dv">100</span>, <span class="dv">8</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Proporción atribuida a Plotf: 1.334e-05 %</code></pre>
</div>
</div>
<p>El modelo podemos <strong>suponer que</strong> <strong>verifica las hipótesis de normalidad</strong>, ya que <strong>p &gt; 0.05</strong>. Viendo el qqplot y el histograma consideraremos que hay normalidad. Vemos además si mejora significativamente el modelo lineal mixto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#logLik(modelo_lmerfol)</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co">#logLik(modelo2_13_nlme)</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternativa para más detalle: paso a nlme el modelo homocedástico</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co">#para compararlos y veo el p-valor (en este caso es mejor #claramente modelo2_13_nlme)</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>modelo_lmefol <span class="ot">&lt;-</span>  <span class="fu">lme</span>(</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> mortalidad <span class="sc">~</span> categ,</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> PLOTf,</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol1_sinNA</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo_lmefol, modelo2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Model df      AIC      BIC    logLik   Test  L.Ratio p-value
modelo_lmefol       1  8 2549.769 2578.904 -1266.884                        
modelo2_13_nlme     2 13 2509.592 2556.936 -1241.796 1 vs 2 50.17742  &lt;.0001</code></pre>
</div>
</div>
<p>El modelo que permite varianzas diferentes por tratamiento (<code>modelo2_13_nlme</code>) mejora el ajuste, aunque sea un poco. Deberíamos por tanto usar <code>modelo2_13_nlme</code> por todo lo anterior, entonces.</p>
<p>Hacemos un análisis de la deviance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: mortalidad
       Chisq Df Pr(&gt;Chisq)    
categ 290.53  5  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Veamos ahora las diferencias de medias marginales con emeans:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar medias marginales para Trtf con modelo nlme</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>emmeans2_trat13_nlme <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo2_13_nlme, <span class="sc">~</span> categ)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emmeans2_trat13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> categ                  emmean   SE df lower.CL upper.CL
 UNTREATED                19.8 1.38 23     16.9     22.6
 CONFIDOR_FOLIAR_750      77.6 3.31 18     70.6     84.5
 CONFIDOR_INJECT_750      22.8 2.20 18     18.2     27.4
 SULFOXAFLOR_FOLIAR_200   35.6 3.42 18     28.4     42.8
 SULFOXAFLOR_FOLIAR_400   40.0 2.79 18     34.2     45.9
 SULFOXAFLOR_INJECT_400   37.6 4.40 18     28.4     46.8

Degrees-of-freedom method: containment 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaciones pareadas ajustando p con FDR</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>comparaciones2_13_nlme <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans2_trat13_nlme, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparaciones2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                                        estimate   SE df t.ratio
 UNTREATED - CONFIDOR_FOLIAR_750                   -57.84 3.59 18 -16.113
 UNTREATED - CONFIDOR_INJECT_750                    -3.06 2.60 18  -1.178
 UNTREATED - SULFOXAFLOR_FOLIAR_200                -15.85 3.69 18  -4.301
 UNTREATED - SULFOXAFLOR_FOLIAR_400                -20.29 3.12 18  -6.510
 UNTREATED - SULFOXAFLOR_INJECT_400                -17.85 4.61 18  -3.871
 CONFIDOR_FOLIAR_750 - CONFIDOR_INJECT_750          54.78 3.98 18  13.775
 CONFIDOR_FOLIAR_750 - SULFOXAFLOR_FOLIAR_200       41.99 4.76 18   8.821
 CONFIDOR_FOLIAR_750 - SULFOXAFLOR_FOLIAR_400       37.55 4.33 18   8.663
 CONFIDOR_FOLIAR_750 - SULFOXAFLOR_INJECT_400       39.98 5.51 18   7.259
 CONFIDOR_INJECT_750 - SULFOXAFLOR_FOLIAR_200      -12.79 4.06 18  -3.148
 CONFIDOR_INJECT_750 - SULFOXAFLOR_FOLIAR_400      -17.23 3.56 18  -4.846
 CONFIDOR_INJECT_750 - SULFOXAFLOR_INJECT_400      -14.80 4.92 18  -3.008
 SULFOXAFLOR_FOLIAR_200 - SULFOXAFLOR_FOLIAR_400    -4.44 4.41 18  -1.005
 SULFOXAFLOR_FOLIAR_200 - SULFOXAFLOR_INJECT_400    -2.00 5.57 18  -0.359
 SULFOXAFLOR_FOLIAR_400 - SULFOXAFLOR_INJECT_400     2.44 5.21 18   0.467
 p.value
  &lt;.0001
  0.3177
  0.0008
  &lt;.0001
  0.0019
  &lt;.0001
  &lt;.0001
  &lt;.0001
  &lt;.0001
  0.0083
  0.0003
  0.0103
  0.3785
  0.7235
  0.6921

Degrees-of-freedom method: containment 
P value adjustment: fdr method for 15 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot sencillo de comparaciones</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>letras2_13_nlme <span class="ot">&lt;-</span> <span class="fu">cld</span>(emmeans2_trat13_nlme, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(letras2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> categ                  emmean   SE df lower.CL upper.CL .group
 UNTREATED                19.8 1.38 23     15.8     23.7  a    
 CONFIDOR_INJECT_750      22.8 2.20 18     16.3     29.3  a    
 SULFOXAFLOR_FOLIAR_200   35.6 3.42 18     25.5     45.7   b   
 SULFOXAFLOR_INJECT_400   37.6 4.40 18     24.6     50.6   b   
 SULFOXAFLOR_FOLIAR_400   40.0 2.79 18     31.8     48.3   b   
 CONFIDOR_FOLIAR_750      77.6 3.31 18     67.8     87.4    c  

Degrees-of-freedom method: containment 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>Hacemos el boxplot+dotplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe paleta: 7 tratamientos originales (NO se elimina ninguno)</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>pal_2017 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">categ =</span> <span class="fu">c</span>(</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_INJECT_750"</span>,</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_FOLIAR_200"</span>,</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_INJECT_400"</span>,</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_FOLIAR_400"</span>,</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KARATE_ZEON_FOLIAR_250"</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD (750 ml/ha, INJ)"</span>,</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (200 ml/ha, FOL)"</span>,</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (400 ml/ha, INJ)"</span>,</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (400 ml/ha, FOL)"</span>,</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOL)"</span>,</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KARATE ZEON 10CS (250 ml/ha, FOL)"</span></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(</span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>,  <span class="co"># UNTREATED</span></span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#E31A1C"</span>,  <span class="co"># CONFIDOR INJECT 750 (A)</span></span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#1F78B4"</span>,  <span class="co"># GF-2626 FOLIAR 200 (B)</span></span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#33A02C"</span>,  <span class="co"># GF-2626 INJECT 400 (A)</span></span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B2DF8A"</span>,  <span class="co"># GF-2626 FOLIAR 400 (B)</span></span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>,  <span class="co"># CONFIDOR FOLIAR 750 (B)</span></span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FDBF6F"</span>   <span class="co"># KARATE ZEON FOLIAR 250</span></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a>pal_2017_vec <span class="ot">&lt;-</span> <span class="fu">setNames</span>(pal_2017<span class="sc">$</span>color, pal_2017<span class="sc">$</span>categ)</span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a>arbletras <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">categ =</span> <span class="fu">factor</span>(<span class="fu">c</span>(</span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_INJECT_750"</span>,</span>
<span id="cb133-42"><a href="#cb133-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_FOLIAR_200"</span>,</span>
<span id="cb133-43"><a href="#cb133-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_INJECT_400"</span>,</span>
<span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_FOLIAR_400"</span>,</span>
<span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_FOLIAR_750"</span></span>
<span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">levels =</span> <span class="fu">levels</span>(arbol1_sinNA<span class="sc">$</span>categ)),</span>
<span id="cb133-47"><a href="#cb133-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">emmean =</span> <span class="fu">c</span>(<span class="fl">19.8</span>, <span class="fl">22.8</span>, <span class="fl">35.6</span>, <span class="fl">37.6</span>, <span class="fl">40.0</span>, <span class="fl">77.6</span>),</span>
<span id="cb133-48"><a href="#cb133-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> <span class="fu">c</span>(<span class="fl">1.38</span>, <span class="fl">2.20</span>, <span class="fl">3.42</span>, <span class="fl">4.40</span>, <span class="fl">2.79</span>, <span class="fl">3.31</span>),</span>
<span id="cb133-49"><a href="#cb133-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>, <span class="dv">18</span>),</span>
<span id="cb133-50"><a href="#cb133-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower.CL =</span> <span class="fu">c</span>(<span class="fl">15.8</span>, <span class="fl">16.3</span>, <span class="fl">25.5</span>, <span class="fl">24.6</span>, <span class="fl">31.8</span>, <span class="fl">67.8</span>),</span>
<span id="cb133-51"><a href="#cb133-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper.CL =</span> <span class="fu">c</span>(<span class="fl">23.7</span>, <span class="fl">29.3</span>, <span class="fl">45.7</span>, <span class="fl">50.6</span>, <span class="fl">48.3</span>, <span class="fl">87.4</span>),</span>
<span id="cb133-52"><a href="#cb133-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">.group =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)</span>
<span id="cb133-53"><a href="#cb133-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-54"><a href="#cb133-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-55"><a href="#cb133-55" aria-hidden="true" tabindex="-1"></a>arbol1_jitter <span class="ot">&lt;-</span> arbol1_sinNA <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="dv">1</span>)</span>
<span id="cb133-56"><a href="#cb133-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-57"><a href="#cb133-57" aria-hidden="true" tabindex="-1"></a>posiciones_letras <span class="ot">&lt;-</span> arbol1_sinNA <span class="sc">%&gt;%</span></span>
<span id="cb133-58"><a href="#cb133-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(categ) <span class="sc">%&gt;%</span></span>
<span id="cb133-59"><a href="#cb133-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y.pos =</span> <span class="fu">max</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">8</span>)</span>
<span id="cb133-60"><a href="#cb133-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-61"><a href="#cb133-61" aria-hidden="true" tabindex="-1"></a>arbletras <span class="ot">&lt;-</span> arbletras <span class="sc">%&gt;%</span></span>
<span id="cb133-62"><a href="#cb133-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posiciones_letras, <span class="at">by =</span> <span class="st">"categ"</span>)</span>
<span id="cb133-63"><a href="#cb133-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-64"><a href="#cb133-64" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol1_sinNA, <span class="fu">aes</span>(<span class="at">x =</span> categ, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb133-65"><a href="#cb133-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> categ), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb133-66"><a href="#cb133-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb133-67"><a href="#cb133-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbol1_jitter,</span>
<span id="cb133-68"><a href="#cb133-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> categ, <span class="at">fill =</span> categ),</span>
<span id="cb133-69"><a href="#cb133-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb133-70"><a href="#cb133-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="fl">0.1</span></span>
<span id="cb133-71"><a href="#cb133-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb133-72"><a href="#cb133-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb133-73"><a href="#cb133-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbletras,</span>
<span id="cb133-74"><a href="#cb133-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> categ, <span class="at">y =</span> y.pos, <span class="at">label =</span> .group),</span>
<span id="cb133-75"><a href="#cb133-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb133-76"><a href="#cb133-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb133-77"><a href="#cb133-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fu">max</span>(arbletras<span class="sc">$</span>y.pos) <span class="sc">+</span> <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb133-78"><a href="#cb133-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_2017_vec) <span class="sc">+</span></span>
<span id="cb133-79"><a href="#cb133-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_2017_vec) <span class="sc">+</span></span>
<span id="cb133-80"><a href="#cb133-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aquí cambias los nombres del eje X:</span></span>
<span id="cb133-81"><a href="#cb133-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">setNames</span>(pal_2017<span class="sc">$</span>label, pal_2017<span class="sc">$</span>categ)) <span class="sc">+</span></span>
<span id="cb133-82"><a href="#cb133-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb133-83"><a href="#cb133-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb133-84"><a href="#cb133-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb133-85"><a href="#cb133-85" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb133-86"><a href="#cb133-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb133-87"><a href="#cb133-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb133-88"><a href="#cb133-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb133-89"><a href="#cb133-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb133-90"><a href="#cb133-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.2</span>),</span>
<span id="cb133-91"><a href="#cb133-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span>
<span id="cb133-92"><a href="#cb133-92" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="análisis-de-insecticidas-en-2018" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Análisis de insecticidas en 2018</h1>
<section id="extracción-de-datos-de-excel-a-un-dataframe" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="extracción-de-datos-de-excel-a-un-dataframe"><span class="header-section-number">3.1</span> Extracción de datos de Excel a un dataframe</h2>
<p>Extraemos las columnas que nos interesan en los 8 períodos del Excel de 2018 para extraer la mortalidad calculada en Excel en cada período de 2018.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar y cargar paquetes necesarios</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readxl"</span>)) <span class="fu">install.packages</span>(<span class="st">"readxl"</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidyr"</span>)) <span class="fu">install.packages</span>(<span class="st">"tidyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Cargando paquete requerido: tidyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:rstan':

    extract</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:Matrix':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración de importación</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>ruta_archivo <span class="ot">&lt;-</span> <span class="st">"C:/Users/dvalh/Desktop/UA/MatesUA/Prácticas de empresa + privado/Datos actividad 3/rilevi 2018_02.xlsx"</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>nombre_hoja <span class="ot">&lt;-</span> <span class="st">"Rileivi"</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>fila_inicio <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>fila_fin <span class="ot">&lt;-</span> <span class="dv">122</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir columnas y nombres personalizados</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>columnas_seleccionadas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"S"</span>, <span class="st">"T"</span>, <span class="st">"U"</span>, <span class="st">"AH"</span>, <span class="st">"AS"</span>, <span class="st">"BD"</span>, <span class="st">"BO"</span>, <span class="st">"BZ"</span>)  <span class="co"># Columnas a importar (A = Trat., B = Plot)</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>nombres_personalizados <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Trt"</span>, <span class="st">"Plot"</span>, <span class="st">"Rete"</span>, <span class="st">"Mortalidad_1"</span>, <span class="st">"Mortalidad_2"</span>, <span class="st">"Mortalidad_3"</span>, <span class="st">"Mortalidad_4"</span>, <span class="st">"Mortalidad_5"</span>, <span class="st">"Mortalidad_6"</span>, <span class="st">"Mortalidad_7"</span>, <span class="st">"Mortalidad_8"</span>)  <span class="co"># Nombres para el dataframe</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear lista temporal para almacenar columnas</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>lista_columnas <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(columnas_seleccionadas)) {</span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>  rango <span class="ot">&lt;-</span> <span class="fu">paste0</span>(columnas_seleccionadas[i], fila_inicio, <span class="st">":"</span>, columnas_seleccionadas[i], fila_fin)</span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>  columna_temp <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> ruta_archivo,</span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> nombre_hoja,</span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> rango,</span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> <span class="cn">FALSE</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>  lista_columnas[[nombres_personalizados[i]]] <span class="ot">&lt;-</span> columna_temp[[<span class="dv">1</span>]]</span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
New names:
New names:
New names:
New names:
New names:
New names:
New names:
New names:
New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir la lista a data.frame</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>pre2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lista_columnas)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso adicional: Rellenar valores vacíos en columna de tratamiento</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>pre2 <span class="ot">&lt;-</span> pre2 <span class="sc">%&gt;%</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(Trt, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Quito donde Plot es NA</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>pre2 <span class="ot">&lt;-</span> pre2[<span class="sc">!</span><span class="fu">is.na</span>(pre2<span class="sc">$</span>Plot), ]</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar resultados</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pre2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Trt Plot Rete Mortalidad_1 Mortalidad_2 Mortalidad_3 Mortalidad_4
1   2  101  A/1   0.00000000   0.04000000   0.04000000   0.12820513
2   2  101  A/2   0.03703704   0.03703704   0.03703704   0.01666667
3   2  101  B/1   0.09375000   0.18750000   0.18750000   0.21153846
4   2  101  B/2   0.08000000   0.20000000   0.20000000   0.26190476
6   4  102  A/1   0.00000000   0.03125000   0.12500000   0.06779661
7   4  102  A/2   0.00000000   0.04761905   0.28571429   0.36363636
  Mortalidad_5 Mortalidad_6 Mortalidad_7 Mortalidad_8
1    0.1475410   0.13888889   0.17204301   0.19130435
2    0.1084337   0.08910891   0.08474576   0.11278195
3    0.2794118   0.23750000   0.23958333   0.21311475
4    0.1896552   0.24637681   0.21839080   0.21000000
6    0.0800000   0.06976744   0.09708738   0.08849558
7    0.2881356   0.30000000   0.26436782   0.23853211</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pre2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   96 obs. of  11 variables:
 $ Trt         : num  2 2 2 2 4 4 4 4 6 6 ...
 $ Plot        : num  101 101 101 101 102 102 102 102 103 103 ...
 $ Rete        : chr  "A/1" "A/2" "B/1" "B/2" ...
 $ Mortalidad_1: num  0 0.037 0.0938 0.08 0 ...
 $ Mortalidad_2: num  0.04 0.037 0.1875 0.2 0.0312 ...
 $ Mortalidad_3: num  0.04 0.037 0.188 0.2 0.125 ...
 $ Mortalidad_4: num  0.1282 0.0167 0.2115 0.2619 0.0678 ...
 $ Mortalidad_5: num  0.148 0.108 0.279 0.19 0.08 ...
 $ Mortalidad_6: num  0.1389 0.0891 0.2375 0.2464 0.0698 ...
 $ Mortalidad_7: num  0.172 0.0847 0.2396 0.2184 0.0971 ...
 $ Mortalidad_8: num  0.1913 0.1128 0.2131 0.21 0.0885 ...</code></pre>
</div>
</div>
<p>Ahora convierto este dataframe de formato longitudinal a wide creando una variable periodo para cada <span class="math inline">\(\text{mortalidad}_i\)</span> y obtenemos nuestro dataframe arbol2. Lo guardaremos también por si acaso:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>arbol2 <span class="ot">&lt;-</span> pre2 <span class="sc">%&gt;%</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Mortalidad_"</span>),</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"periodo"</span>,</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"mortalidad"</span>,</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"Mortalidad_"</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(arbol2, <span class="at">file =</span> <span class="st">"arbol2.txt"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Multiplico mortalidad*100:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>mortalidad <span class="ot">&lt;-</span> arbol2<span class="sc">$</span>mortalidad<span class="sc">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observamos el summary y table para ver outliers, datos faltantes o extraños para hacer data cleaning posteriormente y variabilidad a simple vista en los datos.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y hacemos un par de tables y observamos los factores a tratar:</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Factor tratamiento:"</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol1<span class="sc">$</span>Trt)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Factor periodo:"</span>)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol1<span class="sc">$</span>periodo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="primeros-boxplot-1" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="primeros-boxplot-1"><span class="header-section-number">3.2</span> Primeros boxplot</h2>
<p>Convertimos en factores las variables year, Trt, PLOT y periodo y hacemos los boxplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Boxplot treatment observación</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>Trtf  <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol2<span class="sc">$</span>Trt, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"6"</span>,<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>))</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>Plotf <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol2<span class="sc">$</span>Plot)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>periodof <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol2<span class="sc">$</span>periodo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Boxplot básico de tratamiento</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol2, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad, <span class="at">fill =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Control"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#FF8C94"</span>,  <span class="co"># Rosa fuerte</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#FFAA5A"</span>,  <span class="co"># Naranja suave</span></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#FFD700"</span>,  <span class="co"># Amarillo dorado</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#7FDBFF"</span>,  <span class="co"># Azul claro</span></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#B19CD9"</span>,  <span class="co"># Lila pastel</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#77DD77"</span>   <span class="co"># Verde suave</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Boxplot % Mortalidad"</span>,</span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(<span class="st">"Tratamiento"</span>),</span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortalidad"</span></span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol2, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad, <span class="at">fill =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Control"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#FF8C94"</span>,  <span class="co"># Rosa fuerte</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#FFAA5A"</span>,  <span class="co"># Naranja suave</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#FFD700"</span>,  <span class="co"># Amarillo dorado</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#7FDBFF"</span>,  <span class="co"># Azul claro</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#B19CD9"</span>,  <span class="co"># Lila pastel</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#77DD77"</span>   <span class="co"># Verde suave</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Violinplot % Mortalidad"</span>,</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(<span class="st">"Tratamiento"</span>),</span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortalidad"</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-65-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados-1" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="p1---qué-insecticida-es-más-efectivo-planteamiento-de-varios-modelos-lineales-generalizados-1"><span class="header-section-number">3.3</span> P1 - ¿Qué insecticida es más efectivo? Planteamiento de varios modelos lineales generalizados</h2>
<section id="qué-distribución-podría-fittear-bien-los-datos-1" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="qué-distribución-podría-fittear-bien-los-datos-1"><span class="header-section-number">3.3.1</span> ¿Qué distribución podría fittear bien los datos?</h3>
<p>Vemos en detalle qué modelo puede fittear bien los residuos con la función descdist del paquete fitdistrplus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fitdistrplus) </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">descdist</span>(arbol2<span class="sc">$</span>mortalidad, <span class="at">boot =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>summary statistics
------
min:  0   max:  100 
median:  41.6574 
mean:  45.61699 
estimated sd:  31.77678 
estimated skewness:  0.1789123 
estimated kurtosis:  1.64237 </code></pre>
</div>
</div>
<p>Así, ahora probaremos varios glms para ver cuál fittea mejor el modelo.</p>
</section>
<section id="modelo-1-modelo-lineal-mixto-con-lmer-2" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="modelo-1-modelo-lineal-mixto-con-lmer-2"><span class="header-section-number">3.3.2</span> Modelo 1: Modelo lineal mixto con lmer</h3>
<p>Usamos la función lmer del paquete lme4 para ver nuestro primer modelo y printeamos un summary inicial del mismo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1 (lmer, modelo lineal mixto, family = gaussian)</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>modelo_21 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Plotf), <span class="at">data =</span> arbol2)</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(modelo_21))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad ~ Trtf + (1 | Plotf)
   Data: arbol2

REML criterion at convergence: 6780.7

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.3195 -0.6044  0.0191  0.6578  2.7233 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept) 148.2    12.18   
 Residual             388.2    19.70   
Number of obs: 768, groups:  Plotf, 24

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   13.636      6.332 18.000   2.154   0.0451 *  
Trtf1         56.855      8.955 18.000   6.349 5.56e-06 ***
Trtf2         14.924      8.955 18.000   1.667   0.1129    
Trtf3         56.824      8.955 18.000   6.346 5.60e-06 ***
Trtf4         15.471      8.955 18.000   1.728   0.1012    
Trtf5         47.809      8.955 18.000   5.339 4.48e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4 
Trtf1 -0.707                            
Trtf2 -0.707  0.500                     
Trtf3 -0.707  0.500  0.500              
Trtf4 -0.707  0.500  0.500  0.500       
Trtf5 -0.707  0.500  0.500  0.500  0.500</code></pre>
</div>
</div>
<p>Vemos su DHARMa para ver si el modelo es válido:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>residuos_simulados21 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_21)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>KS se cumple (hay normalidad de los residuos), pero no hay homogeneidad.</p>
<p>Vemos el <span class="math inline">\(R^2\)</span> marginal (porcentaje de varianza explicada por efectos fijos) y condicional (porcentaje de varianza explicada por efectos fijos + aleatorios) para el factor fijo Trt y el aleatorio Plot. Como estamos en un modelo lineal mixto, no hace falta añadir la varianza del enlace con distribución, ya que el enlace es la identidad y estamos en el caso gaussiano:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular R² marginal (efectos fijos) y condicional (fijos + aleatorios)</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>r2_values <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(modelo_21)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer R² marginal (porcentaje de variabilidad explicada por Trtf)</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>porcentaje_trtf <span class="ot">&lt;-</span> r2_values[<span class="dv">1</span>, <span class="st">"R2m"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Trtf explica el"</span>, <span class="fu">round</span>(porcentaje_trtf, <span class="dv">2</span>), <span class="st">"% de la variabilidad"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Trtf explica el 48.87 % de la variabilidad"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>porcentaje_total <span class="ot">&lt;-</span> r2_values[<span class="dv">1</span>, <span class="st">"R2c"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Trtf+Plotf explica el"</span>, <span class="fu">round</span>(porcentaje_total, <span class="dv">2</span>), <span class="st">"% de la variabilidad"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Trtf+Plotf explica el 63 % de la variabilidad"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>porcentaje_plotf <span class="ot">&lt;-</span> porcentaje_total <span class="sc">-</span> porcentaje_trtf</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Plotf explica el"</span>, <span class="fu">round</span>(porcentaje_plotf, <span class="dv">2</span>), <span class="st">"% de la variabilidad"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Plotf explica el 14.13 % de la variabilidad"</code></pre>
</div>
</div>
<p>Hacemos el análisis de la deviance del modelo_21:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II Wald chisquare tests)

Response: mortalidad
      Chisq Df Pr(&gt;Chisq)    
Trtf 76.636  5  4.237e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Vemos las diferencias entre las medias marginales más en detalle con emeans usando el test FDR:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>emmeans_trat21 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo_21, <span class="sc">~</span> Trtf)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>emmeans_trat21</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL
 6      13.6 6.33 18    0.333     26.9
 1      70.5 6.33 18   57.188     83.8
 2      28.6 6.33 18   15.258     41.9
 3      70.5 6.33 18   57.158     83.8
 4      29.1 6.33 18   15.805     42.4
 5      61.4 6.33 18   48.142     74.7

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>comparaciones21 <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans_trat21, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>comparaciones21</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast      estimate   SE df t.ratio p.value
 Trtf6 - Trtf1 -56.8545 8.95 18  -6.349  &lt;.0001
 Trtf6 - Trtf2 -14.9242 8.95 18  -1.667  0.1540
 Trtf6 - Trtf3 -56.8243 8.95 18  -6.346  &lt;.0001
 Trtf6 - Trtf4 -15.4713 8.95 18  -1.728  0.1517
 Trtf6 - Trtf5 -47.8091 8.95 18  -5.339  0.0002
 Trtf1 - Trtf2  41.9303 8.95 18   4.682  0.0005
 Trtf1 - Trtf3   0.0302 8.95 18   0.003  0.9973
 Trtf1 - Trtf4  41.3832 8.95 18   4.621  0.0005
 Trtf1 - Trtf5   9.0454 8.95 18   1.010  0.3778
 Trtf2 - Trtf3 -41.9001 8.95 18  -4.679  0.0005
 Trtf2 - Trtf4  -0.5471 8.95 18  -0.061  0.9973
 Trtf2 - Trtf5 -32.8849 8.95 18  -3.672  0.0033
 Trtf3 - Trtf4  41.3530 8.95 18   4.618  0.0005
 Trtf3 - Trtf5   9.0152 8.95 18   1.007  0.3778
 Trtf4 - Trtf5 -32.3378 8.95 18  -3.611  0.0033

Degrees-of-freedom method: kenward-roger 
P value adjustment: fdr method for 15 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos cld (¿qué letras corresponden a cada tratamiento?):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cld</span>(emmeans_trat21, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 6      13.6 6.33 18    -5.12     32.4  a    
 2      28.6 6.33 18     9.80     47.3  a    
 4      29.1 6.33 18    10.35     47.9  a    
 5      61.4 6.33 18    42.69     80.2   b   
 3      70.5 6.33 18    51.70     89.2   b   
 1      70.5 6.33 18    51.73     89.3   b   

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>Graficamos. He hecho un gráfico con un boxplot y un dotplot superpuestos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>Trtf <span class="ot">&lt;-</span> <span class="fu">factor</span>(arbol2<span class="sc">$</span>Trt, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"6"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"4"</span>, <span class="st">"3"</span>, <span class="st">"5"</span>))</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>arbletras2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y.pos =</span> <span class="fu">max</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">Trtf =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"6"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"4"</span>, <span class="st">"3"</span>, <span class="st">"5"</span>),</span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">levels</span>(arbol2<span class="sc">$</span>Trtf)),</span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">arbletter =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>)</span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">by =</span> <span class="st">"Trtf"</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>arbol2_jitter <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>x_labels2 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOL)"</span>,</span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF-2626 (400 ml/ha, FOL)"</span>,</span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"EPIK (1500 g/ha, FOL)"</span>,</span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"GF-2626 (400 ml/ha, INJ)"</span>,</span>
<span id="cb173-28"><a href="#cb173-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"EPIK (1500 g/ha, INJ)"</span>,</span>
<span id="cb173-29"><a href="#cb173-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span></span>
<span id="cb173-30"><a href="#cb173-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb173-31"><a href="#cb173-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-32"><a href="#cb173-32" aria-hidden="true" tabindex="-1"></a>color_palette2 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb173-33"><a href="#cb173-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#FB9A99"</span>,  <span class="co"># CONFIDOR (FOLIAR)</span></span>
<span id="cb173-34"><a href="#cb173-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#B2DF8A"</span>,  <span class="co"># GF-2626 (SULFOXAFLOR)</span></span>
<span id="cb173-35"><a href="#cb173-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#6A3D9A"</span>,  <span class="co"># EPIK A</span></span>
<span id="cb173-36"><a href="#cb173-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#33A02C"</span>,  <span class="co"># SULFOXAFLOR (INJECTAR)</span></span>
<span id="cb173-37"><a href="#cb173-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#FF7F00"</span>,  <span class="co"># EPIK B (nuevo color naranja)</span></span>
<span id="cb173-38"><a href="#cb173-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#A6CEE3"</span>   <span class="co"># UNTREATED</span></span>
<span id="cb173-39"><a href="#cb173-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb173-40"><a href="#cb173-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-41"><a href="#cb173-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol2, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb173-42"><a href="#cb173-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> Trtf), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb173-43"><a href="#cb173-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb173-44"><a href="#cb173-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbol2_jitter,</span>
<span id="cb173-45"><a href="#cb173-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> Trtf, <span class="at">fill =</span> Trtf),</span>
<span id="cb173-46"><a href="#cb173-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb173-47"><a href="#cb173-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="fl">0.1</span></span>
<span id="cb173-48"><a href="#cb173-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb173-49"><a href="#cb173-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> arbletras2, <span class="fu">aes</span>(<span class="at">x =</span> Trtf, <span class="at">y =</span> y.pos, <span class="at">label =</span> arbletter),</span>
<span id="cb173-50"><a href="#cb173-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb173-51"><a href="#cb173-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">120</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb173-52"><a href="#cb173-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> x_labels2) <span class="sc">+</span></span>
<span id="cb173-53"><a href="#cb173-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_palette2) <span class="sc">+</span></span>
<span id="cb173-54"><a href="#cb173-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_palette2) <span class="sc">+</span></span>
<span id="cb173-55"><a href="#cb173-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb173-56"><a href="#cb173-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb173-57"><a href="#cb173-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb173-58"><a href="#cb173-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb173-59"><a href="#cb173-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb173-60"><a href="#cb173-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb173-61"><a href="#cb173-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb173-62"><a href="#cb173-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb173-63"><a href="#cb173-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.2</span>),</span>
<span id="cb173-64"><a href="#cb173-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span>
<span id="cb173-65"><a href="#cb173-65" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos en efecto que los tratamientos 1, 3 y 5 son más efectivos en cuanto a mortalidad que 2 y 4 respecto al control.</p>
<p>Ahora para finalizar, procedemos a extraer las predicciones de los efectos aleatorios del modelo (sus esperanzas condicionales que minimizarían el error cuadrático medio), también conocidas como <strong>best linear unbiased predictions</strong> (BLUPs). Estas estimaciones nos permiten conocer, por ejemplo, cómo varía la respuesta en cada nivel del efecto aleatorio una vez tenida en cuenta la estructura fija del modelo. Dicho de otro modo, los BLUPs representan los desvíos específicos de cada unidad (como sujetos, escuelas o grupos) respecto al promedio poblacional predicho por los efectos fijos, ajustados por la varianza estimada de los componentes aleatorios. Obtendremos también las parcelas influyentes (que hemos considerado como tales si el BLUP difiere al menos 2 desviaciones estándar respecto a la media).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer efectos aleatorios (BLUPs)</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>blups <span class="ot">&lt;-</span> <span class="fu">ranef</span>(modelo_21)<span class="sc">$</span>Plotf</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(blups) <span class="ot">&lt;-</span> <span class="st">"BLUP"</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificar parcelas con efectos extremos (más de 2 SD de la media)</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>blups<span class="sc">$</span>DesvStd <span class="ot">&lt;-</span> <span class="fu">scale</span>(blups<span class="sc">$</span>BLUP)</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>parcelas_influyentes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(blups)[<span class="fu">abs</span>(blups<span class="sc">$</span>DesvStd) <span class="sc">&gt;</span> <span class="fl">1.5</span>]</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parcelas_influyentes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "201" "404"</code></pre>
</div>
</div>
<p>Graficamos los intervalos de confianza para los BLUPs en función de la parcela:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot</span>(<span class="fu">ranef</span>(modelo_21, <span class="at">condVar =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Plotf</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Y por colores de tratamiento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 1: Obtener BLUPs con varianza condicional</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>blups <span class="ot">&lt;-</span> <span class="fu">ranef</span>(modelo_21, <span class="at">condVar =</span> <span class="cn">TRUE</span>)</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>blup_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(blups<span class="sc">$</span>Plotf)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>Plotf <span class="ot">&lt;-</span> <span class="fu">rownames</span>(blups<span class="sc">$</span>Plotf)</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer las varianzas condicionales</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>post_vars <span class="ot">&lt;-</span> <span class="fu">attr</span>(blups<span class="sc">$</span>Plotf, <span class="st">"postVar"</span>)[<span class="dv">1</span>, <span class="dv">1</span>, ]  <span class="co"># vector con varianzas</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(post_vars)  <span class="co"># error estándar</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>se <span class="ot">&lt;-</span> se</span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>lower <span class="ot">&lt;-</span> blup_df<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> se</span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>blup_df<span class="sc">$</span>upper <span class="ot">&lt;-</span> blup_df<span class="sc">$</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> se</span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 2: Asegurarse de que 'arbol1' tiene solo una fila por PLOTf</span></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>Trtf <span class="ot">&lt;-</span> arbol2[<span class="sc">!</span><span class="fu">duplicated</span>(arbol2<span class="sc">$</span>Plotf), <span class="fu">c</span>(<span class="st">"Plotf"</span>, <span class="st">"Trtf"</span>)]</span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 3: Merge con tratamientos</span></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a>blup_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(blup_df, Trtf, <span class="at">by =</span> <span class="st">"Plotf"</span>)</span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 4: Ordenar factor PLOTf por valor del intercepto</span></span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>blup_df <span class="ot">&lt;-</span> blup_df <span class="sc">%&gt;%</span></span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Plotf =</span> <span class="fu">factor</span>(Plotf, <span class="at">levels =</span> Plotf))</span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-28"><a href="#cb178-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Paso 5: Graficar con ggplot y barras de error</span></span>
<span id="cb178-29"><a href="#cb178-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(blup_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="at">y =</span> Plotf, <span class="at">color =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb178-30"><a href="#cb178-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb178-31"><a href="#cb178-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">height =</span> <span class="fl">0.2</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb178-32"><a href="#cb178-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"BLUPs por parcela con intervalos de confianza (95%)"</span>,</span>
<span id="cb178-33"><a href="#cb178-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"BLUP del intercepto"</span>,</span>
<span id="cb178-34"><a href="#cb178-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Parcela (Plotf)"</span>,</span>
<span id="cb178-35"><a href="#cb178-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Tratamiento"</span>) <span class="sc">+</span></span>
<span id="cb178-36"><a href="#cb178-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb178-37"><a href="#cb178-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))  <span class="co"># reducir tamaño si hay muchas parcelas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Recordemos que la interpretación es:</p>
<ol type="1">
<li><p><strong>BLUP (eje X)</strong>:</p>
<ul>
<li><p>Representa la desviación de cada parcela respecto al promedio general</p></li>
<li><p>Valores positivos = parcelas con mortalidad <em>por encima</em> del promedio</p></li>
<li><p>Valores negativos = parcelas con mortalidad <em>por debajo</em> del promedio</p></li>
</ul></li>
<li><p><strong>Intervalos de confianza</strong>:</p>
<ul>
<li><p>Si el intervalo cruza cero: La parcela no difiere significativamente del promedio</p></li>
<li><p>Si el intervalo no cruza cero: Efecto significativo (positivo o negativo)</p></li>
</ul></li>
<li><p><strong>Patrones por tratamiento</strong>:</p>
<ul>
<li><p>Agrupamientos de colores similares indicarían que ciertos tratamientos tienden a tener parcelas con efectos similares</p></li>
<li><p>Dispersión de colores mezclados sugeriría que la variabilidad entre parcelas no está fuertemente asociada a los tratamientos</p></li>
</ul></li>
</ol>
</section>
<section id="modelo-2-modelo-lmer-con-logaritmo" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="modelo-2-modelo-lmer-con-logaritmo"><span class="header-section-number">3.3.3</span> Modelo 2: modelo lmer con logaritmo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con intercepto y pendiente aleatoria por Plotf (efecto de tratamiento varía entre parcelas)</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>modelo_22 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="fu">log</span>(mortalidad <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Plotf), <span class="at">data =</span> arbol2)</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: log(mortalidad + 1) ~ Trtf + (1 | Plotf)
   Data: arbol2

REML criterion at convergence: 2032.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.5255 -0.2486  0.1906  0.5702  1.9010 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept) 0.1745   0.4178  
 Residual             0.7723   0.8788  
Number of obs: 768, groups:  Plotf, 24

Fixed effects:
            Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)   2.2300     0.2229 18.0000  10.007 8.84e-09 ***
Trtf1         1.8356     0.3152 18.0000   5.824 1.62e-05 ***
Trtf2         0.8972     0.3152 18.0000   2.847   0.0107 *  
Trtf4         0.6380     0.3152 18.0000   2.024   0.0580 .  
Trtf3         1.9892     0.3152 18.0000   6.312 5.99e-06 ***
Trtf5         1.6911     0.3152 18.0000   5.366 4.24e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf4  Trtf3 
Trtf1 -0.707                            
Trtf2 -0.707  0.500                     
Trtf4 -0.707  0.500  0.500              
Trtf3 -0.707  0.500  0.500  0.500       
Trtf5 -0.707  0.500  0.500  0.500  0.500</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>residuos_simulados22 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_22)</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No sirve, no hay ni normalidad ni homogeneidad.</p>
</section>
<section id="modelo-3-modelo-beta" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="modelo-3-modelo-beta"><span class="header-section-number">3.3.4</span> Modelo 3: modelo beta</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalado lineal al rango (0, 1)</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>mortalidad_esc <span class="ot">&lt;-</span> arbol2<span class="sc">$</span>mortalidad<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar valores 0 y 1</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fl">1e-4</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>mortalidad_esc[arbol2<span class="sc">$</span>mortalidad_esc <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> epsilon</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>arbol2<span class="sc">$</span>mortalidad_esc[arbol2<span class="sc">$</span>mortalidad_esc <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> epsilon</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>modelo_23 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>  mortalidad_esc <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf<span class="sc">:</span>Rete),</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">beta_family</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol2</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_23)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: beta  ( logit )
Formula:          mortalidad_esc ~ Trtf + (1 | Plotf) + (1 | Plotf:Rete)
Data: arbol2

      AIC       BIC    logLik -2*log(L)  df.resid 
   -928.7    -886.9     473.4    -946.7       759 

Random effects:

Conditional model:
 Groups     Name        Variance Std.Dev.
 Plotf      (Intercept) 0.1749   0.4182  
 Plotf:Rete (Intercept) 0.5931   0.7701  
Number of obs: 768, groups:  Plotf, 24; Plotf:Rete, 96

Dispersion parameter for beta family (): 3.72 

Conditional model:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.8306     0.2995  -6.113 9.80e-10 ***
Trtf1         2.8619     0.4229   6.767 1.32e-11 ***
Trtf2         0.9449     0.4208   2.246   0.0247 *  
Trtf4         0.7253     0.4208   1.724   0.0848 .  
Trtf3         2.7767     0.4228   6.567 5.14e-11 ***
Trtf5         2.3362     0.4217   5.540 3.03e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>residuos_simulados23 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo_23)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos_simulados23)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Tampoco vale porque no hay ni normalidad ni homogeneidad.</p>
</section>
<section id="modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad-1" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="modelo-4-modelo-lineal-con-nlme-con-heterocedasticidad-1"><span class="header-section-number">3.3.5</span> Modelo 4: modelo lineal con nlme con heterocedasticidad</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>modelo_21_nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  mortalidad <span class="sc">~</span> Trtf,</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Plotf,</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol2,</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Trtf)  <span class="co"># Permite varianzas distintas por nivel de Trtf</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by REML
  Data: arbol2 
       AIC      BIC    logLik
  6718.935 6779.202 -3346.467

Random effects:
 Formula: ~1 | Plotf
        (Intercept) Residual
StdDev:    12.04336 16.89571

Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | Trtf 
 Parameter estimates:
        2         4         6         1         3         5 
1.0000000 1.1975404 0.6601942 1.2798124 1.1370988 1.5364439 
Fixed effects:  mortalidad ~ Trtf 
               Value Std.Error  DF  t-value p-value
(Intercept) 13.63640  6.101859 744 2.234795  0.0257
Trtf1       56.85454  8.783291  18 6.473034  0.0000
Trtf2       14.92421  8.701926  18 1.715047  0.1035
Trtf4       15.47131  8.757377  18 1.766660  0.0942
Trtf3       56.82434  8.739390  18 6.502094  0.0000
Trtf5       47.80911  8.874573  18 5.387201  0.0000
 Correlation: 
      (Intr) Trtf1  Trtf2  Trtf4  Trtf3 
Trtf1 -0.695                            
Trtf2 -0.701  0.487                     
Trtf4 -0.697  0.484  0.489              
Trtf3 -0.698  0.485  0.490  0.486       
Trtf5 -0.688  0.478  0.482  0.479  0.480

Standardized Within-Group Residuals:
        Min          Q1         Med          Q3         Max 
-3.15629083 -0.68972061  0.01989474  0.71366977  3.77269418 

Number of Observations: 768
Number of Groups: 24 </code></pre>
</div>
</div>
<p>Procedemos a hacer el diagnóstico completo del modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_ad_bootstrap_normaliz</span>(modelo_21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-82-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-82-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling con bootstrap paramétrico (3000 réplicas)

data:  Residuos normalizados de modelo_21_nlme
AD = 0.67012, p-value = 0.59</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 4. R² marginal y condicional (explicación del modelo) ----</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(modelo_21_nlme)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Marginal R² (Treatment):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2m"</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal R² (Treatment): 54.361 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Conditional R² (Treatment + Plots):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2c"</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional R² (Treatment + Plots): 69.737 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance proportion explained by the plots in the model:"</span>, <span class="fu">round</span>((r2[<span class="dv">1</span>, <span class="st">"R2c"</span>] <span class="sc">-</span> r2[<span class="dv">1</span>, <span class="st">"R2m"</span>])<span class="sc">*</span><span class="dv">100</span>, <span class="dv">3</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance proportion explained by the plots in the model: 15.376 %</code></pre>
</div>
</div>
<p>El modelo <strong>verifica las hipótesis de normalidad</strong>, ya que <strong>p &gt; 0.05</strong>. Así, el modelo es bueno. La <span class="math inline">\(R_{\text{marginal}}^2 = 0.544\)</span>, <span class="math inline">\(R_{\text{condicional}}^2 = 0.697\)</span> y la variabilidad que explica Plotf es del <strong>15.4%</strong>. Vemos además si mejora significativamente el modelo lineal mixto:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logLik(modelo_21)</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="co"># logLik(modelo_21_nlme)</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternativa para más detalle: paso a nlme el modelo homocedástico</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a><span class="co">#para compararlos y veo el p-valor (en este caso es mejor #claramente modelo_21_nlme)</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>modelo_21_lme <span class="ot">&lt;-</span>  <span class="fu">lme</span>(</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> mortalidad <span class="sc">~</span> Trtf,</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Plotf,</span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol2</span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo_21_lme, modelo_21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Model df      AIC      BIC    logLik   Test  L.Ratio p-value
modelo_21_lme      1  8 6796.683 6833.771 -3390.342                        
modelo_21_nlme     2 13 6718.935 6779.202 -3346.467 1 vs 2 87.74876  &lt;.0001</code></pre>
</div>
</div>
<p>El modelo que permite varianzas diferentes por tratamiento (<code>modelo_21_nlme</code>) mejora significativamente el ajuste. Por tanto, <strong>deberíamos usar <code>modelo_21_nlme</code></strong> como modelo final si se cumple la normalidad como veremos después.</p>
<p>Hacemos análisis de la deviance para el modelo nuevo que permite heterocedasticidad.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_21_nlme, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mortalidad
              Chisq Df Pr(&gt;Chisq)    
(Intercept)  4.9943  1    0.02543 *  
Trtf        79.1939  5  1.237e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Estudiamos las diferencias de medias marginales para los pares:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar medias marginales para Trtf con modelo nlme</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>emmeans_trat21_nlme <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo_21_nlme, <span class="sc">~</span> Trtf)</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emmeans_trat21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL
 6      13.6 6.10 23     1.01     26.3
 1      70.5 6.32 18    57.22     83.8
 2      28.6 6.20 18    15.53     41.6
 4      29.1 6.28 18    15.91     42.3
 3      70.5 6.26 18    57.32     83.6
 5      61.4 6.44 18    47.91     75.0

Degrees-of-freedom method: containment 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaciones pareadas ajustando p con FDR</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>comparaciones21_nlme <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans_trat21_nlme, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparaciones21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast      estimate   SE df t.ratio p.value
 Trtf6 - Trtf1 -56.8545 8.78 18  -6.473  &lt;.0001
 Trtf6 - Trtf2 -14.9242 8.70 18  -1.715  0.1411
 Trtf6 - Trtf4 -15.4713 8.76 18  -1.767  0.1411
 Trtf6 - Trtf3 -56.8243 8.74 18  -6.502  &lt;.0001
 Trtf6 - Trtf5 -47.8091 8.87 18  -5.387  0.0002
 Trtf1 - Trtf2  41.9303 8.85 18   4.735  0.0004
 Trtf1 - Trtf4  41.3832 8.91 18   4.645  0.0004
 Trtf1 - Trtf3   0.0302 8.89 18   0.003  0.9973
 Trtf1 - Trtf5   9.0454 9.02 18   1.002  0.3802
 Trtf2 - Trtf4  -0.5471 8.83 18  -0.062  0.9973
 Trtf2 - Trtf3 -41.9001 8.81 18  -4.755  0.0004
 Trtf2 - Trtf5 -32.8849 8.95 18  -3.676  0.0032
 Trtf4 - Trtf3 -41.3530 8.87 18  -4.664  0.0004
 Trtf4 - Trtf5 -32.3378 9.00 18  -3.593  0.0035
 Trtf3 - Trtf5   9.0152 8.98 18   1.004  0.3802

Degrees-of-freedom method: containment 
P value adjustment: fdr method for 15 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot sencillo de comparaciones</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Letras para grupos estadísticamente diferentes (cld)</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>letras21_nlme <span class="ot">&lt;-</span> <span class="fu">cld</span>(emmeans_trat21_nlme, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(letras21_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 6      13.6 6.10 23    -3.98     31.2  a    
 2      28.6 6.20 18    10.18     46.9  a    
 4      29.1 6.28 18    10.50     47.7  a    
 5      61.4 6.44 18    42.35     80.5   b   
 3      70.5 6.26 18    51.92     89.0   b   
 1      70.5 6.32 18    51.77     89.2   b   

Degrees-of-freedom method: containment 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>Las letras coinciden de hecho con lo que habíamos obtenido del modelo 1, el modelo detecta exactamente las mismas diferencias.</p>
</section>
</section>
<section id="sec-folsegunda" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-folsegunda"><span class="header-section-number">3.4</span> P2 - ¿Es más eficaz foliar o inyectar?</h2>
<p>Hacemos un diagrama de árbol similar para 2018 (como hicimos en la pregunta 2 en 2017):</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  Treatments --&gt; SULFOXAFLOR
  Treatments --&gt; CONFIDOR
  Treatments --&gt; EPIK
  Treatments --&gt; UNTREATED

  SULFOXAFLOR --&gt; INJECTION_SULFO[INJECTION]
  CONFIDOR --&gt; FOLIAR_CONFIDOR[FOLIAR APPLICATION]
  EPIK --&gt; FOLIAR_EPIK[FOLIAR APPLICATION]
  EPIK --&gt; INJECTION_EPIK[INJECTION]

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Tal y como hicimos para 2017 en <a href="#sec-folprimera">P2 - ¿Es más eficaz foliar o inyectar?</a>, mediante pooling de los datos, creamos un factor fijo a estudiar <code>categ2</code> según los tratamientos y aplicaciones en 2018.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>arbol2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">categ2 =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"UNTREATED"</span>,</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"SULFOXAFLOR_FOLIAR_400"</span>,   <span class="co"># Aplicación A</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"EPIK_FOLIAR_1500"</span>,         <span class="co"># Aplicación A</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"SULFOXAFLOR_INJECT_400"</span>,   <span class="co"># Aplicación B</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>      Trt <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"EPIK_INJECT_1500"</span>          <span class="co"># Aplicación B</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># otros valores → NA</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">categ2 =</span> <span class="fu">relevel</span>(categ2, <span class="at">ref =</span> <span class="st">"UNTREATED"</span>)</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear nuevo dataframe sin NA en categ2</span></span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>arbol2_sinNA <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(categ2))</span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar niveles</span></span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(arbol2_sinNA<span class="sc">$</span>categ2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UNTREATED"              "EPIK_FOLIAR_1500"       "EPIK_INJECT_1500"      
[4] "SULFOXAFLOR_FOLIAR_400" "SULFOXAFLOR_INJECT_400"</code></pre>
</div>
</div>
<p>Ahora planteamos varios modelos:</p>
<section id="modelo-1-modelo-lineal-mixto-con-lmer-3" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="modelo-1-modelo-lineal-mixto-con-lmer-3"><span class="header-section-number">3.4.1</span> Modelo 1: Modelo lineal mixto con lmer</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Modelo 1 (lmer, modelo lineal mixto, family = gaussian)</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>modelo2_lmerfol <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad <span class="sc">~</span> categ2 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf), <span class="at">data =</span> arbol2_sinNA)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo2_lmerfol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad ~ categ2 + (1 | Plotf)
   Data: arbol2_sinNA

REML criterion at convergence: 5622.4

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.3865 -0.6166  0.0107  0.6090  2.7714 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept) 123.7    11.12   
 Residual             372.5    19.30   
Number of obs: 640, groups:  Plotf, 20

Fixed effects:
                             Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)                    13.636      5.816 15.000   2.345   0.0332 *  
categ2EPIK_FOLIAR_1500         56.824      8.225 15.000   6.909 4.98e-06 ***
categ2EPIK_INJECT_1500         47.809      8.225 15.000   5.813 3.42e-05 ***
categ2SULFOXAFLOR_FOLIAR_400   14.924      8.225 15.000   1.815   0.0896 .  
categ2SULFOXAFLOR_INJECT_400   15.471      8.225 15.000   1.881   0.0795 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                (Intr) c2EPIK_F c2EPIK_I c2SULFOXAFLOR_F
c2EPIK_FOLI     -0.707                                  
c2EPIK_INJE     -0.707  0.500                           
c2SULFOXAFLOR_F -0.707  0.500    0.500                  
c2SULFOXAFLOR_I -0.707  0.500    0.500    0.500         </code></pre>
</div>
</div>
<p>Veo el DHARMa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>residuos2_simulados_lmerfol <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> modelo2_lmerfol)</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuos2_simulados_lmerfol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>No me vale, porque no tenemos ni normalidad ni homocedasticidad.</p>
</section>
<section id="modelo-2-modelo-lineal-con-nlme-con-heterocedasticidad" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="modelo-2-modelo-lineal-con-nlme-con-heterocedasticidad"><span class="header-section-number">3.4.2</span> Modelo 2: modelo lineal con nlme con heterocedasticidad</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>modelo2_22_nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  mortalidad <span class="sc">~</span> categ2,</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> Plotf,</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> arbol2_sinNA,</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> categ2),  <span class="co"># Permite varianzas distintas por nivel de categ</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo2_13_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by REML
  Data: arbol1_sinNA 
       AIC      BIC    logLik
  2509.592 2556.936 -1241.796

Random effects:
 Formula: ~1 | PLOTf
        (Intercept) Residual
StdDev:      0.0131 30.48573

Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | categ 
 Parameter estimates:
SULFOXAFLOR_INJECT_400    CONFIDOR_FOLIAR_750              UNTREATED 
             1.0000000              0.7529821              0.3138300 
   CONFIDOR_INJECT_750 SULFOXAFLOR_FOLIAR_200 SULFOXAFLOR_FOLIAR_400 
             0.4998082              0.7766235              0.6349895 
Fixed effects:  mortalidad ~ categ 
                               Value Std.Error  DF   t-value p-value
(Intercept)                 19.75019  1.380942 264 14.301973  0.0000
categCONFIDOR_FOLIAR_750    57.83752  3.589567  18 16.112671  0.0000
categCONFIDOR_INJECT_750     3.05914  2.596892  18  1.177999  0.2541
categSULFOXAFLOR_FOLIAR_200 15.85215  3.685806  18  4.300863  0.0004
categSULFOXAFLOR_FOLIAR_400 20.28981  3.116739  18  6.509948  0.0000
categSULFOXAFLOR_INJECT_400 17.85466  4.611846  18  3.871478  0.0011
 Correlation: 
                            (Intr) cCONFIDOR_F cCONFIDOR_I
categCONFIDOR_FOLIAR_750    -0.385                        
categCONFIDOR_INJECT_750    -0.532  0.205                 
categSULFOXAFLOR_FOLIAR_200 -0.375  0.144       0.199     
categSULFOXAFLOR_FOLIAR_400 -0.443  0.170       0.236     
categSULFOXAFLOR_INJECT_400 -0.299  0.115       0.159     
                            cSULFOXAFLOR_FOLIAR_2 cSULFOXAFLOR_FOLIAR_4
categCONFIDOR_FOLIAR_750                                               
categCONFIDOR_INJECT_750                                               
categSULFOXAFLOR_FOLIAR_200                                            
categSULFOXAFLOR_FOLIAR_400  0.166                                     
categSULFOXAFLOR_INJECT_400  0.112                 0.133               

Standardized Within-Group Residuals:
        Min          Q1         Med          Q3         Max 
-2.73457929 -0.80928195  0.02611317  0.74900739  2.69215785 

Number of Observations: 288
Number of Groups: 24 </code></pre>
</div>
</div>
<p>Hacemos un diagnóstico completo del modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_ad_bootstrap_normaliz</span>(modelo2_22_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-93-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-93-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling con bootstrap paramétrico (3000 réplicas)

data:  Residuos normalizados de modelo2_22_nlme
AD = 0.48851, p-value = 0.7557</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 4. R² marginal y condicional (explicación del modelo) ----</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">r.squaredGLMM</span>(modelo2_22_nlme)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² marginal (Trtf):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2m"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² marginal (Trtf): 0.535 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R² condicional (Trtf + Plotf):"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2c"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² condicional (Trtf + Plotf): 0.673 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Proporción atribuida a Plotf:"</span>, <span class="fu">round</span>(r2[<span class="dv">1</span>, <span class="st">"R2c"</span>] <span class="sc">-</span> r2[<span class="dv">1</span>, <span class="st">"R2m"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Proporción atribuida a Plotf: 0.138 </code></pre>
</div>
</div>
<p>El modelo <strong>verifica las hipótesis de normalidad</strong>, ya que <strong>p &gt; 0.05</strong>. Así, el modelo es bueno. La <span class="math inline">\(R_{\text{marginal}}^2 = 0.535\)</span>, <span class="math inline">\(R_{\text{condicional}}^2 = 0.673\)</span> y la variabilidad que explica Plotf es del <strong>13.8%.</strong> Usamos este modelo ya que el modelo lineal mixto ni verificaba la normalidad ni la homogeneidad de varianzas (no comparamos los modelos, directamente).</p>
<p>Hacemos análisis de la deviance para este modelo, que tiene en cuenta la heterocedasticidad de los residuos con los pesos para las varianzas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modelo_21_nlme, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mortalidad
              Chisq Df Pr(&gt;Chisq)    
(Intercept)  4.9943  1    0.02543 *  
Trtf        79.1939  5  1.237e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Estudiamos las diferencias de medias marginales para los pares:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcompView)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar medias marginales para Trtf con modelo nlme</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>emmeans2_trat22_nlme <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(modelo2_22_nlme, <span class="sc">~</span> categ2)</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(emmeans2_trat22_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> categ2                 emmean   SE df lower.CL upper.CL
 UNTREATED                13.6 5.57 19     1.98     25.3
 EPIK_FOLIAR_1500         70.5 5.74 15    58.23     82.7
 EPIK_INJECT_1500         61.4 5.94 15    48.78     74.1
 SULFOXAFLOR_FOLIAR_400   28.6 5.68 15    16.45     40.7
 SULFOXAFLOR_INJECT_400   29.1 5.77 15    16.82     41.4

Degrees-of-freedom method: containment 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparaciones pareadas ajustando p con FDR</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>comparaciones2_22_nlme <span class="ot">&lt;-</span> <span class="fu">pairs</span>(emmeans2_trat22_nlme, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparaciones2_22_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                                        estimate   SE df t.ratio
 UNTREATED - EPIK_FOLIAR_1500                     -56.824 8.00 15  -7.105
 UNTREATED - EPIK_INJECT_1500                     -47.809 8.15 15  -5.869
 UNTREATED - SULFOXAFLOR_FOLIAR_400               -14.924 7.96 15  -1.876
 UNTREATED - SULFOXAFLOR_INJECT_400               -15.471 8.02 15  -1.930
 EPIK_FOLIAR_1500 - EPIK_INJECT_1500                9.015 8.26 15   1.091
 EPIK_FOLIAR_1500 - SULFOXAFLOR_FOLIAR_400         41.900 8.08 15   5.188
 EPIK_FOLIAR_1500 - SULFOXAFLOR_INJECT_400         41.353 8.14 15   5.083
 EPIK_INJECT_1500 - SULFOXAFLOR_FOLIAR_400         32.885 8.22 15   3.999
 EPIK_INJECT_1500 - SULFOXAFLOR_INJECT_400         32.338 8.28 15   3.905
 SULFOXAFLOR_FOLIAR_400 - SULFOXAFLOR_INJECT_400   -0.547 8.10 15  -0.068
 p.value
  &lt;.0001
  0.0002
  0.1004
  0.1004
  0.3249
  0.0003
  0.0003
  0.0023
  0.0023
  0.9470

Degrees-of-freedom method: containment 
P value adjustment: fdr method for 10 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot sencillo de comparaciones</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(comparaciones2_22_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos el cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Letras para grupos estadísticamente diferentes (cld)</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>letras2_22_nlme <span class="ot">&lt;-</span> <span class="fu">cld</span>(emmeans2_trat22_nlme, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(letras2_22_nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> categ2                 emmean   SE df lower.CL upper.CL .group
 UNTREATED                13.6 5.57 19     -2.3     29.6  a    
 SULFOXAFLOR_FOLIAR_400   28.6 5.68 15     11.8     45.3  a    
 SULFOXAFLOR_INJECT_400   29.1 5.77 15     12.1     46.1  a    
 EPIK_INJECT_1500         61.4 5.94 15     43.9     79.0   b   
 EPIK_FOLIAR_1500         70.5 5.74 15     53.5     87.4   b   

Degrees-of-freedom method: containment 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 5 estimates 
P value adjustment: fdr method for 10 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>Hacemos el boxplot + dotplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe paleta 2018: 6 tratamientos originales (no se elimina ninguno)</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>pal_2018 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">categ2 =</span> <span class="fu">c</span>(</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_FOLIAR_400"</span>,</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_INJECT_400"</span>,</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK_FOLIAR_1500"</span>,</span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK_INJECT_1500"</span>,</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_INJECT_750"</span></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(</span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (400 ml/ha, FOL)"</span>,</span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (400 ml/ha, INJ)"</span>,</span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK (1500 g/ha, INJ)"</span>,</span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK (1500 g/ha, FOL)"</span>,</span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOL)"</span></span>
<span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(</span>
<span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>,   <span class="co"># UNTREATED</span></span>
<span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B2DF8A"</span>,   <span class="co"># SULFOXAFLOR_FOLIAR_400</span></span>
<span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#33A02C"</span>,   <span class="co"># SULFOXAFLOR_INJECT_400</span></span>
<span id="cb230-26"><a href="#cb230-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#6A3D9A"</span>,   <span class="co"># EPIK_FOLIAR_1500</span></span>
<span id="cb230-27"><a href="#cb230-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FF7F00"</span>,   <span class="co"># EPIK_INJECT_1500</span></span>
<span id="cb230-28"><a href="#cb230-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>    <span class="co"># CONFIDOR_FOLIAR_750</span></span>
<span id="cb230-29"><a href="#cb230-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb230-30"><a href="#cb230-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb230-31"><a href="#cb230-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb230-32"><a href="#cb230-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-33"><a href="#cb230-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector de colores para el gráfico</span></span>
<span id="cb230-34"><a href="#cb230-34" aria-hidden="true" tabindex="-1"></a>pal_2018_vec <span class="ot">&lt;-</span> <span class="fu">setNames</span>(pal_2018<span class="sc">$</span>color, pal_2018<span class="sc">$</span>categ2)</span>
<span id="cb230-35"><a href="#cb230-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-36"><a href="#cb230-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Tus datos de letras de grupo y jitter (igual que en tu código)</span></span>
<span id="cb230-37"><a href="#cb230-37" aria-hidden="true" tabindex="-1"></a>arbletras2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb230-38"><a href="#cb230-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">categ2 =</span> <span class="fu">factor</span>(<span class="fu">c</span>(</span>
<span id="cb230-39"><a href="#cb230-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb230-40"><a href="#cb230-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_FOLIAR_400"</span>,</span>
<span id="cb230-41"><a href="#cb230-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SULFOXAFLOR_INJECT_400"</span>,</span>
<span id="cb230-42"><a href="#cb230-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK_INJECT_1500"</span>,</span>
<span id="cb230-43"><a href="#cb230-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK_FOLIAR_1500"</span></span>
<span id="cb230-44"><a href="#cb230-44" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">levels =</span> <span class="fu">levels</span>(arbol2_sinNA<span class="sc">$</span>categ2)),</span>
<span id="cb230-45"><a href="#cb230-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">emmean =</span> <span class="fu">c</span>(<span class="fl">13.6</span>, <span class="fl">28.6</span>, <span class="fl">29.1</span>, <span class="fl">61.4</span>, <span class="fl">70.5</span>),</span>
<span id="cb230-46"><a href="#cb230-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> <span class="fu">c</span>(<span class="fl">5.57</span>, <span class="fl">5.68</span>, <span class="fl">5.77</span>, <span class="fl">5.94</span>, <span class="fl">5.74</span>),</span>
<span id="cb230-47"><a href="#cb230-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">15</span>),</span>
<span id="cb230-48"><a href="#cb230-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower.CL =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.3</span>, <span class="fl">11.8</span>, <span class="fl">12.1</span>, <span class="fl">43.9</span>, <span class="fl">53.5</span>),</span>
<span id="cb230-49"><a href="#cb230-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper.CL =</span> <span class="fu">c</span>(<span class="fl">29.6</span>, <span class="fl">45.3</span>, <span class="fl">46.1</span>, <span class="fl">79.0</span>, <span class="fl">87.4</span>),</span>
<span id="cb230-50"><a href="#cb230-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">.group =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>)</span>
<span id="cb230-51"><a href="#cb230-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb230-52"><a href="#cb230-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-53"><a href="#cb230-53" aria-hidden="true" tabindex="-1"></a>arbol2_jitter <span class="ot">&lt;-</span> arbol2_sinNA <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="dv">1</span>)</span>
<span id="cb230-54"><a href="#cb230-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-55"><a href="#cb230-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Posiciones para las letras</span></span>
<span id="cb230-56"><a href="#cb230-56" aria-hidden="true" tabindex="-1"></a>posiciones_letras2 <span class="ot">&lt;-</span> arbol2_sinNA <span class="sc">%&gt;%</span></span>
<span id="cb230-57"><a href="#cb230-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(categ2) <span class="sc">%&gt;%</span></span>
<span id="cb230-58"><a href="#cb230-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">y.pos =</span> <span class="fu">max</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">8</span>)</span>
<span id="cb230-59"><a href="#cb230-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-60"><a href="#cb230-60" aria-hidden="true" tabindex="-1"></a>arbletras2 <span class="ot">&lt;-</span> arbletras2 <span class="sc">%&gt;%</span></span>
<span id="cb230-61"><a href="#cb230-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(posiciones_letras2, <span class="at">by =</span> <span class="st">"categ2"</span>)</span>
<span id="cb230-62"><a href="#cb230-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-63"><a href="#cb230-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico</span></span>
<span id="cb230-64"><a href="#cb230-64" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(arbol2_sinNA, <span class="fu">aes</span>(<span class="at">x =</span> categ2, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb230-65"><a href="#cb230-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> categ2), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb230-66"><a href="#cb230-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb230-67"><a href="#cb230-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbol2_jitter,</span>
<span id="cb230-68"><a href="#cb230-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> categ2, <span class="at">fill =</span> categ2),</span>
<span id="cb230-69"><a href="#cb230-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb230-70"><a href="#cb230-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="fl">0.1</span></span>
<span id="cb230-71"><a href="#cb230-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb230-72"><a href="#cb230-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb230-73"><a href="#cb230-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arbletras2,</span>
<span id="cb230-74"><a href="#cb230-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> categ2, <span class="at">y =</span> y.pos, <span class="at">label =</span> .group),</span>
<span id="cb230-75"><a href="#cb230-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb230-76"><a href="#cb230-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb230-77"><a href="#cb230-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fu">max</span>(arbletras2<span class="sc">$</span>y.pos) <span class="sc">+</span> <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb230-78"><a href="#cb230-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_2018_vec) <span class="sc">+</span></span>
<span id="cb230-79"><a href="#cb230-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_2018_vec) <span class="sc">+</span></span>
<span id="cb230-80"><a href="#cb230-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aquí el mapeo a los nombres largos del eje X:</span></span>
<span id="cb230-81"><a href="#cb230-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">setNames</span>(pal_2018<span class="sc">$</span>label, pal_2018<span class="sc">$</span>categ2)) <span class="sc">+</span></span>
<span id="cb230-82"><a href="#cb230-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb230-83"><a href="#cb230-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb230-84"><a href="#cb230-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% Mortality"</span></span>
<span id="cb230-85"><a href="#cb230-85" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb230-86"><a href="#cb230-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb230-87"><a href="#cb230-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb230-88"><a href="#cb230-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb230-89"><a href="#cb230-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb230-90"><a href="#cb230-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.2</span>),</span>
<span id="cb230-91"><a href="#cb230-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.1</span>)</span>
<span id="cb230-92"><a href="#cb230-92" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="p3---qué-tratamiento-es-más-persistente" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> P3 - ¿Qué tratamiento es más persistente?</h1>
<section id="treatment-palette-para-gráficos" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="treatment-palette-para-gráficos"><span class="header-section-number">4.1</span> Treatment palette para gráficos</h2>
<p>Para asegurar por si hubiera algún problemilla con la asignación de colores por tratamientos, creamos una paleta de colores para nuestros tratamientos ya.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>treatment_palette_extended <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">code =</span> <span class="fu">c</span>(</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_INJECT_750"</span>,</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF2626_FOLIAR_200"</span>,</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF2626_FOLIAR_400"</span>,</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF2626_INJECT_400"</span>,</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK_FOLIAR_1500"</span>,</span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK_INJECT_1500"</span>,</span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KARATE_ZEON_FOLIAR_250"</span></span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(</span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"UNTREATED"</span>,</span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD (750 ml/ha, Injection)"</span>,</span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CONFIDOR 200 OD (750 ml/ha, Foliar)"</span>,</span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (200 ml/ha, Injection)"</span>,</span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (400 ml/ha, Foliar)"</span>,</span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GF-2626 (400 ml/ha, Injection)"</span>,</span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK (1500 g/ha, Foliar)"</span>,</span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPIK (1500 g/ha, Injection)"</span>,</span>
<span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KARATE ZEON 10CS (250 ml/ha, Injection)"</span></span>
<span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(</span>
<span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A6CEE3"</span>,  <span class="co"># UNTREATED</span></span>
<span id="cb231-26"><a href="#cb231-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#E31A1C"</span>,  <span class="co"># CONFIDOR_INJECT_750</span></span>
<span id="cb231-27"><a href="#cb231-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FB9A99"</span>,  <span class="co"># CONFIDOR_FOLIAR_750</span></span>
<span id="cb231-28"><a href="#cb231-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#1F78B4"</span>,  <span class="co"># GF2626_FOLIAR_200</span></span>
<span id="cb231-29"><a href="#cb231-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B2DF8A"</span>,  <span class="co"># GF2626_FOLIAR_400</span></span>
<span id="cb231-30"><a href="#cb231-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#33A02C"</span>,  <span class="co"># GF2626_INJECT_400</span></span>
<span id="cb231-31"><a href="#cb231-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#6A3D9A"</span>,  <span class="co"># EPIK_FOLIAR_1500</span></span>
<span id="cb231-32"><a href="#cb231-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FF7F00"</span>,  <span class="co"># EPIK_INJECT_1500</span></span>
<span id="cb231-33"><a href="#cb231-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FDBF6F"</span>   <span class="co"># KARATE_ZEON_FOLIAR_250</span></span>
<span id="cb231-34"><a href="#cb231-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb231-35"><a href="#cb231-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_2017 =</span> <span class="fu">c</span>(</span>
<span id="cb231-36"><a href="#cb231-36" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>,           <span class="co"># UNTREATED</span></span>
<span id="cb231-37"><a href="#cb231-37" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>,           <span class="co"># CONFIDOR_INJECT_750 (FOL)</span></span>
<span id="cb231-38"><a href="#cb231-38" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>,           <span class="co"># CONFIDOR_FOLIAR_750 (INJ)</span></span>
<span id="cb231-39"><a href="#cb231-39" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,           <span class="co"># GF2626_FOLIAR_200 (FOL)</span></span>
<span id="cb231-40"><a href="#cb231-40" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>,           <span class="co"># GF2626_FOLIAR_400 (FOL)</span></span>
<span id="cb231-41"><a href="#cb231-41" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>,           <span class="co"># GF2626_INJECT_400 (INJ)</span></span>
<span id="cb231-42"><a href="#cb231-42" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>,          <span class="co"># EPIK_FOLIAR_1500 (NO EN 2017)</span></span>
<span id="cb231-43"><a href="#cb231-43" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>,          <span class="co"># EPIK_INJECT_1500 (NO EN 2017)</span></span>
<span id="cb231-44"><a href="#cb231-44" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>            <span class="co"># KARATE_ZEON_FOLIAR_250 (FOL)</span></span>
<span id="cb231-45"><a href="#cb231-45" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb231-46"><a href="#cb231-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_2018 =</span> <span class="fu">c</span>(</span>
<span id="cb231-47"><a href="#cb231-47" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>,           <span class="co"># UNTREATED</span></span>
<span id="cb231-48"><a href="#cb231-48" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>,           <span class="co"># CONFIDOR_INJECT_750 (INJ, NO EN 2018)</span></span>
<span id="cb231-49"><a href="#cb231-49" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,           <span class="co"># CONFIDOR_FOLIAR_750 (FOL)</span></span>
<span id="cb231-50"><a href="#cb231-50" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>,          <span class="co"># GF2626_FOLIAR_200 (FOL, NO EN 2018)</span></span>
<span id="cb231-51"><a href="#cb231-51" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>,           <span class="co"># GF2626_FOLIAR_400 (FOL)</span></span>
<span id="cb231-52"><a href="#cb231-52" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>,           <span class="co"># GF2626_INJECT_400 (INJ)</span></span>
<span id="cb231-53"><a href="#cb231-53" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>,           <span class="co"># EPIK_FOLIAR_1500 (FOL)</span></span>
<span id="cb231-54"><a href="#cb231-54" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>,           <span class="co"># EPIK_INJECT_1500 (INJ)</span></span>
<span id="cb231-55"><a href="#cb231-55" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>           <span class="co"># KARATE_ZEON_FOLIAR_250 (FOL, NO EN 2018)</span></span>
<span id="cb231-56"><a href="#cb231-56" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb231-57"><a href="#cb231-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb231-58"><a href="#cb231-58" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualización-de-datos-de-2017" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="visualización-de-datos-de-2017"><span class="header-section-number">4.2</span> Visualización de datos de 2017</h2>
<p>Ahora queremos ver qué tratamiento es más persistente en el tiempo. Para ello vamos a ver primero los codos de cada una de las curvas para cada tratamiento y rama de árbol. Entonces tenemos que:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>curvas_trt1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf, periodo) <span class="sc">%&gt;%</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mortalidad =</span> <span class="fu">mean</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creamos ahora la función <code>elbow</code>, que nos devuelve la posición del codo respecto de la variable periodo (es decir, en qué periodo está el codo) teniendo como variable objetivo la mortalidad. Así, sean <span class="math inline">\((x_1, y_1), (x_2, y_2), \ldots, (x_n, y_n)\)</span> una secuencia de puntos ordenados en el plano que definen una curva discreta.</p>
<p>Se define el <strong>codo</strong> (elbow) como el índice <span class="math inline">\(i^{*}\)</span> tal que</p>
<p><span class="math display">\[
i^* = \underset{i \in \{2, \ldots, n-1\}}{\arg\max} \; d(i)
\]</span></p>
<p>donde <span class="math inline">\(d(i)\)</span> es la distancia perpendicular desde el punto <span class="math inline">\((x_i, y_i)\)</span> al segmento que une los extremos <span class="math inline">\((x_1, y_1)\)</span> y <span class="math inline">\((x_n, y_n)\)</span>, dada por:</p>
<p><span class="math display">\[
d(i) = \frac{
\left|
\begin{vmatrix}
x_n - x_1 &amp; y_n - y_1 \\
x_i - x_1 &amp; y_i - y_1
\end{vmatrix}
\right|
}{
\sqrt{(x_n - x_1)^2 + (y_n - y_1)^2}
}
\]</span></p>
<p>El índice <span class="math inline">\(i^{\ast}\)</span> corresponde al punto de la curva que maximiza la distancia ortogonal respecto al segmento entre los extremos, y suele interpretarse como el “codo” de la curva. El codo será esencialmente el punto de una curva donde se produce un cambio significativo en la pendiente o la curvatura (donde se dobla más la curva).</p>
<p>Cabe destacar que nos interesa estudiar esto ya que es el punto donde se observa un mayor cambio de tendencia en la mortalidad, lo que a simple vista va a indicar independientemente de la introducción de insectos el punto más tardío de “mayor eficacia” del tratamiento y donde pondremos nuestro umbral para definir persistencia, que definiremos como</p>
<p><span class="math display">\[
\Delta_{mortalidad} = mortalidad_{codo}-mortalidad_{periodo-final}
\]</span></p>
<p>Entonces, implementamos lo anterior en R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>elbow <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x))</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(y)</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x, y)</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(n<span class="dv">-1</span>)) {</span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> a[<span class="dv">1</span>, ]</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="ot">&lt;-</span> a[n, ]</span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>    p3 <span class="ot">&lt;-</span> a[i, ]</span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>    d[i] <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">det</span>(<span class="fu">rbind</span>(p2<span class="sc">-</span>p1, p3<span class="sc">-</span>p1))) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((p2<span class="sc">-</span>p1)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which.max</span>(d)</span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(webshot2) <span class="co"># solo si quieres guardar como PNG</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'webshot2' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula codos</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>codos_trt1 <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">periodo_codo =</span> periodo[<span class="fu">elbow</span>(periodo, mortalidad)],</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo =</span> mortalidad[<span class="fu">elbow</span>(periodo, mortalidad)],</span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Manualmente asigna los labels en inglés</span></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (debe tener la misma longitud y orden que tus niveles de Trtf)</span></span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>treatment_labels_en <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF-2626 (200 ml/ha, Injection)"</span>,</span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF-2626 (400 ml/ha, Foliar)"</span>,</span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF-2626 (400 ml/ha, Injection)"</span>,</span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CONFIDOR 200 OD (750 ml/ha, Foliar)"</span>,</span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CONFIDOR 200 OD (750 ml/ha, Injection)"</span>,</span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KARATE ZEON 10CS (250 ml/ha, Injection)"</span>,</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UNTREATED"</span></span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegúrate de que el orden coincida con levels(codos_trt1$Trtf)</span></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>codos_trt1<span class="sc">$</span>Treatment <span class="ot">&lt;-</span> treatment_labels_en[<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(codos_trt1<span class="sc">$</span>Trtf))]</span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Reordena las columnas a mano</span></span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>codos_trt1_out <span class="ot">&lt;-</span> codos_trt1[, <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"periodo_codo"</span>, <span class="st">"mortalidad_codo"</span>)]</span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombres de columnas en inglés</span></span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(codos_trt1_out) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"Elbow period"</span>, <span class="st">"Elbow mortality rate (%)"</span>)</span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla</span></span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>tabla_kable <span class="ot">&lt;-</span> <span class="fu">kable</span>(</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>  codos_trt1_out, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Period and mortality rate at the elbow for each treatment"</span></span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardar como PNG</span></span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a><span class="co">#save_kable(tabla_kable, file = "elbow_table_2017.png", zoom = 2)</span></span>
<span id="cb236-40"><a href="#cb236-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-41"><a href="#cb236-41" aria-hidden="true" tabindex="-1"></a>tabla_kable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Period and mortality rate at the elbow for each treatment</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Treatment</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Elbow period</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Elbow mortality rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">UNTREATED</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">26.85372</td>
</tr>
<tr class="even">
<td style="text-align: center;">GF-2626 (200 ml/ha, Injection)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">56.17758</td>
</tr>
<tr class="odd">
<td style="text-align: center;">GF-2626 (400 ml/ha, Foliar)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">59.54035</td>
</tr>
<tr class="even">
<td style="text-align: center;">GF-2626 (400 ml/ha, Injection)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">56.08444</td>
</tr>
<tr class="odd">
<td style="text-align: center;">CONFIDOR 200 OD (750 ml/ha, Foliar)</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">87.18348</td>
</tr>
<tr class="even">
<td style="text-align: center;">CONFIDOR 200 OD (750 ml/ha, Injection)</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">35.96742</td>
</tr>
<tr class="odd">
<td style="text-align: center;">KARATE ZEON 10CS (250 ml/ha, Injection)</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">61.89056</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Visualizamos ahora con ggplot2 las curvas con el promedio de mortalidad por tratamiento según el periodo, viendo los resultados de la tabla anterior gráficamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>curvas_trt1 <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Trtf_code =</span> <span class="fu">recode</span>(</span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(Trtf),</span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"GF2626_FOLIAR_200"</span>,</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF2626_FOLIAR_400"</span>,</span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"GF2626_INJECT_400"</span>,</span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"CONFIDOR_INJECT_750"</span>,</span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"KARATE_ZEON_FOLIAR_250"</span>,</span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span></span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a>codos_trt1 <span class="ot">&lt;-</span> codos_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb237-19"><a href="#cb237-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-20"><a href="#cb237-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Trtf_code =</span> <span class="fu">recode</span>(</span>
<span id="cb237-21"><a href="#cb237-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(Trtf),</span>
<span id="cb237-22"><a href="#cb237-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"GF2626_FOLIAR_200"</span>,</span>
<span id="cb237-23"><a href="#cb237-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF2626_FOLIAR_400"</span>,</span>
<span id="cb237-24"><a href="#cb237-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"GF2626_INJECT_400"</span>,</span>
<span id="cb237-25"><a href="#cb237-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb237-26"><a href="#cb237-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"CONFIDOR_INJECT_750"</span>,</span>
<span id="cb237-27"><a href="#cb237-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"KARATE_ZEON_FOLIAR_250"</span>,</span>
<span id="cb237-28"><a href="#cb237-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span></span>
<span id="cb237-29"><a href="#cb237-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb237-30"><a href="#cb237-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-31"><a href="#cb237-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-32"><a href="#cb237-32" aria-hidden="true" tabindex="-1"></a>colores_2017 <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb237-33"><a href="#cb237-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(treatment_palette_extended, <span class="sc">!</span><span class="fu">is.na</span>(num_2017) <span class="sc">&amp;</span> code <span class="sc">%in%</span> <span class="fu">unique</span>(curvas_trt1<span class="sc">$</span>Trtf_code)),</span>
<span id="cb237-34"><a href="#cb237-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(color, code)</span>
<span id="cb237-35"><a href="#cb237-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-36"><a href="#cb237-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-37"><a href="#cb237-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(curvas_trt1, <span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> mortalidad, <span class="at">color =</span> Trtf_code, <span class="at">group =</span> Trtf_code)) <span class="sc">+</span></span>
<span id="cb237-38"><a href="#cb237-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb237-39"><a href="#cb237-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb237-40"><a href="#cb237-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb237-41"><a href="#cb237-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> codos_trt1, </span>
<span id="cb237-42"><a href="#cb237-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xintercept =</span> periodo_codo, <span class="at">color =</span> Trtf_code), </span>
<span id="cb237-43"><a href="#cb237-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb237-44"><a href="#cb237-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb237-45"><a href="#cb237-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb237-46"><a href="#cb237-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> colores_2017,</span>
<span id="cb237-47"><a href="#cb237-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">setNames</span>(</span>
<span id="cb237-48"><a href="#cb237-48" aria-hidden="true" tabindex="-1"></a>      treatment_palette_extended<span class="sc">$</span>label,</span>
<span id="cb237-49"><a href="#cb237-49" aria-hidden="true" tabindex="-1"></a>      treatment_palette_extended<span class="sc">$</span>code</span>
<span id="cb237-50"><a href="#cb237-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb237-51"><a href="#cb237-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb237-52"><a href="#cb237-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb237-53"><a href="#cb237-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb237-54"><a href="#cb237-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb237-55"><a href="#cb237-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb237-56"><a href="#cb237-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb237-57"><a href="#cb237-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb237-58"><a href="#cb237-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Period (within 2017)"</span>,</span>
<span id="cb237-59"><a href="#cb237-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average mortality rate (%)"</span>,</span>
<span id="cb237-60"><a href="#cb237-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>   <span class="co"># &lt;&lt;--- Esto quita el título de la leyenda de color</span></span>
<span id="cb237-61"><a href="#cb237-61" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O bien hacemos cada curva por separado para visualizar los codos mejor, ya que éstos se solapan para varios tratamientos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(curvas_trt1, <span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> codos_trt1,</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">as.numeric</span>(periodo_codo), <span class="at">color =</span> Trtf_code),</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colores_2017) <span class="sc">+</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Trtf, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mortality rate curve by treatment</span><span class="sc">\n</span><span class="st">with elbows on graph (2017)"</span>,</span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Period (within 2017)"</span>,</span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average mortality rate (%)"</span></span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">15</span>)</span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Analizamos el AUC de cada curva, es decir, el área bajo cada curva de mortalidad:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># curvas_trt ya debe tener columnas: Trtf, periodo, mortalidad</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegura que periodo es numérico</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>curvas_trt1 <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para calcular AUC usando la regla del trapecio</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>calc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">order</span>(x)</span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[idx]</span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y[<span class="sc">-</span><span class="fu">length</span>(y)] <span class="sc">+</span> y[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">diff</span>(x))</span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb240-13"><a href="#cb240-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-14"><a href="#cb240-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular el AUC para cada tratamiento</span></span>
<span id="cb240-15"><a href="#cb240-15" aria-hidden="true" tabindex="-1"></a>auc_trt1 <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb240-16"><a href="#cb240-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb240-17"><a href="#cb240-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb240-18"><a href="#cb240-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> <span class="fu">calc_auc</span>(periodo, mortalidad),</span>
<span id="cb240-19"><a href="#cb240-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb240-20"><a href="#cb240-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb240-21"><a href="#cb240-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(AUC))</span>
<span id="cb240-22"><a href="#cb240-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-23"><a href="#cb240-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(auc_trt1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  Trtf    AUC
  &lt;fct&gt; &lt;dbl&gt;
1 4      406.
2 6      280.
3 2      203.
4 3      189.
5 1      183.
6 5      121.
7 7      102.</code></pre>
</div>
</div>
<p>Vemos con un algoritmo no supervisado (no conocemos qué umbral determina o no persistente o eficaz para nosotros) de clustering los diferentes grupos en función de la persistencia y eficacia para el 2018:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Asegura que periodo es numérico ---</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>curvas_trt1 <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Mortalidad final (último periodo, por tratamiento) ---</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>mortalidad_final <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(periodo, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Trtf, mortalidad) <span class="sc">%&gt;%</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">mortalidad_final =</span> mortalidad)</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Mortalidad en el codo, quitando el control (6) ---</span></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>mortalidad_codo <span class="ot">&lt;-</span> codos_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trtf <span class="sc">!=</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Trtf, mortalidad_codo)</span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. AUC (área bajo la curva, ya calculado antes o lo calculas aquí) ---</span></span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>auc_trt1 <span class="ot">&lt;-</span> curvas_trt1 <span class="sc">%&gt;%</span></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trtf <span class="sc">!=</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">AUC =</span> <span class="fu">calc_auc</span>(periodo, mortalidad), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Juntar todo en un solo data.frame ---</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>df_cluster1 <span class="ot">&lt;-</span> mortalidad_codo <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mortalidad_final, <span class="at">by =</span> <span class="st">"Trtf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(auc_trt1, <span class="at">by =</span> <span class="st">"Trtf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_postcodo1 =</span> mortalidad_final <span class="sc">-</span> mortalidad_codo  <span class="co"># persistencia: lo que sube o baja la mortalidad tras el codo</span></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6. Escalar las 4 variables para clustering ---</span></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>vars_for_cluster1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(df_cluster1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a><span class="co">#------ 7.5. Vemos el número de clusters óptimo para hacer kmeans ------------</span></span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Con método Silhouette</span></span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(vars_for_cluster1, kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>, <span class="at">k.max =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Silhouette method to choose k"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Con método GAP Statistic</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(vars_for_cluster1, <span class="at">FUN =</span> kmeans, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">K.max =</span> <span class="dv">4</span>, <span class="at">B =</span> <span class="dv">100</span>)</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat) <span class="sc">+</span> </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"GAP statistic method to choose k"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-107-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>k_clust1 <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#Elijo 3 por Silhouette (GAP statistic da k = 1)</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>km1 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(vars_for_cluster1, <span class="at">centers =</span> k_clust1, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>df_cluster1<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(km1<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 8. Visualización (elige los ejes que prefieras) ---</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_cluster1, <span class="fu">aes</span>(<span class="at">x =</span> mortalidad_codo, <span class="at">y =</span> delta_postcodo1, <span class="at">color =</span> Cluster, <span class="at">label =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_y =</span> <span class="fl">1.4</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment clusters (2017)"</span>,</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Mortality rate at elbow (%)"</span>,</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Persistence (Δ post-elbow, %)"</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Con <code>fviz_cluster</code> vemos también de forma similar la proyección de los puntos clusterizados, esta vez sobre las dos primeras componentes principales (con los scores de cada punto):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Crea el gráfico base con fviz_cluster ---</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(km1, <span class="at">data =</span> vars_for_cluster1, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">6</span>))  <span class="co"># Ajusta estos límites si hace falta</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Extrae los datos internos del scatterplot de fviz_cluster ---</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>plotdata1 <span class="ot">&lt;-</span> p1<span class="sc">$</span>data  <span class="co"># Esto contiene x, y, cluster y a veces "name" si lo detecta</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Añade tus labels personalizados (por ejemplo, nombres de tratamientos) ---</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Aquí asumo que el orden de df_cluster2 es el mismo que el de vars_for_cluster2 y por tanto de plotdata</span></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>plotdata1<span class="sc">$</span>label <span class="ot">&lt;-</span> df_cluster1<span class="sc">$</span>Trtf  <span class="co"># O usa la variable que quieras</span></span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Añade la capa geom_text con los labels personalizados y color por cluster ---</span></span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>p1_labeled <span class="ot">&lt;-</span> p1 <span class="sc">+</span></span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plotdata1,</span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">color =</span> <span class="fu">factor</span>(cluster)),  <span class="co"># color por cluster</span></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.6</span></span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6. Muestra el gráfico final ---</span></span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1_labeled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelos-mortalidad-2017" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="modelos-mortalidad-2017"><span class="header-section-number">4.3</span> Modelos mortalidad 2017</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Asegura tipos y renombra si hace falta</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>arbol1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Asigna un identificador de réplica para cada grupo (Trtf, PLOTf, periodo)</span></span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Suponiendo exactamente 2 réplicas por combinación</span></span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>arbol1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf, PLOTf, periodo) <span class="sc">%&gt;%</span></span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">replica =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span>   <span class="co"># replica = 1, 2...</span></span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Ahora, crea un ID único para cada "curva" (esto será: Trtf, PLOTf, replica)</span></span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a>arbol1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">curve_id =</span> <span class="fu">paste</span>(Trtf, PLOTf, replica, <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>replica)</span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Ahora calcula las variables target por cada curva (identificada por curve_id)</span></span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a>calc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb248-21"><a href="#cb248-21" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">order</span>(x)</span>
<span id="cb248-22"><a href="#cb248-22" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[idx]</span>
<span id="cb248-23"><a href="#cb248-23" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb248-24"><a href="#cb248-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y[<span class="sc">-</span><span class="fu">length</span>(y)] <span class="sc">+</span> y[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">diff</span>(x))</span>
<span id="cb248-25"><a href="#cb248-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb248-26"><a href="#cb248-26" aria-hidden="true" tabindex="-1"></a>calc_codo <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) <span class="fu">elbow</span>(x, y) <span class="co"># tu función elbow()</span></span>
<span id="cb248-27"><a href="#cb248-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-28"><a href="#cb248-28" aria-hidden="true" tabindex="-1"></a>df_anova1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb248-29"><a href="#cb248-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf, PLOTf, curve_id) <span class="sc">%&gt;%</span></span>
<span id="cb248-30"><a href="#cb248-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb248-31"><a href="#cb248-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">periodo_codo      =</span> periodo[<span class="fu">calc_codo</span>(periodo, mortalidad)],</span>
<span id="cb248-32"><a href="#cb248-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo   =</span> mortalidad[<span class="fu">calc_codo</span>(periodo, mortalidad)],</span>
<span id="cb248-33"><a href="#cb248-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_final  =</span> mortalidad[<span class="fu">which.max</span>(periodo)],</span>
<span id="cb248-34"><a href="#cb248-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC               =</span> <span class="fu">calc_auc</span>(periodo, mortalidad),</span>
<span id="cb248-35"><a href="#cb248-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb248-36"><a href="#cb248-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb248-37"><a href="#cb248-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb248-38"><a href="#cb248-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_postcodo1 =</span> mortalidad_final <span class="sc">-</span> mortalidad_codo</span>
<span id="cb248-39"><a href="#cb248-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb248-40"><a href="#cb248-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb248-41"><a href="#cb248-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Trtf   =</span> <span class="fu">factor</span>(Trtf),</span>
<span id="cb248-42"><a href="#cb248-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">PLOTf  =</span> <span class="fu">factor</span>(PLOTf),</span>
<span id="cb248-43"><a href="#cb248-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">curve_id =</span> <span class="fu">factor</span>(curve_id)</span>
<span id="cb248-44"><a href="#cb248-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb248-45"><a href="#cb248-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-46"><a href="#cb248-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahora df_anova1 está listo para modelos y comparaciones</span></span>
<span id="cb248-47"><a href="#cb248-47" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_anova1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  Trtf  PLOTf curve_id periodo_codo mortalidad_codo mortalidad_final   AUC
  &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;           &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;
1 7     103   7_103_1             2            8.70             27.0  75.1
2 7     103   7_103_2             4           28.6              24.4 105. 
3 7     207   7_207_1             4           28.3              26.6 109. 
4 7     207   7_207_2             4           36.4              29.3 125. 
5 7     306   7_306_1             4           28.9              26.7 102. 
6 7     306   7_306_2             4           29.5              26.4 101. 
# ℹ 1 more variable: delta_postcodo1 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Ahora vemos los lm’s:</p>
<section id="modelo-1-modelo-lmer-lineal" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="modelo-1-modelo-lmer-lineal"><span class="header-section-number">4.3.1</span> Modelo 1: modelo lmer (lineal)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>mod_mixto_auc1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(AUC <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> PLOTf), <span class="at">data =</span> df_anova1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mfinal1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_final <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> PLOTf), <span class="at">data =</span> df_anova1)</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>mod_mixto_mcodo1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_codo <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> PLOTf), <span class="at">data =</span> df_anova1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_delta1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(delta_postcodo1 <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> PLOTf), <span class="at">data =</span> df_anova1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hacemos el summary y el DHARMa de los cuatro modelos para hacer un diagnóstico de los mismos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- MODELO 1: AUC ----</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_auc1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: AUC ~ Trtf + (1 | PLOTf)
   Data: df_anova1

REML criterion at convergence: 570.1

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.6780 -0.4945  0.0013  0.4252  4.1400 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept)    0      0.00   
 Residual             4918     70.13   
Number of obs: 56, groups:  PLOTf, 28

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   101.86      24.79  49.00   4.108 0.000151 ***
Trtf1          80.74      35.06  49.00   2.303 0.025575 *  
Trtf2         101.49      35.06  49.00   2.894 0.005656 ** 
Trtf3          87.30      35.06  49.00   2.490 0.016229 *  
Trtf4         304.58      35.06  49.00   8.686 1.74e-11 ***
Trtf5          18.91      35.06  49.00   0.539 0.592191    
Trtf6         178.19      35.06  49.00   5.082 5.84e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.707                                   
Trtf2 -0.707  0.500                            
Trtf3 -0.707  0.500  0.500                     
Trtf4 -0.707  0.500  0.500  0.500              
Trtf5 -0.707  0.500  0.500  0.500  0.500       
Trtf6 -0.707  0.500  0.500  0.500  0.500  0.500
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_auc1_res <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_auc1)</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_auc1_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- MODELO 2: mortalidad_final ----</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_mfinal1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_final ~ Trtf + (1 | PLOTf)
   Data: df_anova1

REML criterion at convergence: 425.1

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.23856 -0.35285 -0.04743  0.37326  2.14990 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept) 125.3    11.19   
 Residual             173.7    13.18   
Number of obs: 56, groups:  PLOTf, 28

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   26.943      7.282 21.000   3.700 0.001328 ** 
Trtf1         25.160     10.299 21.000   2.443 0.023485 *  
Trtf2         32.020     10.299 21.000   3.109 0.005310 ** 
Trtf3         27.586     10.299 21.000   2.679 0.014059 *  
Trtf4         52.916     10.299 21.000   5.138 4.33e-05 ***
Trtf5         -2.222     10.299 21.000  -0.216 0.831246    
Trtf6         39.849     10.299 21.000   3.869 0.000887 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.707                                   
Trtf2 -0.707  0.500                            
Trtf3 -0.707  0.500  0.500                     
Trtf4 -0.707  0.500  0.500  0.500              
Trtf5 -0.707  0.500  0.500  0.500  0.500       
Trtf6 -0.707  0.500  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mfinal1_res <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_mfinal1)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_mfinal1_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- MODELO 3: mortalidad_codo ----</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_mcodo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_codo ~ Trtf + (1 | PLOTf)
   Data: df_anova1

REML criterion at convergence: 447

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.2682 -0.6589  0.0106  0.5531  3.2011 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept)   0.0     0.00   
 Residual             398.1    19.95   
Number of obs: 56, groups:  PLOTf, 28

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   23.868      7.054 49.000   3.384 0.001415 ** 
Trtf1         21.387      9.976 49.000   2.144 0.037034 *  
Trtf2         18.811      9.976 49.000   1.886 0.065279 .  
Trtf3         12.264      9.976 49.000   1.229 0.224798    
Trtf4         69.125      9.976 49.000   6.929 8.54e-09 ***
Trtf5         10.201      9.976 49.000   1.023 0.311536    
Trtf6         40.300      9.976 49.000   4.040 0.000188 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.707                                   
Trtf2 -0.707  0.500                            
Trtf3 -0.707  0.500  0.500                     
Trtf4 -0.707  0.500  0.500  0.500              
Trtf5 -0.707  0.500  0.500  0.500  0.500       
Trtf6 -0.707  0.500  0.500  0.500  0.500  0.500
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mcodo1_res <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_mcodo1)</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_mcodo1_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- MODELO 4: delta_postcodo1 ----</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_delta1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: delta_postcodo1 ~ Trtf + (1 | PLOTf)
   Data: df_anova1

REML criterion at convergence: 461.4

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.8208 -0.6646 -0.1055  0.5684  2.2747 

Random effects:
 Groups   Name        Variance Std.Dev.
 PLOTf    (Intercept)  30.92    5.56   
 Residual             509.04   22.56   
Number of obs: 56, groups:  PLOTf, 28

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)
(Intercept)   3.0754     8.4474  21.0000   0.364    0.719
Trtf1         3.7738    11.9465  21.0000   0.316    0.755
Trtf2        13.2090    11.9465  21.0000   1.106    0.281
Trtf3        15.3224    11.9465  21.0000   1.283    0.214
Trtf4       -16.2084    11.9465  21.0000  -1.357    0.189
Trtf5       -12.4231    11.9465  21.0000  -1.040    0.310
Trtf6        -0.4504    11.9465  21.0000  -0.038    0.970

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf3  Trtf4  Trtf5 
Trtf1 -0.707                                   
Trtf2 -0.707  0.500                            
Trtf3 -0.707  0.500  0.500                     
Trtf4 -0.707  0.500  0.500  0.500              
Trtf5 -0.707  0.500  0.500  0.500  0.500       
Trtf6 -0.707  0.500  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_delta1_res <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_delta1)</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_delta1_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-115-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hacemos emmeans y cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_auc2, pairwise ~ Trtf, test = "fdr")</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_mfinal2, pairwise ~ Trtf, test = "fdr")</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_mcodo2, pairwise ~ Trtf, test = "fdr")</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_delta2, pairwise ~ Trtf, test = "fdr")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- CLD para AUC ----</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>emm_auc1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_auc1, <span class="sc">~</span> Trtf)</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>cld_auc1 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_auc1, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_auc1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 7       102 24.8 21     28.0      176  a    
 5       121 24.8 21     46.9      195  ab   
 1       183 24.8 21    108.7      256   bc  
 3       189 24.8 21    115.3      263   bc  
 2       203 24.8 21    129.5      277    cd 
 6       280 24.8 21    206.2      354     d 
 4       406 24.8 21    332.6      480      e

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 7 estimates 
P value adjustment: fdr method for 21 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- CLD para mortalidad_final ----</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>emm_mfinal1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_mfinal1, <span class="sc">~</span> Trtf)</span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>cld_mfinal1 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_mfinal1, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_mfinal1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 5      24.7 7.28 21     3.02     46.4  a    
 7      26.9 7.28 21     5.24     48.6  a    
 1      52.1 7.28 21    30.40     73.8   b   
 3      54.5 7.28 21    32.83     76.2   b   
 2      59.0 7.28 21    37.26     80.7   bc  
 6      66.8 7.28 21    45.09     88.5   bc  
 4      79.9 7.28 21    58.16    101.6    c  

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 7 estimates 
P value adjustment: fdr method for 21 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- CLD para mortalidad_codo ----</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>emm_mcodo1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_mcodo1, <span class="sc">~</span> Trtf)</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>cld_mcodo1 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_mcodo1, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_mcodo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 7      23.9 7.05 21     2.85     44.9  a    
 5      34.1 7.05 21    13.05     55.1  a    
 3      36.1 7.05 21    15.11     57.2  a    
 2      42.7 7.05 21    21.66     63.7  ab   
 1      45.3 7.05 21    24.23     66.3  ab   
 6      64.2 7.05 21    43.15     85.2   b   
 4      93.0 7.05 21    71.97    114.0    c  

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 7 estimates 
P value adjustment: fdr method for 21 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- CLD para delta_postcodo1 ----</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>emm_delta1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_delta1, <span class="sc">~</span> Trtf)</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>cld_delta1 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_delta1, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_delta1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 4    -13.13 8.45 21   -38.31     12.0  a    
 5     -9.35 8.45 21   -34.52     15.8  a    
 6      2.63 8.45 21   -22.55     27.8  a    
 7      3.08 8.45 21   -22.10     28.2  a    
 1      6.85 8.45 21   -18.32     32.0  a    
 2     16.28 8.45 21    -8.89     41.5  a    
 3     18.40 8.45 21    -6.77     43.6  a    

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 7 estimates 
P value adjustment: fdr method for 21 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
</section>
</section>
<section id="conclusiones-para-2017" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="conclusiones-para-2017"><span class="header-section-number">4.4</span> Conclusiones para 2017</h2>
<ul>
<li><p><strong>Trtf4 (CONFIDOR 200 OD, 750 ml pr/ha, FOLIAR APPLICATION)</strong> es <strong>claramente el tratamiento más eficaz</strong> en 2017 para todas las variables principales, tanto por el análisis CLD como por el cluster.</p></li>
<li><p><strong>Trtf5 (CONFIDOR 200 OD, 750 ml pr/ha, TRUNK INJECTION)</strong> es el menos eficaz y forma un grupo aparte en el análisis de clusters y CLD. Concluimos que, de aplicarse por inyección y no de manera foliar el CONFIDOR 200 OD (imidacloprid), no solo es mucho menos eficaz sino que es incluso potencialmente negativo con respecto al control.</p></li>
<li><p><strong>El resto de tratamientos aplicados en 2017</strong> (<strong>Trtf1, 2, 3, 6, 7</strong>) no presentan diferencias significativas entre sí en la mayoría de las variables y aparecen juntos en el cluster.</p></li>
<li><p><strong>La persistencia (delta post-codo)</strong> no diferencia a ningún tratamiento en 2017.</p></li>
</ul>
<p><strong>CLUSTERS: Alta eficacia, eficacia intermedia y baja eficacia. No se observan diferencias en cuanto a su persistencia.</strong></p>
</section>
<section id="visualización-de-datos-de-2018" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="visualización-de-datos-de-2018"><span class="header-section-number">4.5</span> Visualización de datos de 2018</h2>
<p>Vemos como en 2017 qué tratamiento es más persistente en el tiempo. Para ello vemos primero los codos estadísticos de cada una de las curvas para cada tratamiento y rama de árbol. Así:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>curvas_trt2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf, periodo) <span class="sc">%&gt;%</span></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mortalidad =</span> <span class="fu">mean</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agrupamos en una tabla los tratamientos con el periodo en el que se encuentra el codo de sus gráficas de mortalidad junto a la mortalidad en dicho codo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(webshot2) <span class="co"># solo si quieres exportar a PNG</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula codos para 2018</span></span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>codos_trt2 <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">periodo_codo =</span> periodo[<span class="fu">elbow</span>(periodo, mortalidad)],</span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo =</span> mortalidad[<span class="fu">elbow</span>(periodo, mortalidad)],</span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels en inglés para 2018</span></span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a>treatment_labels_en_2018 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CONFIDOR 200 OD (750 ml/ha, Foliar)"</span>,  <span class="co"># 1</span></span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF-2626 (400 ml/ha, Foliar)"</span>,             <span class="co"># 2</span></span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EPIK (1500 g/ha, Foliar)"</span>,                <span class="co"># 3</span></span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF-2626 (400 ml/ha, Injection)"</span>,          <span class="co"># 4</span></span>
<span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"EPIK (1500 g/ha, Injection)"</span>,             <span class="co"># 5</span></span>
<span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UNTREATED"</span>                                <span class="co"># 6</span></span>
<span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb277-24"><a href="#cb277-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-25"><a href="#cb277-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Asigna manualmente los labels usando el valor numérico de Trtf</span></span>
<span id="cb277-26"><a href="#cb277-26" aria-hidden="true" tabindex="-1"></a>codos_trt2<span class="sc">$</span>Treatment <span class="ot">&lt;-</span> treatment_labels_en_2018[<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(codos_trt2<span class="sc">$</span>Trtf))]</span>
<span id="cb277-27"><a href="#cb277-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-28"><a href="#cb277-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Reordena las columnas</span></span>
<span id="cb277-29"><a href="#cb277-29" aria-hidden="true" tabindex="-1"></a>codos_trt2_out <span class="ot">&lt;-</span> codos_trt2[, <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"periodo_codo"</span>, <span class="st">"mortalidad_codo"</span>)]</span>
<span id="cb277-30"><a href="#cb277-30" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(codos_trt2_out) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"Elbow period"</span>, <span class="st">"Elbow mortality rate (%)"</span>)</span>
<span id="cb277-31"><a href="#cb277-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-32"><a href="#cb277-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Muestra y/o guarda la tabla</span></span>
<span id="cb277-33"><a href="#cb277-33" aria-hidden="true" tabindex="-1"></a>tabla_kable2 <span class="ot">&lt;-</span> <span class="fu">kable</span>(</span>
<span id="cb277-34"><a href="#cb277-34" aria-hidden="true" tabindex="-1"></a>  codos_trt2_out, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb277-35"><a href="#cb277-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Period and mortality rate at the elbow for each treatment"</span></span>
<span id="cb277-36"><a href="#cb277-36" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb277-37"><a href="#cb277-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb277-38"><a href="#cb277-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-39"><a href="#cb277-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Para guardar como PNG (opcional)</span></span>
<span id="cb277-40"><a href="#cb277-40" aria-hidden="true" tabindex="-1"></a><span class="co">#save_kable(tabla_kable2, file = "elbow_table_2018.png", zoom = 2)</span></span>
<span id="cb277-41"><a href="#cb277-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-42"><a href="#cb277-42" aria-hidden="true" tabindex="-1"></a>tabla_kable2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Period and mortality rate at the elbow for each treatment</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Treatment</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Elbow period</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Elbow mortality rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">UNTREATED</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">18.16385</td>
</tr>
<tr class="even">
<td style="text-align: center;">CONFIDOR 200 OD (750 ml/ha, Foliar)</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">75.57824</td>
</tr>
<tr class="odd">
<td style="text-align: center;">GF-2626 (400 ml/ha, Foliar)</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">36.59190</td>
</tr>
<tr class="even">
<td style="text-align: center;">GF-2626 (400 ml/ha, Injection)</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">32.58733</td>
</tr>
<tr class="odd">
<td style="text-align: center;">EPIK (1500 g/ha, Foliar)</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">85.86012</td>
</tr>
<tr class="even">
<td style="text-align: center;">EPIK (1500 g/ha, Injection)</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">80.69344</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Visualizamos ahora con ggplot2 las curvas con el promedio de mortalidad por tratamiento según el periodo, viendo los resultados de la tabla anterior gráficamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>curvas_trt2 <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Trtf_code =</span> <span class="fu">recode</span>(</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(Trtf),</span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF2626_FOLIAR_400"</span>,</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"EPIK_FOLIAR_1500"</span>,</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"GF2626_INJECT_400"</span>,</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"EPIK_INJECT_1500"</span>,</span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb278-15"><a href="#cb278-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb278-16"><a href="#cb278-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-17"><a href="#cb278-17" aria-hidden="true" tabindex="-1"></a>codos_trt2 <span class="ot">&lt;-</span> codos_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb278-18"><a href="#cb278-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb278-19"><a href="#cb278-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Trtf_code =</span> <span class="fu">recode</span>(</span>
<span id="cb278-20"><a href="#cb278-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(Trtf),</span>
<span id="cb278-21"><a href="#cb278-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"CONFIDOR_FOLIAR_750"</span>,</span>
<span id="cb278-22"><a href="#cb278-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"GF2626_FOLIAR_400"</span>,</span>
<span id="cb278-23"><a href="#cb278-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"EPIK_FOLIAR_1500"</span>,</span>
<span id="cb278-24"><a href="#cb278-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"GF2626_INJECT_400"</span>,</span>
<span id="cb278-25"><a href="#cb278-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"EPIK_INJECT_1500"</span>,</span>
<span id="cb278-26"><a href="#cb278-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"UNTREATED"</span></span>
<span id="cb278-27"><a href="#cb278-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb278-28"><a href="#cb278-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb278-29"><a href="#cb278-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-30"><a href="#cb278-30" aria-hidden="true" tabindex="-1"></a>colores_2018 <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb278-31"><a href="#cb278-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(treatment_palette_extended, <span class="sc">!</span><span class="fu">is.na</span>(num_2018) <span class="sc">&amp;</span> code <span class="sc">%in%</span> <span class="fu">unique</span>(curvas_trt2<span class="sc">$</span>Trtf_code)),</span>
<span id="cb278-32"><a href="#cb278-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(color, code)</span>
<span id="cb278-33"><a href="#cb278-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb278-34"><a href="#cb278-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-35"><a href="#cb278-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(curvas_trt2, <span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> mortalidad, <span class="at">color =</span> Trtf_code, <span class="at">group =</span> Trtf_code)) <span class="sc">+</span></span>
<span id="cb278-36"><a href="#cb278-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb278-37"><a href="#cb278-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb278-38"><a href="#cb278-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> codos_trt2, <span class="fu">aes</span>(<span class="at">xintercept =</span> periodo_codo, <span class="at">color =</span> Trtf_code), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb278-39"><a href="#cb278-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb278-40"><a href="#cb278-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">values =</span> colores_2018,</span>
<span id="cb278-41"><a href="#cb278-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">setNames</span>(</span>
<span id="cb278-42"><a href="#cb278-42" aria-hidden="true" tabindex="-1"></a>    treatment_palette_extended<span class="sc">$</span>label,</span>
<span id="cb278-43"><a href="#cb278-43" aria-hidden="true" tabindex="-1"></a>    treatment_palette_extended<span class="sc">$</span>code</span>
<span id="cb278-44"><a href="#cb278-44" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb278-45"><a href="#cb278-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb278-46"><a href="#cb278-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb278-47"><a href="#cb278-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb278-48"><a href="#cb278-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb278-49"><a href="#cb278-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-50"><a href="#cb278-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb278-51"><a href="#cb278-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Period (within 2018)"</span>,</span>
<span id="cb278-52"><a href="#cb278-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average mortality rate (%)"</span>,</span>
<span id="cb278-53"><a href="#cb278-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>   <span class="co"># &lt;&lt;--- Esto quita el título de la leyenda de color</span></span>
<span id="cb278-54"><a href="#cb278-54" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O bien hacemos cada curva por separado para visualizar los codos mejor, ya que éstos se solapan para varios tratamientos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(curvas_trt2, <span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> mortalidad)) <span class="sc">+</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"gray20"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> codos_trt2,</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">as.numeric</span>(periodo_codo), <span class="at">color =</span> Trtf_code),</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colores_2018) <span class="sc">+</span></span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Trtf, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Period (within 2018)"</span>,</span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average mortality rate (%)"</span></span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb279-18"><a href="#cb279-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">15</span>)</span>
<span id="cb279-19"><a href="#cb279-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-124-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Analizamos el AUC de cada curva, es decir, el área bajo cada curva de mortalidad:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># curvas_trt ya debe tener columnas: Trtf, periodo, mortalidad</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegura que periodo es numérico</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>curvas_trt2 <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para calcular AUC usando la regla del trapecio</span></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>calc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">order</span>(x)</span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[idx]</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y[<span class="sc">-</span><span class="fu">length</span>(y)] <span class="sc">+</span> y[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">diff</span>(x))</span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb280-13"><a href="#cb280-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-14"><a href="#cb280-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular el AUC para cada tratamiento</span></span>
<span id="cb280-15"><a href="#cb280-15" aria-hidden="true" tabindex="-1"></a>auc_trt2 <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb280-16"><a href="#cb280-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb280-17"><a href="#cb280-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb280-18"><a href="#cb280-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> <span class="fu">calc_auc</span>(periodo, mortalidad),</span>
<span id="cb280-19"><a href="#cb280-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb280-20"><a href="#cb280-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb280-21"><a href="#cb280-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(AUC))</span>
<span id="cb280-22"><a href="#cb280-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-23"><a href="#cb280-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(auc_trt2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  Trtf    AUC
  &lt;fct&gt; &lt;dbl&gt;
1 3     511. 
2 1     503. 
3 5     453. 
4 4     211. 
5 2     207. 
6 6      96.0</code></pre>
</div>
</div>
<p>Vemos con un algoritmo no supervisado (no conocemos qué umbral determina o no persistente o eficaz para nosotros) de clustering los diferentes grupos en función de la persistencia y eficacia para el 2018:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Asegura que periodo es numérico ---</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>curvas_trt2 <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Mortalidad final (último periodo, por tratamiento) ---</span></span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a>mortalidad_final <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb282-11"><a href="#cb282-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb282-12"><a href="#cb282-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(periodo, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb282-13"><a href="#cb282-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb282-14"><a href="#cb282-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Trtf, mortalidad) <span class="sc">%&gt;%</span></span>
<span id="cb282-15"><a href="#cb282-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">mortalidad_final =</span> mortalidad)</span>
<span id="cb282-16"><a href="#cb282-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-17"><a href="#cb282-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Mortalidad en el codo, quitando el control (6) ---</span></span>
<span id="cb282-18"><a href="#cb282-18" aria-hidden="true" tabindex="-1"></a>mortalidad_codo <span class="ot">&lt;-</span> codos_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb282-19"><a href="#cb282-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trtf <span class="sc">!=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb282-20"><a href="#cb282-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Trtf, mortalidad_codo)</span>
<span id="cb282-21"><a href="#cb282-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-22"><a href="#cb282-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. AUC (área bajo la curva, ya calculado antes o lo calculas aquí) ---</span></span>
<span id="cb282-23"><a href="#cb282-23" aria-hidden="true" tabindex="-1"></a>auc_trt2 <span class="ot">&lt;-</span> curvas_trt2 <span class="sc">%&gt;%</span></span>
<span id="cb282-24"><a href="#cb282-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Trtf <span class="sc">!=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb282-25"><a href="#cb282-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf) <span class="sc">%&gt;%</span></span>
<span id="cb282-26"><a href="#cb282-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">AUC =</span> <span class="fu">calc_auc</span>(periodo, mortalidad), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Juntar todo en un solo data.frame ---</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>df_cluster2 <span class="ot">&lt;-</span> mortalidad_codo <span class="sc">%&gt;%</span></span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mortalidad_final, <span class="at">by =</span> <span class="st">"Trtf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(auc_trt2, <span class="at">by =</span> <span class="st">"Trtf"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_postcodo2 =</span> mortalidad_final <span class="sc">-</span> mortalidad_codo  <span class="co"># persistencia: lo que sube o baja la mortalidad tras el codo</span></span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6. Escalar las 4 variables para clustering ---</span></span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a>vars_for_cluster2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(df_cluster2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb283-13"><a href="#cb283-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-14"><a href="#cb283-14" aria-hidden="true" tabindex="-1"></a><span class="co">#------ 7.5. Vemos el número de clusters óptimo para hacer kmeans ------------</span></span>
<span id="cb283-15"><a href="#cb283-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-16"><a href="#cb283-16" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(vars_for_cluster2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Con método Silhouette</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(vars_for_cluster2, kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>, <span class="at">k.max =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"El método del silhouette para elegir k"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Con método GAP Statistic</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(vars_for_cluster2, <span class="at">FUN =</span> kmeans, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">K.max =</span> <span class="dv">4</span>, <span class="at">B =</span> <span class="dv">100</span>)</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat) <span class="sc">+</span> </span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Método del GAP statistic para elegir k"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-127-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>k_clust <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co">#Elijo 2 por GAP y silhouette</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>km2 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(vars_for_cluster2, <span class="at">centers =</span> k_clust, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>df_cluster2<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(km2<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vemos la proyección de los puntos clusterizados en <code>mortalidad_codo</code> y <code>delta_postcodo2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 8. Visualización (elige los ejes que prefieras) ---</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_cluster2, <span class="fu">aes</span>(<span class="at">x =</span> mortalidad_codo, <span class="at">y =</span> delta_postcodo2, <span class="at">color =</span> Cluster, <span class="at">label =</span> Trtf)) <span class="sc">+</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_y =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment clusters (2018)"</span>,</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Mortalty rate at elbow (%)"</span>,</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Persistence (Δ post-elbow, %)"</span></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-128-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Con <code>fviz_cluster</code> vemos también de forma similar la proyección de los puntos clusterizados, esta vez sobre las dos primeras componentes principales (con los scores de cada punto):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Crea el gráfico base con fviz_cluster ---</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(km2, <span class="at">data =</span> vars_for_cluster2, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">6</span>))  <span class="co"># Ajusta estos límites si hace falta</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Extrae los datos internos del scatterplot de fviz_cluster ---</span></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>plotdata2 <span class="ot">&lt;-</span> p2<span class="sc">$</span>data  <span class="co"># Esto contiene x, y, cluster y a veces "name" si lo detecta</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4. Añade tus labels personalizados (por ejemplo, nombres de tratamientos) ---</span></span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Aquí asumo que el orden de df_cluster2 es el mismo que el de vars_for_cluster2 y por tanto de plotdata</span></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>plotdata2<span class="sc">$</span>label <span class="ot">&lt;-</span> df_cluster2<span class="sc">$</span>Trtf  <span class="co"># O usa la variable que quieras</span></span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Añade la capa geom_text con los labels personalizados y color por cluster ---</span></span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a>p2_labeled <span class="ot">&lt;-</span> p2 <span class="sc">+</span></span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plotdata2,</span>
<span id="cb289-17"><a href="#cb289-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">color =</span> <span class="fu">factor</span>(cluster)),  <span class="co"># color por cluster</span></span>
<span id="cb289-18"><a href="#cb289-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb289-19"><a href="#cb289-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb289-20"><a href="#cb289-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb289-21"><a href="#cb289-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.6</span></span>
<span id="cb289-22"><a href="#cb289-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb289-23"><a href="#cb289-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-24"><a href="#cb289-24" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6. Muestra el gráfico final ---</span></span>
<span id="cb289-25"><a href="#cb289-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2_labeled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-129-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hacemos ahora <strong>ANOVAs/GLMs</strong> usando nuestras variables de interés para ver diferencias de medias entre parcelas (AUC, mortalidad en el codo, mortalidad final, persistencia/descenso post-codo), con la unidad experimental “parcela</p>
</section>
<section id="modelos-mortalidad-2018" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="modelos-mortalidad-2018"><span class="header-section-number">4.6</span> Modelos mortalidad 2018</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegura que periodo es numérico</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>arbol2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span> </span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo),</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rete =</span> <span class="fu">as.character</span>(Rete))</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Función para el AUC ---</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>calc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">order</span>(x)</span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[idx]</span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> y[idx]</span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y[<span class="sc">-</span><span class="fu">length</span>(y)] <span class="sc">+</span> y[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">diff</span>(x))</span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Calcula codo por cada (Trtf, Plotf) ---</span></span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a>calc_codo <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Devuelve el índice del codo según tu criterio</span></span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ejemplo: usa tu función elbow()</span></span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">elbow</span>(x, y)</span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-21"><a href="#cb290-21" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Cálculo por parcela y tratamiento ---</span></span>
<span id="cb290-22"><a href="#cb290-22" aria-hidden="true" tabindex="-1"></a>df_anova2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb290-23"><a href="#cb290-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trtf, Plotf, Rete) <span class="sc">%&gt;%</span></span>
<span id="cb290-24"><a href="#cb290-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb290-25"><a href="#cb290-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">periodo_codo =</span> periodo[<span class="fu">calc_codo</span>(periodo, mortalidad)],</span>
<span id="cb290-26"><a href="#cb290-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo =</span> mortalidad[<span class="fu">calc_codo</span>(periodo, mortalidad)],</span>
<span id="cb290-27"><a href="#cb290-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_final =</span> mortalidad[<span class="fu">which.max</span>(periodo)], <span class="co"># último periodo de cada parcela</span></span>
<span id="cb290-28"><a href="#cb290-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> <span class="fu">calc_auc</span>(periodo, mortalidad),</span>
<span id="cb290-29"><a href="#cb290-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb290-30"><a href="#cb290-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb290-31"><a href="#cb290-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb290-32"><a href="#cb290-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_postcodo2 =</span> mortalidad_final <span class="sc">-</span> mortalidad_codo <span class="co"># persistencia</span></span>
<span id="cb290-33"><a href="#cb290-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb290-34"><a href="#cb290-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-35"><a href="#cb290-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Opcional: quita controles si quieres analizar solo tratamientos activos</span></span>
<span id="cb290-36"><a href="#cb290-36" aria-hidden="true" tabindex="-1"></a><span class="co"># df_anova2 &lt;- df_anova2 %&gt;% filter(Trtf != 6)</span></span>
<span id="cb290-37"><a href="#cb290-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-38"><a href="#cb290-38" aria-hidden="true" tabindex="-1"></a>df_anova2 <span class="ot">&lt;-</span> df_anova2 <span class="sc">%&gt;%</span></span>
<span id="cb290-39"><a href="#cb290-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb290-40"><a href="#cb290-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">Trtf =</span> <span class="fu">factor</span>(Trtf),</span>
<span id="cb290-41"><a href="#cb290-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Plotf =</span> <span class="fu">factor</span>(Plotf),</span>
<span id="cb290-42"><a href="#cb290-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rete =</span> <span class="fu">factor</span>(Rete)</span>
<span id="cb290-43"><a href="#cb290-43" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="modelo-1-modelos-lineales-mixtos-lmer" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="modelo-1-modelos-lineales-mixtos-lmer"><span class="header-section-number">4.6.1</span> Modelo 1: Modelos lineales mixtos (lmer)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_auc2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(AUC <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf), <span class="at">data =</span> df_anova2)</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>mod_mixto_mfinal2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_final <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf), <span class="at">data =</span> df_anova2)</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>mod_mixto_mcodo2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_codo <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf), <span class="at">data =</span> df_anova2)</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>mod_mixto_delta2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(delta_postcodo2 <span class="sc">~</span> Trtf <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plotf), <span class="at">data =</span> df_anova2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_auc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: AUC ~ Trtf + (1 | Plotf)
   Data: df_anova2

REML criterion at convergence: 1130.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.5630 -0.5342  0.0333  0.4759  2.0855 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept)  5544     74.46  
 Residual             11156    105.62  
Number of obs: 96, groups:  Plotf, 24

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)    95.97      45.64  18.00   2.103   0.0498 *  
Trtf1         407.35      64.55  18.00   6.311 6.00e-06 ***
Trtf2         110.89      64.55  18.00   1.718   0.1030    
Trtf4         115.34      64.55  18.00   1.787   0.0908 .  
Trtf3         415.30      64.55  18.00   6.434 4.69e-06 ***
Trtf5         357.30      64.55  18.00   5.535 2.96e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf4  Trtf3 
Trtf1 -0.707                            
Trtf2 -0.707  0.500                     
Trtf4 -0.707  0.500  0.500              
Trtf3 -0.707  0.500  0.500  0.500       
Trtf5 -0.707  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_auc_res2 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_auc2)</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_auc_res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-132-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_mfinal2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_final ~ Trtf + (1 | Plotf)
   Data: df_anova2

REML criterion at convergence: 795

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.3450 -0.6550 -0.1125  0.5659  2.6355 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept)  93.57    9.673  
 Residual             281.99   16.793  
Number of obs: 96, groups:  Plotf, 24

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   21.886      6.404 18.000   3.417 0.003071 ** 
Trtf1         44.098      9.057 18.000   4.869 0.000123 ***
Trtf2         10.600      9.057 18.000   1.170 0.257118    
Trtf4         13.460      9.057 18.000   1.486 0.154549    
Trtf3         30.169      9.057 18.000   3.331 0.003718 ** 
Trtf5         37.997      9.057 18.000   4.195 0.000544 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf4  Trtf3 
Trtf1 -0.707                            
Trtf2 -0.707  0.500                     
Trtf4 -0.707  0.500  0.500              
Trtf3 -0.707  0.500  0.500  0.500       
Trtf5 -0.707  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mfinal_res2 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_mfinal2)</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_mfinal_res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-133-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_mcodo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_codo ~ Trtf + (1 | Plotf)
   Data: df_anova2

REML criterion at convergence: 798.9

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.07488 -0.49317  0.05959  0.45855  2.53580 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept) 112.6    10.61   
 Residual             288.7    16.99   
Number of obs: 96, groups:  Plotf, 24

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   15.587      6.797 18.000   2.293   0.0341 *  
Trtf1         64.109      9.612 18.000   6.670 2.94e-06 ***
Trtf2         22.669      9.612 18.000   2.358   0.0299 *  
Trtf4         21.224      9.612 18.000   2.208   0.0404 *  
Trtf3         75.587      9.612 18.000   7.864 3.13e-07 ***
Trtf5         65.153      9.612 18.000   6.778 2.38e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf4  Trtf3 
Trtf1 -0.707                            
Trtf2 -0.707  0.500                     
Trtf4 -0.707  0.500  0.500              
Trtf3 -0.707  0.500  0.500  0.500       
Trtf5 -0.707  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mcodo_res2 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_mcodo2)</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_mcodo_res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-134-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_delta2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: delta_postcodo2 ~ Trtf + (1 | Plotf)
   Data: df_anova2

REML criterion at convergence: 770.3

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.49959 -0.55245  0.01348  0.69863  2.56415 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plotf    (Intercept)  47.58    6.898  
 Residual             224.50   14.983  
Number of obs: 96, groups:  Plotf, 24

Fixed effects:
            Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)    6.299      5.092  18.000   1.237   0.2319    
Trtf1        -20.011      7.201  18.000  -2.779   0.0124 *  
Trtf2        -12.068      7.201  18.000  -1.676   0.1110    
Trtf4         -7.764      7.201  18.000  -1.078   0.2952    
Trtf3        -45.418      7.201  18.000  -6.307 6.04e-06 ***
Trtf5        -27.156      7.201  18.000  -3.771   0.0014 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) Trtf1  Trtf2  Trtf4  Trtf3 
Trtf1 -0.707                            
Trtf2 -0.707  0.500                     
Trtf4 -0.707  0.500  0.500              
Trtf3 -0.707  0.500  0.500  0.500       
Trtf5 -0.707  0.500  0.500  0.500  0.500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_delta_res2 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_delta2)</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_delta_res2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-135-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_auc2, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: AUC
             Chisq Df Pr(&gt;Chisq)    
(Intercept)  4.421  1     0.0355 *  
Trtf        77.814  5  2.404e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_mfinal2, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: mortalidad_final
             Chisq Df Pr(&gt;Chisq)    
(Intercept) 11.678  1  0.0006324 ***
Trtf        36.443  5  7.744e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_mcodo2, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: mortalidad_codo
               Chisq Df Pr(&gt;Chisq)    
(Intercept)   5.2592  1    0.02183 *  
Trtf        102.1907  5    &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_delta2, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: delta_postcodo2
              Chisq Df Pr(&gt;Chisq)    
(Intercept)  1.5306  1      0.216    
Trtf        50.1534  5  1.289e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>El modelo para <code>mortalidad_codo</code> acepta todo salvo la homocedasticidad entre grupos que rechaza por poco (sí la acepta dentro de ellos al menos). Por tanto, nos quedaremos con los cuatro modelos igualmente. Hallamos si las diferencias de medias marginales a pares son significativas ahora como lo hemos venido haciendo hasta ahora, con el paquete emmeans y la función cld. Podemos ver las diferencias par a par, pero lo dejo comentado puesto que lo que nos interesa es ver simplemente si hay diferencias entre ellas agrupándolo en formato cld (en “letras”):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_auc2, pairwise ~ Trtf, test = "fdr")</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_mfinal2, pairwise ~ Trtf, test = "fdr")</span></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_mcodo2, pairwise ~ Trtf, test = "fdr")</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans(mod_mixto_delta2, pairwise ~ Trtf, test = "fdr")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hacemos el cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- AUC ----</span></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a>emm_auc2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_auc2, <span class="sc">~</span> Trtf)</span>
<span id="cb313-6"><a href="#cb313-6" aria-hidden="true" tabindex="-1"></a>cld_auc2 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_auc2, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb313-7"><a href="#cb313-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_auc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 6        96 45.6 18    -39.3      231  a    
 2       207 45.6 18     71.6      342  a    
 4       211 45.6 18     76.1      347  a    
 5       453 45.6 18    318.0      589   b   
 1       503 45.6 18    368.1      639   b   
 3       511 45.6 18    376.0      647   b   

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Mortalidad final ----</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>emm_mfinal2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_mfinal2, <span class="sc">~</span> Trtf)</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>cld_mfinal2 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_mfinal2, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_mfinal2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean  SE df lower.CL upper.CL .group
 6      21.9 6.4 18     2.91     40.9  a    
 2      32.5 6.4 18    13.51     51.5  ab   
 4      35.3 6.4 18    16.37     54.3  ab   
 3      52.1 6.4 18    33.08     71.0   bc  
 5      59.9 6.4 18    40.91     78.9    c  
 1      66.0 6.4 18    47.01     85.0    c  

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Mortalidad codo ----</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>emm_mcodo2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_mcodo2, <span class="sc">~</span> Trtf)</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>cld_mcodo2 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_mcodo2, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_mcodo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean  SE df lower.CL upper.CL .group
 6      15.6 6.8 18    -4.55     35.7  a    
 4      36.8 6.8 18    16.67     56.9  ab   
 2      38.3 6.8 18    18.12     58.4   b   
 1      79.7 6.8 18    59.56     99.8    c  
 5      80.7 6.8 18    60.60    100.9    c  
 3      91.2 6.8 18    71.04    111.3    c  

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Delta postcodo ----</span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>emm_delta2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_delta2, <span class="sc">~</span> Trtf)</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>cld_delta2 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_delta2, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_delta2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Trtf emmean   SE df lower.CL upper.CL .group
 3    -39.12 5.09 18   -54.20   -24.03  a    
 5    -20.86 5.09 18   -35.94    -5.77   b   
 1    -13.71 5.09 18   -28.80     1.37   bc  
 2     -5.77 5.09 18   -20.85     9.32   bcd 
 4     -1.46 5.09 18   -16.55    13.62    cd 
 6      6.30 5.09 18    -8.79    21.39     d 

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 6 estimates 
P value adjustment: fdr method for 15 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
</section>
</section>
<section id="conclusiones-para-2018" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="conclusiones-para-2018"><span class="header-section-number">4.7</span> Conclusiones para 2018</h2>
<ul>
<li><p><strong>El control (Trtf6)</strong> presenta la menor eficacia en todas las variables (AUC, mortalidad, etc.), y ninguna diferencia significativa respecto a Trtf2 y Trtf4.</p></li>
<li><p><strong>Los tratamientos Trtf1, Trtf3, y Trtf5</strong> tienen los mayores valores de AUC y mortalidad, tanto al final como en el codo. Entre ellos no hay diferencias significativas, lo que sugiere que son igualmente eficaces.</p></li>
<li><p><strong>Trtf2 y Trtf4</strong> muestran un efecto intermedio, no significativamente distinto del control, por lo que pueden considerarse tratamientos de baja eficacia.</p></li>
<li><p><strong>En cuanto a la persistencia indicada por delta post-codo:</strong> Trtf3 y Trtf5 presentan una caída fuerte de la mortalidad tras el codo, lo que puede indicar menor persistencia del efecto máximo; Trtf1 tiene una caída menor, y el control junto con Trtf2 y Trtf4 prácticamente no muestran caídas en la mortalidad desde el codo. Se confirma así lo estudiado antes en la clusterización, tenemos un grupo de tratamientos de alta eficacia y baja persistencia (1, 3 y 5) y otro grupo de tratamientos diferenciados de baja eficacia y alta persistencia (2, 4).</p></li>
<li><p><strong>En conclusión:</strong> <strong>Trtf1, Trtf3 y Trtf5</strong> son los tratamientos que marcan la diferencia frente al control y frente a Trtf2/Trtf4, siendo los de mayor eficacia general.</p></li>
</ul>
<p><strong>CLUSTERS: Alta eficacia y baja persistencia vs.&nbsp;baja eficacia y alta persistencia.</strong></p>
</section>
<section id="modelo-único-para-clusterización" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="modelo-único-para-clusterización"><span class="header-section-number">4.8</span> Modelo único para clusterización</h2>
<p>Ahora vamos a intentar combinar el año 2017 con el año 2018 haciendo pooling sobre el año, ya que hay tratamientos que se repiten en ambos años y otros tratamientos que no se repiten. Primero creamos un dataset combinado para 2017 y 2018:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>arbol2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2018</span>)</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Periodo numérico en ambos dataframes</span></span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>arbol1 <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>arbol2 <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">periodo =</span> <span class="fu">as.numeric</span>(periodo))</span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a>arbol1_mod <span class="ot">&lt;-</span> arbol1 <span class="sc">%&gt;%</span></span>
<span id="cb321-14"><a href="#cb321-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Plot =</span> PLOT, <span class="at">Trt =</span> Trt) <span class="sc">%&gt;%</span> <span class="co"># asegura nombres estándar</span></span>
<span id="cb321-15"><a href="#cb321-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trt, Plot, periodo) <span class="sc">%&gt;%</span></span>
<span id="cb321-16"><a href="#cb321-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rete =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span>     <span class="co"># Rete será el número de réplica (1, 2)</span></span>
<span id="cb321-17"><a href="#cb321-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb321-18"><a href="#cb321-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span></span>
<span id="cb321-19"><a href="#cb321-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rete =</span> <span class="fu">as.character</span>(Rete)) <span class="sc">%&gt;%</span></span>
<span id="cb321-20"><a href="#cb321-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(year, Trt, Plot, Rete, periodo, mortalidad)</span>
<span id="cb321-21"><a href="#cb321-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-22"><a href="#cb321-22" aria-hidden="true" tabindex="-1"></a>arbol2_mod <span class="ot">&lt;-</span> arbol2 <span class="sc">%&gt;%</span></span>
<span id="cb321-23"><a href="#cb321-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Plot =</span> Plot, <span class="at">Trt =</span> Trt, <span class="at">Rete =</span> Rete) <span class="sc">%&gt;%</span></span>
<span id="cb321-24"><a href="#cb321-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(year, Trt, Plot, Rete, periodo, mortalidad)</span>
<span id="cb321-25"><a href="#cb321-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb321-26"><a href="#cb321-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-27"><a href="#cb321-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Unimos ambos dataframes</span></span>
<span id="cb321-28"><a href="#cb321-28" aria-hidden="true" tabindex="-1"></a>arbol_total <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(arbol1_mod, arbol2_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora hacemos pooling sobre year teniendo en cuenta lo anterior:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>tratamientos_lookup <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>year, <span class="sc">~</span>Trt, <span class="sc">~</span>Treatment_code,                       <span class="sc">~</span>Treatment_name,</span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">1</span>,   <span class="st">"SULFOXAFLOR_200_FOLIAR"</span>,              <span class="st">"SULFOXAFLOR (200 ml/ha, FOLIAR)"</span>,</span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">2</span>,   <span class="st">"SULFOXAFLOR_400_FOLIAR"</span>,              <span class="st">"SULFOXAFLOR (400 ml/ha, FOLIAR)"</span>,</span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">3</span>,   <span class="st">"SULFOXAFLOR_400_INJCTREE"</span>,            <span class="st">"SULFOXAFLOR (400 ml/ha, INJCTREE)"</span>,</span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">4</span>,   <span class="st">"CONFIDOR_750_FOLIAR"</span>,                 <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOLIAR)"</span>,</span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">5</span>,   <span class="st">"CONFIDOR_750_INJCTREE"</span>,               <span class="st">"CONFIDOR 200 OD (750 ml/ha, INJCTREE)"</span>,</span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">6</span>,   <span class="st">"KARATE_250_FOLIAR"</span>,                   <span class="st">"KARATE ZEON 10CS (250 ml/ha, FOLIAR)"</span>,</span>
<span id="cb322-11"><a href="#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2017</span>,   <span class="dv">7</span>,   <span class="st">"UNTREATED"</span>,                           <span class="st">"UNTREATED"</span>,</span>
<span id="cb322-12"><a href="#cb322-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2018</span>,   <span class="dv">1</span>,   <span class="st">"CONFIDOR_750_FOLIAR"</span>,                 <span class="st">"CONFIDOR 200 OD (750 ml/ha, FOLIAR)"</span>,</span>
<span id="cb322-13"><a href="#cb322-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2018</span>,   <span class="dv">2</span>,   <span class="st">"SULFOXAFLOR_400_FOLIAR"</span>,              <span class="st">"SULFOXAFLOR (400 ml/ha, FOLIAR)"</span>,</span>
<span id="cb322-14"><a href="#cb322-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2018</span>,   <span class="dv">3</span>,   <span class="st">"EPIK_1500_FOLIAR"</span>,                    <span class="st">"EPIK (1500 g/ha, FOLIAR)"</span>,</span>
<span id="cb322-15"><a href="#cb322-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2018</span>,   <span class="dv">4</span>,   <span class="st">"SULFOXAFLOR_400_INJCTREE"</span>,            <span class="st">"SULFOXAFLOR (400 ml/ha, INJCTREE)"</span>,</span>
<span id="cb322-16"><a href="#cb322-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2018</span>,   <span class="dv">5</span>,   <span class="st">"EPIK_1500_INJCTREE"</span>,                  <span class="st">"EPIK (1500 g/ha, INJCTREE)"</span>,</span>
<span id="cb322-17"><a href="#cb322-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2018</span>,   <span class="dv">6</span>,   <span class="st">"UNTREATED"</span>,                           <span class="st">"UNTREATED"</span></span>
<span id="cb322-18"><a href="#cb322-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb322-19"><a href="#cb322-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-20"><a href="#cb322-20" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Unimos la tabla a arbol_total ---</span></span>
<span id="cb322-21"><a href="#cb322-21" aria-hidden="true" tabindex="-1"></a>arbol_pool <span class="ot">&lt;-</span> arbol_total <span class="sc">%&gt;%</span></span>
<span id="cb322-22"><a href="#cb322-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trt =</span> <span class="fu">as.integer</span>(Trt)) <span class="sc">%&gt;%</span></span>
<span id="cb322-23"><a href="#cb322-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tratamientos_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"Trt"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb322-24"><a href="#cb322-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> periodo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>))) <span class="co">#Filtro 7 y 8 en 2018 y los quito para comparabilidad</span></span>
<span id="cb322-25"><a href="#cb322-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-26"><a href="#cb322-26" aria-hidden="true" tabindex="-1"></a><span class="co">#table(arbol_pool$year, arbol_total_pool$Treatment_code, useNA="always")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Calcular variables resumen por tratamiento, parcela y réplica/árbol ---</span></span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>df_anova_pool <span class="ot">&lt;-</span> arbol_pool <span class="sc">%&gt;%</span></span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment_code, Plot, Rete) <span class="sc">%&gt;%</span></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">periodo_codo =</span> periodo[<span class="fu">calc_codo</span>(periodo, mortalidad)],</span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo =</span> mortalidad[<span class="fu">calc_codo</span>(periodo, mortalidad)],</span>
<span id="cb323-9"><a href="#cb323-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_final =</span> mortalidad[<span class="fu">which.max</span>(periodo)], <span class="co"># último periodo de cada curva</span></span>
<span id="cb323-10"><a href="#cb323-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> <span class="fu">calc_auc</span>(periodo, mortalidad),</span>
<span id="cb323-11"><a href="#cb323-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb323-12"><a href="#cb323-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb323-13"><a href="#cb323-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb323-14"><a href="#cb323-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_postcodo =</span> mortalidad_final <span class="sc">-</span> mortalidad_codo <span class="co"># persistencia</span></span>
<span id="cb323-15"><a href="#cb323-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb323-16"><a href="#cb323-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb323-17"><a href="#cb323-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Treatment_code =</span> <span class="fu">factor</span>(Treatment_code),</span>
<span id="cb323-18"><a href="#cb323-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Plot =</span> <span class="fu">factor</span>(Plot),</span>
<span id="cb323-19"><a href="#cb323-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rete =</span> <span class="fu">factor</span>(Rete)</span>
<span id="cb323-20"><a href="#cb323-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="modelo-1-modelos-lineales-mixtos-lmer-1" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="modelo-1-modelos-lineales-mixtos-lmer-1"><span class="header-section-number">4.8.1</span> Modelo 1: Modelos lineales mixtos (lmer)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_auc3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(AUC <span class="sc">~</span> Treatment_code <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plot), <span class="at">data =</span> df_anova_pool)</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>mod_mixto_mfinal3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_final <span class="sc">~</span> Treatment_code <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plot), <span class="at">data =</span> df_anova_pool)</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>mod_mixto_mcodo3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mortalidad_codo <span class="sc">~</span> Treatment_code <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plot), <span class="at">data =</span> df_anova_pool)</span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>mod_mixto_delta3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(delta_postcodo <span class="sc">~</span> Treatment_code <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Plot), <span class="at">data =</span> df_anova_pool)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_auc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: AUC ~ Treatment_code + (1 | Plot)
   Data: df_anova_pool

REML criterion at convergence: 1697.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.2107 -0.4778  0.0069  0.4550  3.7021 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plot     (Intercept) 1373     37.05   
 Residual             6200     78.74   
Number of obs: 152, groups:  Plot, 28

Fixed effects:
                                       Estimate Std. Error       df t value
(Intercept)                             378.882     20.210   68.490  18.747
Treatment_codeCONFIDOR_750_INJCTREE    -278.225     34.496  141.360  -8.066
Treatment_codeEPIK_1500_FOLIAR            8.841     32.169   76.604   0.275
Treatment_codeEPIK_1500_INJCTREE        -50.490     30.230  115.671  -1.670
Treatment_codeKARATE_250_FOLIAR         -76.011     37.087  126.066  -2.050
Treatment_codeSULFOXAFLOR_200_FOLIAR   -188.289     34.778  142.998  -5.414
Treatment_codeSULFOXAFLOR_400_FOLIAR   -208.330     28.404   76.034  -7.334
Treatment_codeSULFOXAFLOR_400_INJCTREE -214.901     26.719  118.129  -8.043
Treatment_codeUNTREATED                -308.167     28.735   75.361 -10.724
                                       Pr(&gt;|t|)    
(Intercept)                             &lt; 2e-16 ***
Treatment_codeCONFIDOR_750_INJCTREE    2.82e-13 ***
Treatment_codeEPIK_1500_FOLIAR           0.7842    
Treatment_codeEPIK_1500_INJCTREE         0.0976 .  
Treatment_codeKARATE_250_FOLIAR          0.0425 *  
Treatment_codeSULFOXAFLOR_200_FOLIAR   2.54e-07 ***
Treatment_codeSULFOXAFLOR_400_FOLIAR   2.04e-10 ***
Treatment_codeSULFOXAFLOR_400_INJCTREE 7.62e-13 ***
Treatment_codeUNTREATED                 &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                    (Intr) T_CONF T_EPIK_1500_F T_EPIK_1500_I T_KARA
T_CONFIDOR_         -0.428                                          
T_EPIK_1500_F       -0.613  0.264                                   
T_EPIK_1500_I       -0.550  0.308  0.338                            
T_KARATE_25         -0.525  0.237  0.329         0.358              
T_SULFOXAFLOR_2     -0.441  0.190  0.346         0.243         0.233
T_SULFOXAFLOR_400_F -0.700  0.306  0.466         0.395         0.465
T_SULFOXAFLOR_400_I -0.673  0.339  0.424         0.380         0.410
T_UNTREATED         -0.685  0.298  0.498         0.378         0.366
                    T_SULFOXAFLOR_2 T_SULFOXAFLOR_400_F T_SULFOXAFLOR_400_I
T_CONFIDOR_                                                                
T_EPIK_1500_F                                                              
T_EPIK_1500_I                                                              
T_KARATE_25                                                                
T_SULFOXAFLOR_2                                                            
T_SULFOXAFLOR_400_F  0.314                                                 
T_SULFOXAFLOR_400_I  0.303           0.529                                 
T_UNTREATED          0.362           0.490               0.515             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_auc_res3 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_auc3)</span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_auc_res3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-143-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_mfinal3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_final ~ Treatment_code + (1 | Plot)
   Data: df_anova_pool

REML criterion at convergence: 1259.6

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.30484 -0.64123  0.01822  0.56381  2.22313 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plot     (Intercept) 108.8    10.43   
 Residual             273.3    16.53   
Number of obs: 152, groups:  Plot, 28

Fixed effects:
                                       Estimate Std. Error      df t value
(Intercept)                              74.338      4.685  66.550  15.867
Treatment_codeCONFIDOR_750_INJCTREE     -55.334      7.385 136.229  -7.493
Treatment_codeEPIK_1500_FOLIAR          -10.795      7.363  88.510  -1.466
Treatment_codeEPIK_1500_INJCTREE         -7.738      6.713 131.034  -1.153
Treatment_codeKARATE_250_FOLIAR           1.883      8.189 134.655   0.230
Treatment_codeSULFOXAFLOR_200_FOLIAR    -22.566      7.506 142.140  -3.006
Treatment_codeSULFOXAFLOR_400_FOLIAR    -34.233      6.518  82.521  -5.252
Treatment_codeSULFOXAFLOR_400_INJCTREE  -30.172      5.931 129.681  -5.087
Treatment_codeUNTREATED                 -53.579      6.589  85.127  -8.132
                                       Pr(&gt;|t|)    
(Intercept)                             &lt; 2e-16 ***
Treatment_codeCONFIDOR_750_INJCTREE    7.67e-12 ***
Treatment_codeEPIK_1500_FOLIAR          0.14614    
Treatment_codeEPIK_1500_INJCTREE        0.25112    
Treatment_codeKARATE_250_FOLIAR         0.81849    
Treatment_codeSULFOXAFLOR_200_FOLIAR    0.00313 ** 
Treatment_codeSULFOXAFLOR_400_FOLIAR   1.15e-06 ***
Treatment_codeSULFOXAFLOR_400_INJCTREE 1.25e-06 ***
Treatment_codeUNTREATED                3.05e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                    (Intr) T_CONF T_EPIK_1500_F T_EPIK_1500_I T_KARA
T_CONFIDOR_         -0.396                                          
T_EPIK_1500_F       -0.602  0.243                                   
T_EPIK_1500_I       -0.508  0.308  0.309                            
T_KARATE_25         -0.526  0.234  0.334         0.368              
T_SULFOXAFLOR_2     -0.422  0.169  0.366         0.215         0.227
T_SULFOXAFLOR_400_F -0.691  0.288  0.473         0.372         0.504
T_SULFOXAFLOR_400_I -0.655  0.333  0.422         0.354         0.433
T_UNTREATED         -0.669  0.276  0.525         0.343         0.368
                    T_SULFOXAFLOR_2 T_SULFOXAFLOR_400_F T_SULFOXAFLOR_400_I
T_CONFIDOR_                                                                
T_EPIK_1500_F                                                              
T_EPIK_1500_I                                                              
T_KARATE_25                                                                
T_SULFOXAFLOR_2                                                            
T_SULFOXAFLOR_400_F  0.303                                                 
T_SULFOXAFLOR_400_I  0.292           0.543                                 
T_UNTREATED          0.375           0.485               0.523             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mfinal_res3 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_mfinal3)</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_mfinal_res3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-144-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_mcodo3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mortalidad_codo ~ Treatment_code + (1 | Plot)
   Data: df_anova_pool

REML criterion at convergence: 1304.7

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.8354 -0.6949  0.0416  0.6582  3.1165 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plot     (Intercept)  15.05    3.88   
 Residual             440.15   20.98   
Number of obs: 152, groups:  Plot, 28

Fixed effects:
                                       Estimate Std. Error      df t value
(Intercept)                              83.154      4.509  61.780  18.442
Treatment_codeCONFIDOR_750_INJCTREE     -49.684      8.733 140.381  -5.689
Treatment_codeEPIK_1500_FOLIAR            4.599      7.167  54.354   0.642
Treatment_codeEPIK_1500_INJCTREE         -4.113      7.076  80.738  -0.581
Treatment_codeKARATE_250_FOLIAR         -18.187      8.872 102.872  -2.050
Treatment_codeSULFOXAFLOR_200_FOLIAR    -37.566      8.737 139.367  -4.300
Treatment_codeSULFOXAFLOR_400_FOLIAR    -43.426      6.375  62.571  -6.812
Treatment_codeSULFOXAFLOR_400_INJCTREE  -49.102      6.305  89.841  -7.788
Treatment_codeUNTREATED                 -66.472      6.404  55.572 -10.379
                                       Pr(&gt;|t|)    
(Intercept)                             &lt; 2e-16 ***
Treatment_codeCONFIDOR_750_INJCTREE    7.15e-08 ***
Treatment_codeEPIK_1500_FOLIAR           0.5238    
Treatment_codeEPIK_1500_INJCTREE         0.5627    
Treatment_codeKARATE_250_FOLIAR          0.0429 *  
Treatment_codeSULFOXAFLOR_200_FOLIAR   3.19e-05 ***
Treatment_codeSULFOXAFLOR_400_FOLIAR   4.38e-09 ***
Treatment_codeSULFOXAFLOR_400_INJCTREE 1.12e-11 ***
Treatment_codeUNTREATED                1.28e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                    (Intr) T_CONF T_EPIK_1500_F T_EPIK_1500_I T_KARA
T_CONFIDOR_         -0.484                                          
T_EPIK_1500_F       -0.629  0.304                                   
T_EPIK_1500_I       -0.616  0.314  0.387                            
T_KARATE_25         -0.507  0.246  0.319         0.328              
T_SULFOXAFLOR_2     -0.485  0.235  0.320         0.299         0.246
T_SULFOXAFLOR_400_F -0.707  0.343  0.451         0.436         0.381
T_SULFOXAFLOR_400_I -0.700  0.350  0.440         0.432         0.366
T_UNTREATED         -0.703  0.341  0.457         0.433         0.357
                    T_SULFOXAFLOR_2 T_SULFOXAFLOR_400_F T_SULFOXAFLOR_400_I
T_CONFIDOR_                                                                
T_EPIK_1500_F                                                              
T_EPIK_1500_I                                                              
T_KARATE_25                                                                
T_SULFOXAFLOR_2                                                            
T_SULFOXAFLOR_400_F  0.343                                                 
T_SULFOXAFLOR_400_I  0.340           0.506                                 
T_UNTREATED          0.353           0.498               0.503             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_mcodo_res3 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_mcodo3)</span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_mcodo_res3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-145-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mixto_delta3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: delta_postcodo ~ Treatment_code + (1 | Plot)
   Data: df_anova_pool

REML criterion at convergence: 1278.8

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.14223 -0.54719 -0.03176  0.42434  2.83288 

Random effects:
 Groups   Name        Variance Std.Dev.
 Plot     (Intercept)   0.0     0.00   
 Residual             377.6    19.43   
Number of obs: 152, groups:  Plot, 28

Fixed effects:
                                       Estimate Std. Error       df t value
(Intercept)                             -8.5285     3.9663 143.0000  -2.150
Treatment_codeCONFIDOR_750_INJCTREE     -0.8191     7.9325 143.0000  -0.103
Treatment_codeEPIK_1500_FOLIAR         -11.6220     6.2712 143.0000  -1.853
Treatment_codeEPIK_1500_INJCTREE        -6.4830     6.2712 143.0000  -1.034
Treatment_codeKARATE_250_FOLIAR         11.1536     7.9325 143.0000   1.406
Treatment_codeSULFOXAFLOR_200_FOLIAR    15.3778     7.9325 143.0000   1.939
Treatment_codeSULFOXAFLOR_400_FOLIAR     9.0600     5.6092 143.0000   1.615
Treatment_codeSULFOXAFLOR_400_INJCTREE  14.7337     5.6092 143.0000   2.627
Treatment_codeUNTREATED                 12.0010     5.6092 143.0000   2.140
                                       Pr(&gt;|t|)   
(Intercept)                             0.03322 * 
Treatment_codeCONFIDOR_750_INJCTREE     0.91790   
Treatment_codeEPIK_1500_FOLIAR          0.06591 . 
Treatment_codeEPIK_1500_INJCTREE        0.30299   
Treatment_codeKARATE_250_FOLIAR         0.16188   
Treatment_codeSULFOXAFLOR_200_FOLIAR    0.05452 . 
Treatment_codeSULFOXAFLOR_400_FOLIAR    0.10847   
Treatment_codeSULFOXAFLOR_400_INJCTREE  0.00956 **
Treatment_codeUNTREATED                 0.03409 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                    (Intr) T_CONF T_EPIK_1500_F T_EPIK_1500_I T_KARA
T_CONFIDOR_         -0.500                                          
T_EPIK_1500_F       -0.632  0.316                                   
T_EPIK_1500_I       -0.632  0.316  0.400                            
T_KARATE_25         -0.500  0.250  0.316         0.316              
T_SULFOXAFLOR_2     -0.500  0.250  0.316         0.316         0.250
T_SULFOXAFLOR_400_F -0.707  0.354  0.447         0.447         0.354
T_SULFOXAFLOR_400_I -0.707  0.354  0.447         0.447         0.354
T_UNTREATED         -0.707  0.354  0.447         0.447         0.354
                    T_SULFOXAFLOR_2 T_SULFOXAFLOR_400_F T_SULFOXAFLOR_400_I
T_CONFIDOR_                                                                
T_EPIK_1500_F                                                              
T_EPIK_1500_I                                                              
T_KARATE_25                                                                
T_SULFOXAFLOR_2                                                            
T_SULFOXAFLOR_400_F  0.354                                                 
T_SULFOXAFLOR_400_I  0.354           0.500                                 
T_UNTREATED          0.354           0.500               0.500             
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>mod_mixto_delta_res3 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> mod_mixto_delta3)</span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_mixto_delta_res3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-146-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_auc3, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: AUC
                Chisq Df Pr(&gt;Chisq)    
(Intercept)    351.45  1  &lt; 2.2e-16 ***
Treatment_code 238.89  8  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_mfinal3, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: mortalidad_final
                Chisq Df Pr(&gt;Chisq)    
(Intercept)    251.77  1  &lt; 2.2e-16 ***
Treatment_code 141.33  8  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_mcodo3, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: mortalidad_codo
                Chisq Df Pr(&gt;Chisq)    
(Intercept)    340.11  1  &lt; 2.2e-16 ***
Treatment_code 208.37  8  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_mixto_delta3, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III Wald chisquare tests)

Response: delta_postcodo
                 Chisq Df Pr(&gt;Chisq)    
(Intercept)     4.6236  1    0.03153 *  
Treatment_code 32.8701  8    6.5e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Vemos emmeans y cld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- AUC ----</span></span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>emm_auc3 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_auc3, <span class="sc">~</span> Treatment_code)</span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>cld_auc3 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_auc3, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_auc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Treatment_code           emmean   SE    df lower.CL upper.CL .group
 UNTREATED                  70.7 21.3  54.9     9.13      132  a    
 CONFIDOR_750_INJCTREE     100.7 32.1 126.1    10.22      191  ab   
 SULFOXAFLOR_400_INJCTREE  164.0 20.3  79.3   106.19      222   b   
 SULFOXAFLOR_400_FOLIAR    170.6 20.6  62.5   111.46      230   b   
 SULFOXAFLOR_200_FOLIAR    190.6 32.0 128.6   100.26      281   b   
 KARATE_250_FOLIAR         302.9 32.0 128.6   212.54      393    c  
 EPIK_1500_INJCTREE        328.4 26.0  60.5   253.50      403    c  
 CONFIDOR_750_FOLIAR       378.9 20.5  65.6   320.00      438    c  
 EPIK_1500_FOLIAR          387.7 26.0  63.1   313.12      462    c  

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 9 estimates 
P value adjustment: fdr method for 36 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Mortalidad final ----</span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>emm_mfinal3 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_mfinal3, <span class="sc">~</span> Treatment_code)</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>cld_mfinal3 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_mfinal3, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_mfinal3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Treatment_code           emmean   SE    df lower.CL upper.CL .group
 CONFIDOR_750_INJCTREE      19.0 7.08 128.3   -0.967     39.0  a    
 UNTREATED                  20.8 4.99  61.2    6.420     35.1  a    
 SULFOXAFLOR_400_FOLIAR     40.1 4.78  65.0   26.384     53.8   b   
 SULFOXAFLOR_400_INJCTREE   44.2 4.62  85.6   31.025     57.3   b   
 SULFOXAFLOR_200_FOLIAR     51.8 7.05 132.0   31.888     71.7   bc  
 EPIK_1500_FOLIAR           63.5 6.00  74.9   46.404     80.7    cd 
 EPIK_1500_INJCTREE         66.6 6.04  70.9   49.330     83.9    cd 
 CONFIDOR_750_FOLIAR        74.3 4.75  69.2   60.732     87.9     d 
 KARATE_250_FOLIAR          76.2 7.05 132.2   56.340     96.1     d 

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 9 estimates 
P value adjustment: fdr method for 36 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Mortalidad codo ----</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>emm_mcodo3 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_mcodo3, <span class="sc">~</span> Treatment_code)</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>cld_mcodo3 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_mcodo3, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_mcodo3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Treatment_code           emmean   SE    df lower.CL upper.CL .group
 UNTREATED                  16.7 4.65  43.6     3.12     30.2  a    
 CONFIDOR_750_INJCTREE      33.5 7.79 113.5    11.45     55.5  ab   
 SULFOXAFLOR_400_INJCTREE   34.1 4.61  61.0    20.79     47.3   b   
 SULFOXAFLOR_400_FOLIAR     39.7 4.58  57.5    26.52     52.9   b   
 SULFOXAFLOR_200_FOLIAR     45.6 7.79 113.7    23.56     67.6   bc  
 KARATE_250_FOLIAR          65.0 7.79 113.7    42.94     87.0    cd 
 EPIK_1500_INJCTREE         79.0 5.70  44.2    62.42     95.7     de
 CONFIDOR_750_FOLIAR        83.2 4.59  57.9    69.93     96.4     de
 EPIK_1500_FOLIAR           87.8 5.71  44.6    71.12    104.4      e

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 9 estimates 
P value adjustment: fdr method for 36 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Delta postcodo ----</span></span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a>emm_delta3 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(mod_mixto_delta3, <span class="sc">~</span> Treatment_code)</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>cld_delta3 <span class="ot">&lt;-</span> <span class="fu">cld</span>(emm_delta3, <span class="at">Letters =</span> letters, <span class="at">adjust =</span> <span class="st">"fdr"</span>)</span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cld_delta3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Treatment_code            emmean   SE    df lower.CL upper.CL .group
 EPIK_1500_FOLIAR         -20.151 4.97  40.5   -34.72   -5.581  a    
 EPIK_1500_INJCTREE       -15.012 4.97  40.5   -29.56   -0.459  ab   
 CONFIDOR_750_INJCTREE     -9.348 7.01 107.4   -29.19   10.500  abc  
 CONFIDOR_750_FOLIAR       -8.529 4.04  55.6   -20.18    3.124  abc  
 SULFOXAFLOR_400_FOLIAR     0.532 4.04  55.6   -11.11   12.178   bc  
 KARATE_250_FOLIAR          2.625 7.01 107.4   -17.22   22.472  abc  
 UNTREATED                  3.473 4.05  40.5    -8.39   15.336    c  
 SULFOXAFLOR_400_INJCTREE   6.205 4.06  55.6    -5.52   17.930    c  
 SULFOXAFLOR_200_FOLIAR     6.849 7.01 107.4   -13.00   26.697   bc  

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 
Conf-level adjustment: bonferroni method for 9 estimates 
P value adjustment: fdr method for 36 tests 
significance level used: alpha = 0.05 
NOTE: If two or more means share the same grouping symbol,
      then we cannot show them to be different.
      But we also did not show them to be the same. </code></pre>
</div>
</div>
<p>Ponemos todo en una tabla para el PowerPoint:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(webshot2)</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Calcula media y sd por tratamiento</span></span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>resumen_stats <span class="ot">&lt;-</span> df_anova_pool <span class="sc">%&gt;%</span></span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment_code) <span class="sc">%&gt;%</span></span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC_mean      =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-11"><a href="#cb354-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC_sd        =</span> <span class="fu">sd</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-12"><a href="#cb354-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mfinal_mean   =</span> <span class="fu">mean</span>(mortalidad_final, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-13"><a href="#cb354-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mfinal_sd     =</span> <span class="fu">sd</span>(mortalidad_final, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-14"><a href="#cb354-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mcodo_mean    =</span> <span class="fu">mean</span>(mortalidad_codo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-15"><a href="#cb354-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mcodo_sd      =</span> <span class="fu">sd</span>(mortalidad_codo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-16"><a href="#cb354-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_mean    =</span> <span class="fu">mean</span>(delta_postcodo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb354-17"><a href="#cb354-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_sd      =</span> <span class="fu">sd</span>(delta_postcodo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb354-18"><a href="#cb354-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb354-19"><a href="#cb354-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-20"><a href="#cb354-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Letras para cada tratamiento y variable</span></span>
<span id="cb354-21"><a href="#cb354-21" aria-hidden="true" tabindex="-1"></a>letras_auc    <span class="ot">&lt;-</span> cld_auc3<span class="sc">$</span>.group</span>
<span id="cb354-22"><a href="#cb354-22" aria-hidden="true" tabindex="-1"></a>letras_mfinal <span class="ot">&lt;-</span> cld_mfinal3<span class="sc">$</span>.group</span>
<span id="cb354-23"><a href="#cb354-23" aria-hidden="true" tabindex="-1"></a>letras_mcodo  <span class="ot">&lt;-</span> cld_mcodo3<span class="sc">$</span>.group</span>
<span id="cb354-24"><a href="#cb354-24" aria-hidden="true" tabindex="-1"></a>letras_delta  <span class="ot">&lt;-</span> cld_delta3<span class="sc">$</span>.group</span>
<span id="cb354-25"><a href="#cb354-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-26"><a href="#cb354-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Ordena los tratamientos igual que en cld</span></span>
<span id="cb354-27"><a href="#cb354-27" aria-hidden="true" tabindex="-1"></a>resumen_stats <span class="ot">&lt;-</span> resumen_stats[<span class="fu">match</span>(cld_auc3<span class="sc">$</span>Treatment_code, resumen_stats<span class="sc">$</span>Treatment_code), ]</span>
<span id="cb354-28"><a href="#cb354-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-29"><a href="#cb354-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Función para letras como superíndices Unicode</span></span>
<span id="cb354-30"><a href="#cb354-30" aria-hidden="true" tabindex="-1"></a>to_superscript <span class="ot">&lt;-</span> <span class="cf">function</span>(s) {</span>
<span id="cb354-31"><a href="#cb354-31" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"a"</span>, <span class="st">"\u1d43"</span>, s)</span>
<span id="cb354-32"><a href="#cb354-32" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"b"</span>, <span class="st">"\u1d47"</span>, s)</span>
<span id="cb354-33"><a href="#cb354-33" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"c"</span>, <span class="st">"\u1d9c"</span>, s)</span>
<span id="cb354-34"><a href="#cb354-34" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"d"</span>, <span class="st">"\u1d48"</span>, s)</span>
<span id="cb354-35"><a href="#cb354-35" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"e"</span>, <span class="st">"\u1d49"</span>, s)</span>
<span id="cb354-36"><a href="#cb354-36" aria-hidden="true" tabindex="-1"></a>  s</span>
<span id="cb354-37"><a href="#cb354-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb354-38"><a href="#cb354-38" aria-hidden="true" tabindex="-1"></a>celda_unicode <span class="ot">&lt;-</span> <span class="cf">function</span>(m, s, l) {</span>
<span id="cb354-39"><a href="#cb354-39" aria-hidden="true" tabindex="-1"></a>  super <span class="ot">&lt;-</span> <span class="fu">to_superscript</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, l))</span>
<span id="cb354-40"><a href="#cb354-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">"%.1f ± %.1f%s"</span>, m, s, super)</span>
<span id="cb354-41"><a href="#cb354-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb354-42"><a href="#cb354-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-43"><a href="#cb354-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Arma la tabla con superíndices Unicode</span></span>
<span id="cb354-44"><a href="#cb354-44" aria-hidden="true" tabindex="-1"></a>tabla_letras_sd2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb354-45"><a href="#cb354-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Treatment =</span> cld_auc3<span class="sc">$</span>Treatment_code,</span>
<span id="cb354-46"><a href="#cb354-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC             =</span> <span class="fu">mapply</span>(celda_unicode, resumen_stats<span class="sc">$</span>AUC_mean,    resumen_stats<span class="sc">$</span>AUC_sd,    letras_auc),</span>
<span id="cb354-47"><a href="#cb354-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">Final_mortality =</span> <span class="fu">mapply</span>(celda_unicode, resumen_stats<span class="sc">$</span>mfinal_mean, resumen_stats<span class="sc">$</span>mfinal_sd, letras_mfinal),</span>
<span id="cb354-48"><a href="#cb354-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">Elbow_mortality =</span> <span class="fu">mapply</span>(celda_unicode, resumen_stats<span class="sc">$</span>mcodo_mean,  resumen_stats<span class="sc">$</span>mcodo_sd,  letras_mcodo),</span>
<span id="cb354-49"><a href="#cb354-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Post_elbow_delta=</span> <span class="fu">mapply</span>(celda_unicode, resumen_stats<span class="sc">$</span>delta_mean,  resumen_stats<span class="sc">$</span>delta_sd,  letras_delta)</span>
<span id="cb354-50"><a href="#cb354-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb354-51"><a href="#cb354-51" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tabla_letras_sd2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"AUC"</span>, <span class="st">"Final mortality"</span>, <span class="st">"Elbow mortality"</span>, <span class="st">"Post-elbow delta"</span>)</span>
<span id="cb354-52"><a href="#cb354-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-53"><a href="#cb354-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Tabla kable bonita</span></span>
<span id="cb354-54"><a href="#cb354-54" aria-hidden="true" tabindex="-1"></a>tabla_kable_FDR <span class="ot">&lt;-</span> <span class="fu">kable</span>(</span>
<span id="cb354-55"><a href="#cb354-55" aria-hidden="true" tabindex="-1"></a>  tabla_letras_sd2, <span class="at">align =</span> <span class="st">"c"</span>, <span class="at">escape =</span> <span class="cn">TRUE</span>,</span>
<span id="cb354-56"><a href="#cb354-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Means ± sd and statistical grouping (as superscript) by treatment and variable (FDR-corrected)."</span></span>
<span id="cb354-57"><a href="#cb354-57" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb354-58"><a href="#cb354-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb354-59"><a href="#cb354-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb354-60"><a href="#cb354-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb354-61"><a href="#cb354-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">15</span></span>
<span id="cb354-62"><a href="#cb354-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb354-63"><a href="#cb354-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">width =</span> <span class="st">"6em"</span>, <span class="at">extra_css =</span> <span class="st">"white-space:nowrap; font-size:90%;"</span>)</span>
<span id="cb354-64"><a href="#cb354-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-65"><a href="#cb354-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Guarda como HTML y PNG</span></span>
<span id="cb354-66"><a href="#cb354-66" aria-hidden="true" tabindex="-1"></a><span class="fu">save_kable</span>(tabla_kable_FDR, <span class="at">file =</span> <span class="st">"tabla_letras_FDR.html"</span>)</span>
<span id="cb354-67"><a href="#cb354-67" aria-hidden="true" tabindex="-1"></a><span class="fu">webshot</span>(<span class="st">"tabla_letras_FDR.html"</span>, <span class="at">file =</span> <span class="st">"tabla_letras_FDR.png"</span>, <span class="at">zoom =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-149-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="clustering-y-curvas-promedio-en-conjunto" class="level3" data-number="4.8.2">
<h3 data-number="4.8.2" class="anchored" data-anchor-id="clustering-y-curvas-promedio-en-conjunto"><span class="header-section-number">4.8.2</span> Clustering y curvas promedio en conjunto</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>df_pool_filt <span class="ot">&lt;-</span> df_anova_pool <span class="sc">%&gt;%</span></span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Treatment_code <span class="sc">!=</span> <span class="st">"UNTREATED"</span>)</span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula la media de cada variable resumen por tratamiento</span></span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>df_cluster_pool <span class="ot">&lt;-</span> df_pool_filt <span class="sc">%&gt;%</span></span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment_code) <span class="sc">%&gt;%</span></span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> <span class="fu">mean</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-11"><a href="#cb355-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo =</span> <span class="fu">mean</span>(mortalidad_codo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-12"><a href="#cb355-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_final =</span> <span class="fu">mean</span>(mortalidad_final, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-13"><a href="#cb355-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_postcodo =</span> <span class="fu">mean</span>(delta_postcodo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb355-14"><a href="#cb355-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb355-15"><a href="#cb355-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>vars_for_cluster_3 <span class="ot">&lt;-</span> <span class="fu">scale</span>(df_cluster_pool[, <span class="fu">c</span>(<span class="st">"AUC"</span>, <span class="st">"mortalidad_codo"</span>, <span class="st">"mortalidad_final"</span>, <span class="st">"delta_postcodo"</span>)])</span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(vars_for_cluster_3) <span class="ot">&lt;-</span> df_cluster_pool<span class="sc">$</span>Treatment_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Método silhouette</span></span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(vars_for_cluster_3, kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>, <span class="at">k.max =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Silhouette method for optimal k"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-152-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (Opcional) Método gap statistic</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(vars_for_cluster_3, <span class="at">FUN =</span> kmeans, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">K.max =</span> <span class="dv">7</span>, <span class="at">B =</span> <span class="dv">100</span>)</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gap Statistic for optimal k"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-152-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Tomaremos k = 2. Así:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>kcl <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># k = 2 por Silhouette (GAP statistic da k = 1, no interesa)</span></span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a>km3 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(vars_for_cluster_3, <span class="at">centers =</span> kcl, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>df_cluster_pool<span class="sc">$</span>Cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(km3<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_cluster_pool, <span class="fu">aes</span>(<span class="at">x =</span> mortalidad_codo, <span class="at">y =</span> delta_postcodo, <span class="at">color =</span> Cluster, <span class="at">label =</span> Treatment_code)) <span class="sc">+</span></span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">nudge_y =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Treatment Clusters"</span>,</span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Mortality rate at elbow (%)"</span>,</span>
<span id="cb360-9"><a href="#cb360-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Persistence (Δ post-elbow, %)"</span></span>
<span id="cb360-10"><a href="#cb360-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb360-11"><a href="#cb360-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-154-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Gráfico base con fviz_cluster</span></span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a>p_pool <span class="ot">&lt;-</span> <span class="fu">fviz_cluster</span>(km3, <span class="at">data =</span> vars_for_cluster_3, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb361-7"><a href="#cb361-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>))</span>
<span id="cb361-8"><a href="#cb361-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">4</span>))  <span class="co"># Ajusta los límites según tus datos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ScaleContinuousPosition&gt;
 Range:  
 Limits:   -3 --    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Extrae los datos internos (scores de componentes principales y cluster)</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a>plotdata_pool <span class="ot">&lt;-</span> p_pool<span class="sc">$</span>data</span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Añade labels personalizados (Treatment_code o Treatment_name)</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a>plotdata_pool<span class="sc">$</span>label <span class="ot">&lt;-</span> df_cluster_pool<span class="sc">$</span>Treatment_code  <span class="co"># O usa Treatment_name si prefieres</span></span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Añade la capa geom_text con los labels y colores por cluster</span></span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a>p_pool_labeled <span class="ot">&lt;-</span> p_pool <span class="sc">+</span></span>
<span id="cb363-9"><a href="#cb363-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb363-10"><a href="#cb363-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plotdata_pool,</span>
<span id="cb363-11"><a href="#cb363-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">color =</span> <span class="fu">factor</span>(cluster)),  <span class="co"># color por cluster</span></span>
<span id="cb363-12"><a href="#cb363-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.7</span>,</span>
<span id="cb363-13"><a href="#cb363-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb363-14"><a href="#cb363-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb363-15"><a href="#cb363-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fl">0.1</span></span>
<span id="cb363-16"><a href="#cb363-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb363-17"><a href="#cb363-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-18"><a href="#cb363-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Muestra el gráfico final</span></span>
<span id="cb363-19"><a href="#cb363-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_pool_labeled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-155-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vemos las cargas de cada variable en cada componente principal:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Si usaste prcomp para el PCA:</span></span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>pca_result3 <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(vars_for_cluster_3, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_result3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2     PC3       PC4
Standard deviation     1.8164 0.8317 0.09346 2.022e-16
Proportion of Variance 0.8249 0.1729 0.00218 0.000e+00
Cumulative Proportion  0.8249 0.9978 1.00000 1.000e+00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb366"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>pca_result3<span class="sc">$</span>rotation   <span class="co"># Cargas de las variables originales en cada componente</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        PC1         PC2        PC3        PC4
AUC              -0.5468559 -0.10241651  0.8309389  0.0000000
mortalidad_codo  -0.5500639 -0.02716806 -0.3653555  0.7504712
mortalidad_final -0.4948016 -0.52525903 -0.3903781 -0.5717335
delta_postcodo    0.3918543 -0.84431967  0.1538206  0.3315324</code></pre>
</div>
</div>
<p>Ahora vemos por último la gráfica de las curvas promedio:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>colores_pool <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>  treatment_palette_extended<span class="sc">$</span>color,</span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>  treatment_palette_extended<span class="sc">$</span>code</span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb368-7"><a href="#cb368-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-8"><a href="#cb368-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Curvas promedio por tratamiento (promedia sobre todos los años, parcelas y réplicas)</span></span>
<span id="cb368-9"><a href="#cb368-9" aria-hidden="true" tabindex="-1"></a>curvas_trt_pool <span class="ot">&lt;-</span> arbol_pool <span class="sc">%&gt;%</span></span>
<span id="cb368-10"><a href="#cb368-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment_code, periodo) <span class="sc">%&gt;%</span></span>
<span id="cb368-11"><a href="#cb368-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mortalidad =</span> <span class="fu">mean</span>(mortalidad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb368-12"><a href="#cb368-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-13"><a href="#cb368-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular codos por tratamiento (para la curva media de cada uno)</span></span>
<span id="cb368-14"><a href="#cb368-14" aria-hidden="true" tabindex="-1"></a>codos_trt_pool <span class="ot">&lt;-</span> curvas_trt_pool <span class="sc">%&gt;%</span></span>
<span id="cb368-15"><a href="#cb368-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment_code) <span class="sc">%&gt;%</span></span>
<span id="cb368-16"><a href="#cb368-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb368-17"><a href="#cb368-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">periodo_codo =</span> periodo[<span class="fu">elbow</span>(periodo, mortalidad)],</span>
<span id="cb368-18"><a href="#cb368-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortalidad_codo =</span> mortalidad[<span class="fu">elbow</span>(periodo, mortalidad)],</span>
<span id="cb368-19"><a href="#cb368-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb368-20"><a href="#cb368-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Si tienes una paleta de etiquetas:</span></span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment_labels_pool &lt;- ...  # Vector con los nombres legibles por código</span></span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a>codos_trt_pool<span class="sc">$</span>Treatment <span class="ot">&lt;-</span> codos_trt_pool<span class="sc">$</span>Treatment_code</span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepara y nombra las columnas</span></span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>codos_trt_pool_out <span class="ot">&lt;-</span> codos_trt_pool[, <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"periodo_codo"</span>, <span class="st">"mortalidad_codo"</span>)]</span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(codos_trt_pool_out) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"Elbow period"</span>, <span class="st">"Elbow mortality rate (%)"</span>)</span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a>tabla_kable_pool <span class="ot">&lt;-</span> <span class="fu">kable</span>(</span>
<span id="cb369-13"><a href="#cb369-13" aria-hidden="true" tabindex="-1"></a>  codos_trt_pool_out, <span class="at">align =</span> <span class="st">"c"</span>,</span>
<span id="cb369-14"><a href="#cb369-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Period and mortality rate at the elbow for each treatment (pooling years)"</span></span>
<span id="cb369-15"><a href="#cb369-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb369-16"><a href="#cb369-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb369-17"><a href="#cb369-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-18"><a href="#cb369-18" aria-hidden="true" tabindex="-1"></a>tabla_kable_pool</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Period and mortality rate at the elbow for each treatment (pooling years)</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Treatment</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Elbow period</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Elbow mortality rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">CONFIDOR_750_FOLIAR</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">79.44666</td>
</tr>
<tr class="even">
<td style="text-align: center;">CONFIDOR_750_INJCTREE</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">35.96742</td>
</tr>
<tr class="odd">
<td style="text-align: center;">EPIK_1500_FOLIAR</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">83.22247</td>
</tr>
<tr class="even">
<td style="text-align: center;">EPIK_1500_INJCTREE</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">72.66171</td>
</tr>
<tr class="odd">
<td style="text-align: center;">KARATE_250_FOLIAR</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">61.89056</td>
</tr>
<tr class="even">
<td style="text-align: center;">SULFOXAFLOR_200_FOLIAR</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">56.17758</td>
</tr>
<tr class="odd">
<td style="text-align: center;">SULFOXAFLOR_400_FOLIAR</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">36.25401</td>
</tr>
<tr class="even">
<td style="text-align: center;">SULFOXAFLOR_400_INJCTREE</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">30.84816</td>
</tr>
<tr class="odd">
<td style="text-align: center;">UNTREATED</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">21.41226</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Si tienes paleta de colores para el pool (sino quita scale_color_manual)</span></span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>colores_pool <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rainbow</span>(<span class="fu">length</span>(<span class="fu">unique</span>(curvas_trt_pool<span class="sc">$</span>Treatment_code))),</span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(curvas_trt_pool<span class="sc">$</span>Treatment_code)</span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb370-8"><a href="#cb370-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-9"><a href="#cb370-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(curvas_trt_pool, <span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> mortalidad, <span class="at">color =</span> Treatment_code, <span class="at">group =</span> Treatment_code)) <span class="sc">+</span></span>
<span id="cb370-10"><a href="#cb370-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb370-11"><a href="#cb370-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb370-12"><a href="#cb370-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> codos_trt_pool, <span class="fu">aes</span>(<span class="at">xintercept =</span> periodo_codo, <span class="at">color =</span> Treatment_code), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb370-13"><a href="#cb370-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb370-14"><a href="#cb370-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> colores_pool,</span>
<span id="cb370-15"><a href="#cb370-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">setNames</span>(treatment_palette_extended<span class="sc">$</span>label, treatment_palette_extended<span class="sc">$</span>code)</span>
<span id="cb370-16"><a href="#cb370-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb370-17"><a href="#cb370-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb370-18"><a href="#cb370-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb370-19"><a href="#cb370-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb370-20"><a href="#cb370-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb370-21"><a href="#cb370-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb370-22"><a href="#cb370-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb370-23"><a href="#cb370-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Period (pooling years)"</span>,</span>
<span id="cb370-24"><a href="#cb370-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average mortality rate (%)"</span>,</span>
<span id="cb370-25"><a href="#cb370-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span></span>
<span id="cb370-26"><a href="#cb370-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-159-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distancia-wasserstein-otro-enfoque" class="level3" data-number="4.8.3">
<h3 data-number="4.8.3" class="anchored" data-anchor-id="distancia-wasserstein-otro-enfoque"><span class="header-section-number">4.8.3</span> Distancia Wasserstein (otro enfoque)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista de tratamientos únicos</span></span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>tratamientos <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_anova_pool<span class="sc">$</span>Treatment_code)</span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una lista: cada elemento es una matriz n_réplicas x 4 variables resumen</span></span>
<span id="cb371-7"><a href="#cb371-7" aria-hidden="true" tabindex="-1"></a>lista_tratamientos <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tratamientos, <span class="cf">function</span>(trt) {</span>
<span id="cb371-8"><a href="#cb371-8" aria-hidden="true" tabindex="-1"></a>  df_anova_pool <span class="sc">%&gt;%</span></span>
<span id="cb371-9"><a href="#cb371-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Treatment_code <span class="sc">==</span> trt) <span class="sc">%&gt;%</span></span>
<span id="cb371-10"><a href="#cb371-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(AUC, mortalidad_codo, mortalidad_final, delta_postcodo) <span class="sc">%&gt;%</span></span>
<span id="cb371-11"><a href="#cb371-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb371-12"><a href="#cb371-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb371-13"><a href="#cb371-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lista_tratamientos) <span class="ot">&lt;-</span> tratamientos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(lista_tratamientos)</span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> n, <span class="at">dimnames =</span> <span class="fu">list</span>(tratamientos, tratamientos))</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(transport)</span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb372-7"><a href="#cb372-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> i<span class="sc">:</span>n) {</span>
<span id="cb372-8"><a href="#cb372-8" aria-hidden="true" tabindex="-1"></a>    Xi <span class="ot">&lt;-</span> lista_tratamientos[[i]]</span>
<span id="cb372-9"><a href="#cb372-9" aria-hidden="true" tabindex="-1"></a>    Xj <span class="ot">&lt;-</span> lista_tratamientos[[j]]</span>
<span id="cb372-10"><a href="#cb372-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(Xi) <span class="sc">==</span> <span class="dv">1</span>) Xi <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Xi, Xi)</span>
<span id="cb372-11"><a href="#cb372-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(Xj) <span class="sc">==</span> <span class="dv">1</span>) Xj <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Xj, Xj)</span>
<span id="cb372-12"><a href="#cb372-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcula la matriz de costes (distancia euclídea entre todos los pares de puntos)</span></span>
<span id="cb372-13"><a href="#cb372-13" aria-hidden="true" tabindex="-1"></a>    costm <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(<span class="fu">rbind</span>(Xi, Xj)))[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Xi), (<span class="fu">nrow</span>(Xi)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">nrow</span>(Xi)<span class="sc">+</span><span class="fu">nrow</span>(Xj))]</span>
<span id="cb372-14"><a href="#cb372-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcula la distancia de Wasserstein (p = 2, costm = matriz de distancias)</span></span>
<span id="cb372-15"><a href="#cb372-15" aria-hidden="true" tabindex="-1"></a>    D[i, j] <span class="ot">&lt;-</span> <span class="fu">wasserstein</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">nrow</span>(Xi), <span class="fu">nrow</span>(Xi)), <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">nrow</span>(Xj), <span class="fu">nrow</span>(Xj)), <span class="at">costm =</span> costm, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb372-16"><a href="#cb372-16" aria-hidden="true" tabindex="-1"></a>    D[j, i] <span class="ot">&lt;-</span> D[i, j]</span>
<span id="cb372-17"><a href="#cb372-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb372-18"><a href="#cb372-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb372-19"><a href="#cb372-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-20"><a href="#cb372-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         CONFIDOR_750_FOLIAR CONFIDOR_750_INJCTREE
CONFIDOR_750_FOLIAR                  0.00000             268.58970
CONFIDOR_750_INJCTREE              268.58970               0.00000
EPIK_1500_FOLIAR                    52.07865             279.94102
EPIK_1500_INJCTREE                  63.15824             218.88404
KARATE_250_FOLIAR                  121.54294             168.63658
SULFOXAFLOR_200_FOLIAR             206.20255              76.45167
SULFOXAFLOR_400_FOLIAR             222.84483              55.31954
SULFOXAFLOR_400_INJCTREE           230.37172              67.55462
UNTREATED                          318.95900              54.58698
                         EPIK_1500_FOLIAR EPIK_1500_INJCTREE KARATE_250_FOLIAR
CONFIDOR_750_FOLIAR              52.07865           63.15824         121.54294
CONFIDOR_750_INJCTREE           279.94102          218.88404         168.63658
EPIK_1500_FOLIAR                  0.00000           66.54127         118.13815
EPIK_1500_INJCTREE               66.54127            0.00000          66.77081
KARATE_250_FOLIAR               118.13815           66.77081           0.00000
SULFOXAFLOR_200_FOLIAR          217.02790          156.68169         102.69391
SULFOXAFLOR_400_FOLIAR          234.91869          174.12110         122.75800
SULFOXAFLOR_400_INJCTREE        244.97261          183.74796         136.36544
UNTREATED                       331.24224          270.25782         218.77618
                         SULFOXAFLOR_200_FOLIAR SULFOXAFLOR_400_FOLIAR
CONFIDOR_750_FOLIAR                   206.20255              222.84483
CONFIDOR_750_INJCTREE                  76.45167               55.31954
EPIK_1500_FOLIAR                      217.02790              234.91869
EPIK_1500_INJCTREE                    156.68169              174.12110
KARATE_250_FOLIAR                     102.69391              122.75800
SULFOXAFLOR_200_FOLIAR                  0.00000               44.15064
SULFOXAFLOR_400_FOLIAR                 44.15064                0.00000
SULFOXAFLOR_400_INJCTREE               75.92029               57.07037
UNTREATED                             121.28913               98.69439
                         SULFOXAFLOR_400_INJCTREE UNTREATED
CONFIDOR_750_FOLIAR                     230.37172 318.95900
CONFIDOR_750_INJCTREE                    67.55462  54.58698
EPIK_1500_FOLIAR                        244.97261 331.24224
EPIK_1500_INJCTREE                      183.74796 270.25782
KARATE_250_FOLIAR                       136.36544 218.77618
SULFOXAFLOR_200_FOLIAR                   75.92029 121.28913
SULFOXAFLOR_400_FOLIAR                   57.07037  98.69439
SULFOXAFLOR_400_INJCTREE                  0.00000  92.91897
UNTREATED                                92.91897   0.00000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">as.dist</span>(D), <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"Hierarchical clustering (Wasserstein distance)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-162-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>mds <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(<span class="fu">as.dist</span>(D), <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>  mds, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">main =</span> <span class="st">"MDS by Wasserstein distance"</span>, <span class="at">xlab =</span> <span class="st">"Dim 1"</span>, <span class="at">ylab =</span> <span class="st">"Dim 2"</span></span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(mds, <span class="at">labels =</span> <span class="fu">rownames</span>(mds), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-163-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># D es tu matriz de distancias</span></span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a>mds <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(<span class="fu">as.dist</span>(D), <span class="at">k =</span> <span class="dv">2</span>, <span class="at">eig =</span> <span class="cn">TRUE</span>)</span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordenadas embebidas</span></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> mds<span class="sc">$</span>points</span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Distancias euclídeas en el embebido</span></span>
<span id="cb376-8"><a href="#cb376-8" aria-hidden="true" tabindex="-1"></a>D_fit <span class="ot">&lt;-</span> <span class="fu">dist</span>(Y)</span>
<span id="cb376-9"><a href="#cb376-9" aria-hidden="true" tabindex="-1"></a>D_orig <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(D)</span>
<span id="cb376-10"><a href="#cb376-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-11"><a href="#cb376-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Stress clásico (Kruskal)</span></span>
<span id="cb376-12"><a href="#cb376-12" aria-hidden="true" tabindex="-1"></a>stress <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((D_fit <span class="sc">-</span> D_orig)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(D_orig<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb376-13"><a href="#cb376-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Stress clásico:"</span>, stress, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stress clásico: 0.0359463 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_anova_pool, <span class="fu">aes</span>(<span class="at">x =</span> Treatment_code, <span class="at">y =</span> AUC)) <span class="sc">+</span></span>
<span id="cb378-4"><a href="#cb378-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.colour =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb378-5"><a href="#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb378-6"><a href="#cb378-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AUC by Treatment (outliers in red)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-165-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(cluster)) <span class="fu">install.packages</span>(<span class="st">"cluster"</span>)</span>
<span id="cb379-2"><a href="#cb379-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb379-3"><a href="#cb379-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb379-4"><a href="#cb379-4" aria-hidden="true" tabindex="-1"></a><span class="co"># X = matriz de datos usada en kmeans</span></span>
<span id="cb379-5"><a href="#cb379-5" aria-hidden="true" tabindex="-1"></a>sil <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(km3<span class="sc">$</span>cluster, <span class="fu">dist</span>(vars_for_cluster_3))</span>
<span id="cb379-6"><a href="#cb379-6" aria-hidden="true" tabindex="-1"></a>mean_sil <span class="ot">&lt;-</span> <span class="fu">mean</span>(sil[, <span class="dv">3</span>])</span>
<span id="cb379-7"><a href="#cb379-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average Silhouette width:"</span>, mean_sil, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Silhouette width: 0.5506497 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sil, <span class="at">border =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="insectarbol_files/figure-html/unnamed-chunk-166-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusiones-de-p3" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusiones de P3</h1>
<section id="diferencias-globales-entre-tratamientos-auc-y-mortalidad" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="diferencias-globales-entre-tratamientos-auc-y-mortalidad"><span class="header-section-number">5.1</span> <strong>1. Diferencias globales entre tratamientos (AUC y mortalidad)</strong></h2>
<ul>
<li><p>Hay <strong>dos grandes clusters de tratamientos</strong> bien diferenciados, según el gráfico:</p>
<ul>
<li><p><strong>Cluster de baja eficacia:</strong> UNTREATED (control, es evidente que iba a estar en este cluster porque el control no tiene eficacia ni persistencia), CONFIDOR_750_INJCTREE, SULFOXAFLOR_400_INJCTREE, SULFOXAFLOR_400_FOLIAR, SULFOXAFLOR_200_FOLIAR.</p></li>
<li><p><strong>Cluster de alta eficacia:</strong> KARATE_250_FOLIAR, EPIK_1500_INJCTREE, CONFIDOR_750_FOLIAR, EPIK_1500_FOLIAR.</p></li>
</ul></li>
<li><p>Las medias ajustadas (emmean) para <strong>AUC</strong> muestran que los tratamientos más eficaces (grupo “c” en .group) son <strong>EPIK_1500_FOLIAR, CONFIDOR_750_FOLIAR, EPIK_1500_INJCTREE, KARATE_250_FOLIAR</strong>.</p></li>
<li><p>Estos tratamientos tienen valores de AUC mucho más altos, indicando <strong>mayor mortalidad acumulada</strong>.</p></li>
</ul>
</section>
<section id="mortalidad-en-el-codo-y-mortalidad-final" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="mortalidad-en-el-codo-y-mortalidad-final"><span class="header-section-number">5.2</span> <strong>2. Mortalidad en el codo y mortalidad final</strong></h2>
<ul>
<li>Para <strong>mortalidad en el codo</strong> y <strong>mortalidad final</strong>, los patrones son similares:
<ul>
<li><p><strong>CONFIDOR_750_FOLIAR</strong> y <strong>EPIK_1500_FOLIAR</strong> presentan los valores más altos de mortalidad, y forman un grupo significativo superior (d/e).</p></li>
<li><p>Los tratamientos como UNTREATED, CONFIDOR_750_INJCTREE y SULFOXAFLOR (en cualquiera de sus formas) muestran valores intermedios o bajos, y frecuentemente no se diferencian entre sí (grupo a/b).</p></li>
<li><p><strong>KARATE_250_FOLIAR</strong> también se sitúa en el grupo de mayor mortalidad final.</p></li>
</ul></li>
</ul>
</section>
<section id="persistencia-delta_postcodo" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="persistencia-delta_postcodo"><span class="header-section-number">5.3</span> <strong>3. Persistencia (delta_postcodo)</strong></h2>
<ul>
<li><p>Para la persistencia (diferencia entre mortalidad final y en el codo), los tratamientos con <strong>mayor reducción de mortalidad tras el codo</strong> (valores más negativos) son <strong>EPIK_1500_FOLIAR</strong> y <strong>EPIK_1500_INJCTREE</strong>, es decir, su eficacia cae más después del punto de inflexión (codo).</p></li>
<li><p>El <strong>UNTREATED</strong> y SULFOXAFLOR tienen valores próximos a cero o positivos, indicando <strong>alta persistencia</strong> (no aumentan ni mantienen mortalidad tras el codo).</p></li>
</ul>
</section>
<section id="conclusión-práctica" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="conclusión-práctica"><span class="header-section-number">5.4</span> <strong>Conclusión práctica</strong></h2>
<ul>
<li><p><strong>EPIK (foliar e inyección) y CONFIDOR 200 OD foliar</strong> son los tratamientos más eficaces y persistentes para controlar <em>Philaenus spumarius</em>, mostrando <strong>diferencias estadísticas claras</strong> respecto a los tratamientos basados en SULFOXAFLOR o el testigo.</p></li>
<li><p><strong>La aplicación foliar suele ser superior a la inyección</strong> para los tratamientos con mejor rendimiento.</p></li>
<li><p><strong>Los SULFOXAFLOR</strong> presentan resultados bajos y no se diferencian entre sí en mortalidad acumulada ni persistencia. Sin embargo, sí destacan por su alta persistencia en comparación con los EPIK y relativamente hablando el CONFIDOR de aplicación foliar.</p></li>
<li><p><strong>KARATE ZEON 250 (de aplicación foliar)</strong> sería la opción intermedia si bien más próxima en cuanto a eficacia a los tratamientos EPIK y CONFIDOR 200 OD de aplicación foliar (por eso lo pone en ese cluster).</p></li>
</ul>
</section>
</section>
<section id="diagrama-de-conclusión" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Diagrama de conclusión</h1>
<div style="width: 1800px; overflow-x: auto; zoom:1.5;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    %% Central node
    A["TREATMENT CLUSTERS"]

    %% Cluster 1 (High efficacy)
    subgraph Cluster1["Cluster 1: High efficacy"]
        direction TB
        B1["CONFIDOR_750_FOLIAR"]
        B2["KARATE_250_FOLIAR"]
        B3["EPIK_1500_FOLIAR"]
        B4["EPIK_1500_INJCTREE"]
    end

    %% Cluster 2 (Lower efficacy)
    subgraph Cluster2["Cluster 2: Lower efficacy"]
        direction TB
        C1["CONFIDOR_750_INJCTREE"]
        C2["SULFOXAFLOR_400_FOLIAR"]
        C3["SULFOXAFLOR_400_INJCTREE"]
        C4["SULFOXAFLOR_200_FOLIAR"]
    end

    %% Conexión entre nodo central y clusters
    A --&gt; Cluster1
    A --&gt; Cluster2

    %% Stickers clave abajo
    A --&gt; D1["Foliar = ↑ efficacy (on average)"]
    A --&gt; D2["Persistence = highly variable, not explained by application"]
    A --&gt; D3["Plot-to-plot variability: very low (&lt;16%)"]
    A --&gt; D4["Persistence ↑ → Efficacy ↓"]
    A --&gt; D5["Treatments explain most variability"]

    %% Flechas mejores y peores
    B1 --&gt;|Best| E1["✔ Best"]
    B2 --&gt;|Best| E1
    %% Puedes también añadir EPIK_1500_FOLIAR si quieres (suele estar bien en eficacia):
    B3 -.-&gt;|Also good| E2["✓ Good"]
    B4 -.-&gt;|Also good| E2

    %% Peor tratamiento
    C1 --&gt;|Worst| F1["✘ Worst"]

    %% Estilo visual
    classDef cluster1 fill:#ffcccc,stroke:#d33,stroke-width:2px;
    classDef cluster2 fill:#cce6ff,stroke:#06c,stroke-width:2px;
    classDef sticker fill:#ffffcc,stroke:#bbb,stroke-width:1.5px,font-weight:bold;
    classDef best fill:#ccffcc,stroke:#080,stroke-width:2px,font-weight:bold;
    classDef worst fill:#ffd6cc,stroke:#d33,stroke-width:2px,font-weight:bold;
    classDef good fill:#f5ffcc,stroke:#aab400,stroke-width:2px,font-weight:bold;

    class Cluster1 cluster1;
    class Cluster2 cluster2;
    class D1,D2,D3,D4,D5 sticker;
    class E1 best;
    class F1 worst;
    class E2 good;

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<section id="apéndice" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Apéndice</h1>
<section id="anomalías-o-consideraciones-sobre-los-datos" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="anomalías-o-consideraciones-sobre-los-datos"><span class="header-section-number">7.1</span> Anomalías o consideraciones sobre los datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">subset</span>(arbol1<span class="sc">$</span>mortalidad, arbol1<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"5"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22.80933</code></pre>
</div>
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="fu">subset</span>(arbol1<span class="sc">$</span>mortalidad, arbol1<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"5"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.23702</code></pre>
</div>
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">subset</span>(arbol2<span class="sc">$</span>mortalidad, arbol2<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70.49094</code></pre>
</div>
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="fu">subset</span>(arbol2<span class="sc">$</span>mortalidad, arbol2<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.91875</code></pre>
</div>
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">subset</span>(arbol1<span class="sc">$</span>mortalidad, arbol1<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"3"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37.60485</code></pre>
</div>
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="fu">subset</span>(arbol1<span class="sc">$</span>mortalidad, arbol1<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"3"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30.48576</code></pre>
</div>
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">subset</span>(arbol2<span class="sc">$</span>mortalidad, arbol2<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28.56062</code></pre>
</div>
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="fu">subset</span>(arbol2<span class="sc">$</span>mortalidad, arbol2<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.07191</code></pre>
</div>
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">subset</span>(arbol1<span class="sc">$</span>mortalidad, arbol1<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="fu">subset</span>(arbol1<span class="sc">$</span>mortalidad, arbol1<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19.35812</code></pre>
</div>
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">subset</span>(arbol2<span class="sc">$</span>mortalidad, arbol2<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29.10771</code></pre>
</div>
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(<span class="fu">subset</span>(arbol2<span class="sc">$</span>mortalidad, arbol2<span class="sc">$</span>Trtf <span class="sc">==</span> <span class="st">"4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26.3119</code></pre>
</div>
</div>
</section>
<section id="cálculo-del-pseudo-r2-en-modelos-mixtos-según-nakagawa-y-schielzeth-2013-para-lo-de-los-blups" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="cálculo-del-pseudo-r2-en-modelos-mixtos-según-nakagawa-y-schielzeth-2013-para-lo-de-los-blups"><span class="header-section-number">7.2</span> <strong>Cálculo del</strong> (pseudo)-<span class="math inline">\(R^2\)</span> <strong>en Modelos Mixtos según Nakagawa y Schielzeth (2013) (para lo de los BLUPs)</strong></h2>
<section id="modelo-lineal-mixto-lmm" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="modelo-lineal-mixto-lmm"><span class="header-section-number">7.2.1</span> <strong>Modelo Lineal Mixto (LMM)</strong></h3>
<p>Consideremos un modelo lineal mixto con estructura:</p>
<p><span class="math display">\[
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{Z}\mathbf{b} + \boldsymbol{\varepsilon}
\]</span></p>
<p>donde:</p>
<ul>
<li><span class="math inline">\(\mathbf{y}\)</span> es el vector de observaciones (<span class="math inline">\(n \times 1\)</span>)</li>
<li><span class="math inline">\(\mathbf{X}\)</span> es la matriz de diseño de efectos fijos (<span class="math inline">\(n \times p\)</span>)</li>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span> es el vector de coeficientes fijos (<span class="math inline">\(p \times 1\)</span>)</li>
<li><span class="math inline">\(\mathbf{Z}\)</span> es la matriz de diseño de efectos aleatorios (<span class="math inline">\(n \times q\)</span>)</li>
<li><span class="math inline">\(\mathbf{b} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{\Sigma}_b)\)</span> son los efectos aleatorios (<span class="math inline">\(q \times 1\)</span>)</li>
<li><span class="math inline">\(\boldsymbol{\varepsilon} \sim \mathcal{N}(\mathbf{0}, \sigma^2\mathbf{I}_n)\)</span> es el error residual</li>
</ul>
<p><strong>Descomposición de Varianza</strong></p>
<p>La varianza total observada se descompone como:</p>
<p><span class="math display">\[
\sigma^2_{\text{total}} \approx \sigma^2_f + \sigma^2_b + \sigma^2
\]</span></p>
<p>donde:</p>
<ul>
<li><span class="math inline">\(\sigma^2_f = \mathrm{Var}(\mathbf{X}\hat{\boldsymbol{\beta}})\)</span> es la varianza de las predicciones de efectos fijos, estimada como:</li>
</ul>
<p><span class="math display">\[
\hat{\sigma}^2_f = \frac{1}{n-1} \sum_{i=1}^n \left( \mathbf{X}_i\hat{\boldsymbol{\beta}} - \overline{\mathbf{X}\hat{\boldsymbol{\beta}}} \right)^2
\]</span></p>
<ul>
<li><span class="math inline">\(\sigma^2_b = \mathrm{Var}(\mathbf{Z}\mathbf{b})\)</span> es la varianza de efectos aleatorios, estimada como:</li>
</ul>
<p><span class="math display">\[
\hat{\sigma}^2_b = \sum_{k=1}^r \hat{\sigma}^2_{b_k}
\]</span></p>
<p>(con <span class="math inline">\(r\)</span> componentes independientes), o en general como:</p>
<p><span class="math display">\[
\mathrm{tr}(\mathbf{Z}\boldsymbol{\Sigma}_b\mathbf{Z}^\top)
\]</span></p>
<ul>
<li><span class="math inline">\(\sigma^2\)</span> es la varianza residual estimada.</li>
</ul>
<p><strong>Coeficientes de Determinación</strong></p>
<ul>
<li><span class="math inline">\(R^2\)</span> marginal (varianza explicada por efectos fijos):</li>
</ul>
<p><span class="math display">\[
R^2_m = \frac{\sigma^2_f}{\sigma^2_f + \sigma^2_b + \sigma^2}
\]</span></p>
<ul>
<li><span class="math inline">\(R^2\)</span> condicional (varianza explicada por efectos fijos + aleatorios):</li>
</ul>
<p><span class="math display">\[
R^2_c = \frac{\sigma^2_f + \sigma^2_b}{\sigma^2_f + \sigma^2_b + \sigma^2}
\]</span></p>
</section>
<section id="extensión-a-modelos-mixtos-generalizados-glmm" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="extensión-a-modelos-mixtos-generalizados-glmm"><span class="header-section-number">7.2.2</span> <strong>Extensión a Modelos Mixtos Generalizados (GLMM)</strong></h3>
<p>Para GLMMs con función de enlace <span class="math inline">\(g(\cdot)\)</span> y distribución no normal, se añade un término de varianza específica:</p>
<p><span class="math display">\[
\sigma^2_{\text{total}} \approx \sigma^2_f + \sigma^2_b + \sigma^2_d
\]</span></p>
<p>donde <span class="math inline">\(\sigma^2_d\)</span> es la varianza intrínseca de la distribución en la escala del predictor lineal. Algunos valores típicos son:</p>
<ul>
<li>Binomial-logit: <span class="math inline">\(\sigma^2_d = \dfrac{\pi^2}{3} \approx 3.29\)</span></li>
<li>Binomial-probit: <span class="math inline">\(\sigma^2_d = 1\)</span></li>
<li>Poisson: <span class="math inline">\(\sigma^2_d = \ln\left(1 + \dfrac{1}{\bar{\lambda}}\right)\)</span> con <span class="math inline">\(\bar{\lambda} = \dfrac{1}{n} \sum y_i\)</span></li>
<li>Binomial negativo: <span class="math inline">\(\sigma^2_d = \ln\left(1 + \dfrac{1}{\bar{\lambda}} + \dfrac{1}{\hat{\theta}}\right)\)</span> donde <span class="math inline">\(\hat{\theta}\)</span> es el parámetro de dispersión</li>
</ul>
<p><strong>Fórmulas Adaptadas para GLMMs</strong></p>
<ul>
<li><span class="math inline">\(R^2\)</span> marginal:</li>
</ul>
<p><span class="math display">\[
R^2_m = \frac{\sigma^2_f}{\sigma^2_f + \sigma^2_b + \sigma^2_d}
\]</span></p>
<ul>
<li><span class="math inline">\(R^2\)</span> condicional:</li>
</ul>
<p><span class="math display">\[
R^2_c = \frac{\sigma^2_f + \sigma^2_b}{\sigma^2_f + \sigma^2_b + \sigma^2_d}
\]</span></p>
<p><strong>Propiedades y Limitaciones</strong></p>
<ul>
<li>Las fórmulas generalizan el <span class="math inline">\(R^2\)</span> tradicional de modelos lineales</li>
<li><span class="math inline">\(0 \leq R^2_m \leq R^2_c \leq 1\)</span></li>
<li><span class="math inline">\(\sigma^2_f\)</span> depende de la variabilidad observada en <span class="math inline">\(\mathbf{X}\)</span></li>
<li>En distribuciones no constantes (Poisson, binomial negativo), <span class="math inline">\(\sigma^2_d\)</span> es aproximada</li>
<li>La igualdad <span class="math inline">\(\sigma^2_{\text{total}} = \sigma^2_f + \sigma^2_b + \sigma^2\)</span> es asintótica y asume ortogonalidad entre componentes</li>
</ul>
<p><strong>Implementación Práctica</strong></p>
<ol type="1">
<li>Calcular predicciones de efectos fijos: <span class="math inline">\(\hat{\boldsymbol{\eta}}_f = \mathbf{X}\hat{\boldsymbol{\beta}}\)</span></li>
<li>Estimar <span class="math inline">\(\hat{\sigma}^2_f = \mathrm{Var}(\hat{\boldsymbol{\eta}}_f)\)</span> (varianza muestral)</li>
<li>Sumar varianzas de efectos aleatorios: <span class="math inline">\(\hat{\sigma}^2_b = \sum \hat{\sigma}^2_{b_k}\)</span></li>
<li>Determinar <span class="math inline">\(\sigma^2_d\)</span> según familia y enlace</li>
<li>Computar <span class="math inline">\(R^2_m\)</span> y <span class="math inline">\(R^2_c\)</span> usando las fórmulas anteriores</li>
</ol>
<p><strong>Referencia principal:</strong> <span class="citation" data-cites="nakagawa2012">(<a href="#ref-nakagawa2012" role="doc-biblioref">Nakagawa and Schielzeth 2012</a>)</span></p>
</section>
</section>
</section>
</div>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-nakagawa2012" class="csl-entry" role="listitem">
Nakagawa, Shinichi, and Holger Schielzeth. 2012. <span>“A General and Simple Method for Obtaining <span><em>R</em></span><span><sup>2</sup></span> from Generalized Linear Mixed<span>-</span>Effects Models.”</span> Edited by Robert B. O’Hara. <em>Methods in Ecology and Evolution</em> 4 (2): 133–42. <a href="https://doi.org/10.1111/j.2041-210x.2012.00261.x">https://doi.org/10.1111/j.2041-210x.2012.00261.x</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>